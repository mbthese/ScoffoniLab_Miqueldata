---
title: "Figures"
output: html_document
date: "2025-05-27"
editor_options: 
  chunk_output_type: console
---

#libraries 

```{r}
library(ggplot2)
library(agricolae)
library(plyr)
library(multcomp)
library(corrplot)
library(factoextra)
library(readxl)
library(dplyr)
library(ggpubr)
library(cowplot)
library(tidyr)
library(readr)
library(tibble)
library(purrr)
library(kableExtra) 
library(webshot2)
library(Hmisc)
```

#Function

Getting r from sqrt(R2) is only valid for simple linear regressions. So, for Gaussian, do this:
1- Define the null model: assuming the trait (WUEi) is just a constant (the mean)
2-Take my model: the fitted Gaussian curve with 3 parameters (alpha, mu, sigma)
3-Compare the likelihoods of each model: *how likely the observed data are under the null model vs. how likely they are under the Gaussian model*
4-Likelihood ratio: take the difference in log-likelihoods (full vs. null), multiply by 2. A big ratio : Gaussian explains the data much better than just the mean.
4-p-value: Compare LR to a chi-square distribution with degrees of freedom equal to the difference in number of parameters (3 – 1 = 2).

```{r}
# Function to test significance of R² simple regression
pval_from_R2_regression <- function(R2, n) {
  r <- sqrt(R2)                   # correlation from R²
  tval <- r * sqrt((n - 2) / (1 - r^2))  # test statistic
  df <- n - 2                     # degrees of freedom
  pval <- 2 * pt(-abs(tval), df)  # two-sided p-value
  return(list(r = r, t = tval, df = df, pval = pval))
}

# Function to test significance of R² using chi-square (LRT style) - For Gaussian
pval_from_R2_gaussian <- function(R2, n, k_full = 3, k_null = 1) {
  # Likelihood ratio statistic from R²
  LR <- - (n * log(1 - R2))   # approx log-likelihood ratio
  LR <- 2 * LR                # standard LR test statistic, transforme la différence de log-vraisemblances en statistique de test χ².
  
  # Degrees of freedom = parameters in full - parameters in null
  df <- k_full - k_null
  
  # p-value from chi-square distribution
  pval <- pchisq(LR, df = df, lower.tail = FALSE)
  
  return(list(LR = LR, df = df, pval = pval))
}
```

#///////Figure 1
Kleaf, Kplant, Kroot, A, gs

##data - using GEXdata dehydration dataset
```{r}
GExdata<-read_xlsx(path = "../data/C3C4 Grasses - GEx_PsifrompVcurves.xlsx", sheet = "C3C4G GEx R")
colnames(GExdata)
GExdata$Dataset<-factor(GExdata$Dataset)
GExdata$Metabolism<-factor(GExdata$Metabolism)
GExdata$Species<-factor(GExdata$Species,levels=c("Avsa","Hovu","Trae","Pegl","Zema","Chga"))
GExdata$Individual<-factor(GExdata$Individual)
GExdata$Leaf<-factor(GExdata$Leaf)
GExdata$Time.min<-factor(GExdata$Time.min)

# variable calculation
GExdata$FW <- as.numeric(GExdata$FW) 
GExdata$DW <- as.numeric(GExdata$DW)
GExdata$RW <- as.numeric(GExdata$RW)
GExdata$RWC<-as.numeric(GExdata$RWC)
GExdata$Psip<-as.numeric(GExdata$Psip)
GExdata$Ps<-as.numeric(GExdata$Ps)
GExdata$`Psileaf from RWC`<-as.numeric(GExdata$`Psileaf from RWC`)
GExdata$An.area <- as.numeric(GExdata$An.area) 
GExdata$gsw.area <- as.numeric(GExdata$gsw.area) 
GExdata$Ci <- as.numeric(GExdata$Ci) 
GExdata$WUEi <- as.numeric(GExdata$WUEi) 
GExdata$phiPSII <- as.numeric(GExdata$phiPSII) 
GExdata$An.mass.LMApv <- as.numeric(GExdata$An.mass.LMApv) 

# subsets
GExdata.0<-subset(GExdata,Time.min=="0") #combines midday and dehydration time = 0 datasets
GExdata.midd<-subset(GExdata,Dataset=="Midday") #time = 0 
GExdata.dehy<-subset(GExdata,Dataset== "Dehydration") #here time varies from 0 to X minutes

# means GEx midday
m.GExdata.midd<-ddply(GExdata.midd,c("Species","Metabolism"),summarise,
            m.An.area=mean(An.area,na.rm=TRUE),n.An.area=sum(!is.na(An.area)),se.An.area=sd(An.area,na.rm=T)/sqrt(n.An.area),
            m.gsw.area=mean(gsw.area,na.rm=TRUE),n.gsw.area=sum(!is.na(gsw.area)),se.gsw.area=sd(gsw.area,na.rm=T)/sqrt(n.gsw.area),
            m.Ci=mean(Ci,na.rm=TRUE),n.Ci=sum(!is.na(Ci)),se.Ci=sd(Ci,na.rm=T)/sqrt(n.Ci),
            m.WUEi=mean(WUEi,na.rm=TRUE),n.WUEi=sum(!is.na(WUEi)),se.WUEi=sd(WUEi,na.rm=T)/sqrt(n.WUEi),
            m.phiPSII=mean(phiPSII,na.rm=TRUE),n.phiPSII=sum(!is.na(phiPSII)),se.phiPSII=sd(phiPSII,na.rm=T)/sqrt(n.phiPSII))

#max values for relative plotting
max.GExdata.dehy<-ddply(GExdata.dehy,c("Species","Metabolism"),summarise,
            max.An.area=max(An.area,na.rm=TRUE),
            max.gsw.area=max(gsw.area,na.rm=TRUE), 
            max_WUEi = max(WUEi, na.rm=TRUE))

#dataset that will look if midday range values are similar to maximum dehydration values
max.GExdata.dehy_long <- max.GExdata.dehy %>%
  rename("A" = "max.An.area", "gs"=  "max.gsw.area", "WUE" = "max_WUEi") %>%
  pivot_longer(cols = c("A" , "gs", "WUE"), values_to = "values" ) %>%
  rename(trait = name) %>%
  mutate(time = "max_dehy")

m.GExdata.midd_long <- GExdata.midd %>%
  dplyr::select("Species", "Metabolism",  "An.area" ,"gsw.area" , "WUEi" ) %>%
   rename("A" = "An.area", "gs"=  "gsw.area", "WUE" = "WUEi") 

A_plot_max_range <- ggplot()+
  geom_boxplot(data = GExdata.midd, aes(x=Species, y=An.area))+
  geom_point(data= max.GExdata.dehy, aes(x= Species, y=max.An.area), color = 'red', size = 2)+
  theme_minimal()+
  ylab(expression(paste("A"[n], " ("*mu*"mol m"^{-2}~"s"^{-1}*")")))
  
A_plot_max_range

g_plot_max_range <- ggplot()+
  geom_boxplot(data = GExdata.midd, aes(x=Species, y=gsw.area))+
  geom_point(data= max.GExdata.dehy, aes(x= Species, y=max.gsw.area), color = 'red', size = 2)+
  theme_minimal()+
    ylab(expression(paste("g"[sw], " (mol m"^{-2}~"s"^{-1}*")")))
  
g_plot_max_range

W_plot_max_range <- ggplot()+
  geom_boxplot(data = GExdata.midd, aes(x=Species, y=WUEi))+
  geom_point(data= max.GExdata.dehy, aes(x= Species, y=max_WUEi), color = 'red', size = 2)+
  theme_minimal()+
    ylab(expression(paste("WUE"[i])))
  
W_plot_max_range

plot_max_range <- ggarrange(A_plot_max_range, g_plot_max_range, W_plot_max_range,ncol = 1 )
```




# Assimilation -fit curves 
```{r eval=FALSE, include=FALSE}
# Avsa -----

#format for fitting for Megan's script
GEx_A_curve_avsa <- GExdata.dehy %>%
  filter(Species =="Avsa") %>%
  mutate(psi_neg =  `Psileaf from RWC`*(-1)) %>%
  dplyr::select(Species, psi_neg, An.area) %>%
  dplyr::rename(psi = psi_neg) %>%
  dplyr::rename(gs = An.area) %>% #for the script by Megan
  dplyr::rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()

# Hovu -------

GEx_A_curve_hovu <- GExdata.dehy %>%
  filter(Species =="Hovu") %>%
  mutate(psi_neg =  `Psileaf from RWC`*(-1)) %>%
  dplyr::select(Species, psi_neg, An.area ) %>%
  dplyr::rename(psi = psi_neg) %>%
  dplyr::rename(gs = An.area) %>% #for the script by Megan
  dplyr::rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()


# Trae -------

GEx_A_curve_trae <- GExdata.dehy %>%
  filter(Species =="Trae") %>%
  mutate(psi_neg =  `Psileaf from RWC`*(-1)) %>%
  dplyr::select(Species, psi_neg, An.area ) %>%
  dplyr::rename(psi = psi_neg) %>%
  dplyr::rename(gs = An.area) %>% #for the script by Megan
  dplyr::rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()  

# Pegl ----------

GEx_A_curve_pegl <- GExdata.dehy %>%
  filter(Species =="Pegl") %>%
  mutate(psi_neg =  `Psileaf from RWC`*(-1)) %>%
  dplyr::select(Species, psi_neg, An.area) %>%
  dplyr::rename(psi = psi_neg) %>%
  dplyr::rename(gs = An.area) %>% #for the script by Megan
  dplyr::rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()

# Chga -----------

GEx_A_curve_chga <- GExdata.dehy %>%
  filter(Species =="Chga") %>%
  mutate(psi_neg =  `Psileaf from RWC`*(-1)) %>%
  dplyr::select(Species, psi_neg, An.area ) %>%
  dplyr::rename(psi = psi_neg) %>%
  dplyr::rename(gs = An.area) %>% #for the script by Megan
  dplyr::rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()

# Zema ----------


GEx_A_curve_zema <- GExdata.dehy %>%
  filter(Species =="Zema") %>%
  mutate(psi_neg =  `Psileaf from RWC`*(-1)) %>%
  dplyr::select(Species, psi_neg, An.area ) %>%
  dplyr::rename(psi = psi_neg) %>%
  dplyr::rename(gs = An.area) %>% #for the script by Megan
  dplyr::rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()

#after fitting curve with "Closure Script 2017 for FvFm" and "R function MB 2017 for FvFm"

A <- rbind(GEx_A_curve_avsa, GEx_A_curve_hovu, GEx_A_curve_trae, GEx_A_curve_pegl, GEx_A_curve_zema, GEx_A_curve_chga)

write.csv(x = A, file = "../results/A/A.csv")
```

##AVSA - plot assimilation
```{r}
avsa_A_sig <-  read.csv("../results/A/model_fitting_results.csv") %>% #best model sigmodoidal
  filter(Species == 'Avsa') %>%
  filter(model == 'Sigmoidal')

data_avsa <- GExdata.dehy %>%
  filter(Species == 'Avsa')

x_seq.avsa_A <- seq(0.1, 2, by=0.01)*(-1)
x_seq.avsa_A

# Correct the sign of the inflection point
C <- -avsa_A_sig$C
B <- -avsa_A_sig$B
A <- avsa_A_sig$A

# Recalculate the model
y_model.avsa_A_sigmoidal <- A / (1 + exp(-((x_seq.avsa_A - C) / B)))

avsa_A50= (-avsa_A_sig$B*(log(1+exp((avsa_A_sig$C/avsa_A_sig$B)-0.5)/0.5))+avsa_A_sig$C)*-1 


Avsa_GEx_A<-ggplot()+
 geom_point(data=data_avsa,aes(x=`Psileaf from RWC`,y=An.area/avsa_A_sig$Kmax_at_0.1MPa*100),size=5,color="black")+
 geom_line(aes(x = x_seq.avsa_A, y = y_model.avsa_A_sigmoidal/avsa_A_sig$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("A. sativa")+
   ylab(expression(paste("relative A"[n],", (%)")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,101)
Avsa_GEx_A

    
Avsa_GEx_A_SI<-ggplot()+
 geom_point(data=data_avsa,aes(x=`Psileaf from RWC`,y=An.area),size=5,color="#6DB9F8", alpha = 0.3)+
 geom_line(aes(x = x_seq.avsa_A, y = y_model.avsa_A_sigmoidal), color = '#6DB9F8', size=1.5)+
  #geom_point(data= GExdata.midd %>% filter(Species == "Avsa"), aes(x= F.wp.leaf, y=An.area), color = 'red', size = 4, alpha = 0.3)+
  geom_vline(xintercept = avsa_A_sig$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_text(size=14),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
  # ggtitle("A. sativa")+
  ylab(expression(paste("A"[n], " ("*mu*"mol m"^{-2}~"s"^{-1}*")")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,45)
Avsa_GEx_A_SI
```

##HOVU plot assimilation
```{r}
hovu_A_sig <-  read.csv("../results/A/model_fitting_results.csv") %>% #best model sigmodoidal
  filter(Species == 'Hovu') %>%
  filter(model == 'Sigmoidal')

data_hovu <- GExdata.dehy %>%
  filter(Species == 'Hovu')

x_seq.hovu_A <- seq(0.1, 2, by=0.01)*(-1)

# Correct the sign of the inflection point
C <- -hovu_A_sig$C
B<- -hovu_A_sig$B
A <- hovu_A_sig$A

# Recalculate the model
y_model.hovu_A_sigmoidal <- A / (1 + exp(-((x_seq.hovu_A - C) / B)))

hovu_A50= (-hovu_A_sig$B*(log(1+exp((hovu_A_sig$C/hovu_A_sig$B)-0.5)/0.5))+hovu_A_sig$C)*-1 

Hovu_GEx_A<-ggplot()+
  geom_point(data=data_hovu,aes(x=`Psileaf from RWC`,y=An.area/hovu_A_sig$Kmax_at_0.1MPa*100),size=5,color="black")+
  geom_line(aes(x = x_seq.hovu_A, y = y_model.hovu_A_sigmoidal/hovu_A_sig$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
  # ggtitle("H. vulgare")+
   ylab(expression(paste("relative A"[n],", (%)")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
ylim(0,101)
Hovu_GEx_A

Hovu_GEx_A_SI<-ggplot()+
 geom_point(data=data_hovu,aes(x=`Psileaf from RWC`,y=An.area),size=5,color="#6DB9F8", alpha = 0.3)+
 geom_line(aes(x = x_seq.hovu_A, y = y_model.hovu_A_sigmoidal), color = '#6DB9F8', size=1.5)+
  # geom_point(data= GExdata.midd %>% filter(Species == "Hovu"), aes(x= F.wp.leaf, y=An.area), color = 'red', size = 4, alpha = 0.3)+
    geom_vline(xintercept = hovu_A_sig$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_text(size=14),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
#   ggtitle("H. vulgare")+
ylab(expression(paste("A"[n], " ("*mu*"mol m"^{-2}~"s"^{-1}*")")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,45)
Hovu_GEx_A_SI

```

##TRAE - plot assimilation
```{r}
trae_A_sig <-  read.csv("../results/A/model_fitting_results.csv") %>% #best model sigmodoidal
  filter(Species == 'Trae') %>%
  filter(model == 'Sigmoidal')

data_trae <- GExdata.dehy %>%
  filter(Species == 'Trae')

x_seq.trae_A <- seq(0.1, 2, by=0.01)*(-1)

# Correct the sign of the inflection point
C <- -trae_A_sig$C
B <- -trae_A_sig$B
A <- trae_A_sig$A

# Recalculate the model
y_model.trae_A_sigmoidal <- A / (1 + exp(-((x_seq.trae_A - C) / B)))

trae_A50= (-trae_A_sig$B*(log(1+exp((trae_A_sig$C/trae_A_sig$B)-0.5)/0.5))+trae_A_sig$C)*-1 

trae_GEx_A<-ggplot()+
  geom_point(data=data_trae,aes(x=`Psileaf from RWC`,y=An.area/trae_A_sig$Kmax_at_0.1MPa*100),size=5,color="black")+
  geom_line(aes(x = x_seq.trae_A, y = y_model.trae_A_sigmoidal/trae_A_sig$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("T. aestivum")+
   ylab(expression(paste("relative A"[n],", (%)")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
ylim(0,101)
trae_GEx_A


Trae_GEx_A_SI<-ggplot()+
 geom_point(data=data_trae,aes(x=`Psileaf from RWC`,y=An.area),size=5,color="#6DB9F8", alpha = 0.3)+
 geom_line(aes(x = x_seq.trae_A, y = y_model.trae_A_sigmoidal), color = '#6DB9F8', size=1.5)+
 # geom_point(data= GExdata.midd %>% filter(Species == "Trae"), aes(x= F.wp.leaf, y=An.area), color = 'red', size = 4, alpha = 0.3)+
    geom_vline(xintercept = trae_A_sig$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_text(size=14),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   # ggtitle("T. aestivum")+
ylab(expression(paste("A"[n], " ("*mu*"mol m"^{-2}~"s"^{-1}*")")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,45)
Trae_GEx_A_SI
```


##PEGL - plot assimilation

```{r}
Pegl_A_sig <-  read.csv("../results/A/model_fitting_results.csv") %>% #best model sigmodoidal
  filter(Species == 'Pegl') %>%
  filter(model == 'Sigmoidal')

data_Pegl <- GExdata.dehy %>%
  filter(Species == 'Pegl')

x_seq.Pegl_A <- seq(0.1, 2, by=0.01)*(-1)
x_seq.Pegl_A

# Correct the sign of the inflection point
C <- -Pegl_A_sig$C
B <- -Pegl_A_sig$B
A <- Pegl_A_sig$A

# Recalculate the model
y_model.Pegl_A_sigmoidal <- A / (1 + exp(-((x_seq.Pegl_A - C) / B)))

Pegl_A50= (-Pegl_A_sig$B*(log(1+exp((Pegl_A_sig$C/Pegl_A_sig$B)-0.5)/0.5))+Pegl_A_sig$C)*-1 

Pegl_GEx_A<-ggplot()+
  geom_point(data=data_Pegl,aes(x=`Psileaf from RWC`,y=An.area/Pegl_A_sig$Kmax_at_0.1MPa*100),size=5,color="black")+
  geom_line(aes(x = x_seq.Pegl_A, y = y_model.Pegl_A_sigmoidal/Pegl_A_sig$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
         axis.title.x=element_text(size=20),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("P. glaucum")+
   ylab(expression(paste("relative A"[n],", (%)")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,101)
Pegl_GEx_A

Pegl_GEx_A_SI<-ggplot()+
 geom_point(data=data_Pegl,aes(x=`Psileaf from RWC`,y=An.area),size=5,color="#D9AB33", alpha = 0.3)+
 geom_line(aes(x = x_seq.Pegl_A, y = y_model.Pegl_A_sigmoidal), color = '#D9AB33', size=1.5)+
  # geom_point(data= GExdata.midd %>% filter(Species == "Pegl"), aes(x= F.wp.leaf, y=An.area), color = 'red', size = 4, alpha = 0.3)+
    geom_vline(xintercept = Pegl_A_sig$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_text(size=14),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
 #  ggtitle("P. glaucum")+
ylab(expression(paste("A"[n], " ("*mu*"mol m"^{-2}~"s"^{-1}*")")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,45)
Pegl_GEx_A_SI
```

##CHGA - plot assimilation

```{r}

chga_A_sig <-  read.csv("../results/A/model_fitting_results.csv") %>% #best model sigmodoidal
  filter(Species == 'Chga') %>%
  filter(model == 'Sigmoidal')

data_chga <- GExdata.dehy %>%
  filter(Species == 'Chga')

x_seq.chga_A <- seq(0.1, 2, by=0.01)*(-1)
x_seq.chga_A

# Correct the sign of the inflection point
C <- -chga_A_sig$C
B <- -chga_A_sig$B
A <- chga_A_sig$A

# Recalculate the model
y_model.chga_A_sigmoidal <- A / (1 + exp(-((x_seq.chga_A - C) / B)))

chga_A50= (-chga_A_sig$B*(log(1+exp((chga_A_sig$C/chga_A_sig$B)-0.5)/0.5))+chga_A_sig$C)*-1 


Chga_GEx_A<-ggplot()+
 geom_point(data=data_chga,aes(x=`Psileaf from RWC`,y=An.area/chga_A_sig$Kmax_at_0.1MPa*100),size=5,color="black")+
  geom_line(aes(x = x_seq.chga_A, y = y_model.chga_A_sigmoidal/chga_A_sig$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
         axis.title.x=element_text(size=20),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("C. gayan")+
   ylab(expression(paste("relative A"[n],", (%)")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,101)

Chga_GEx_A

Chga_GEx_A_SI<-ggplot()+
 geom_point(data=data_chga,aes(x=`Psileaf from RWC`,y=An.area),size=5,color="#D9AB33", alpha = 0.3)+
 geom_line(aes(x = x_seq.chga_A, y = y_model.chga_A_sigmoidal), color = '#D9AB33', size=1.5)+
  # geom_point(data= GExdata.midd %>% filter(Species == "Chga"), aes(x= F.wp.leaf, y=An.area), color = 'red', size = 4, alpha = 0.3)+
    geom_vline(xintercept = chga_A_sig$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_text(size=14),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
#    ggtitle("C. gayan")+
ylab(expression(paste("A"[n], " ("*mu*"mol m"^{-2}~"s"^{-1}*")")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,45)
Chga_GEx_A_SI
```

##ZEMA - plot assimilation
```{r}

zema_A_sig <- read.csv("../results/A/model_fitting_results.csv") %>% #best model sigmodoidal
  filter(Species == 'Zema') %>%
  filter(model == 'Sigmoidal')

data_zema <- GExdata.dehy %>%
  filter(Species == 'Zema')

x_seq.zema_A <- seq(0.1, 2, by=0.01)*(-1)
x_seq.zema_A

# Correct the sign of the inflection point
C <- -zema_A_sig$C
B <- -zema_A_sig$B
A <- zema_A_sig$A

# Recalculate the model
y_model.zema_A_sigmoidal <- A / (1 + exp(-((x_seq.zema_A - C) / B)))

zema_A50= (-zema_A_sig$B*(log(1+exp((zema_A_sig$C/zema_A_sig$B)-0.5)/0.5))+zema_A_sig$C)*-1 

Zema_GEx_A<-ggplot()+
  geom_point(data=data_zema,aes(x=`Psileaf from RWC`,y=An.area/zema_A_sig$Kmax_at_0.1MPa*100),size=5,color="black")+
  geom_line(aes(x = x_seq.zema_A, y = y_model.zema_A_sigmoidal/zema_A_sig$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_text(size=20),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("Z. mays")+
   ylab(expression(paste("relative A"[n],", (%)")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,101)
 
Zema_GEx_A

Zema_GEx_A_SI<-ggplot()+
 geom_point(data=data_zema,aes(x=`Psileaf from RWC`,y=An.area),size=5,color="#D9AB33", alpha = 0.3)+
 geom_line(aes(x = x_seq.zema_A, y = y_model.zema_A_sigmoidal), color = '#D9AB33', size=1.5)+
  # geom_point(data= GExdata.midd %>% filter(Species == "Zema"), aes(x= F.wp.leaf, y=An.area), color = 'red', size = 4, alpha = 0.3)+
    geom_vline(xintercept = zema_A_sig$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_text(size=14),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
 # ggtitle("Z. mays")+
ylab(expression(paste("A"[n], " ("*mu*"mol m"^{-2}~"s"^{-1}*")")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,45)
Zema_GEx_A_SI
```


#gs -fit curves 
```{r}
# Avsa ------

GEx_g_curve_avsa <- GExdata.dehy %>%
  filter(Species =="Avsa") %>%
  mutate(psi_neg =  `Psileaf from RWC`*(-1)) %>%
  dplyr::select(Species, `psi_neg`,  gsw.area ) %>%
  dplyr::rename(psi = `psi_neg`) %>%
  dplyr::rename(gs =  `gsw.area`) %>% #for the script by Megan
  dplyr::rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()

write.csv(x = GEx_g_curve_avsa, file = "../results/GEx_g_curve_avsa.csv") #ready for 

#after fitting curve with "Closure Script 2017 for FvFm" and "R function MB 2017 for FvFm"

# Hovu ---------

GEx_g_curve_hovu <- GExdata.dehy %>%
  filter(Species =="Hovu") %>%
  mutate(psi_neg =  `Psileaf from RWC`*(-1)) %>%
  dplyr::select(Species, psi_neg,  gsw.area ) %>%
  dplyr::rename(psi = psi_neg) %>%
  dplyr::rename(gs =  gsw.area) %>% #for the script by Megan
  dplyr::rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()

write.csv(x = GEx_g_curve_hovu, file = "../results/GEx_g_curve_hovu.csv")

# Trae -----------

GEx_g_curve_trae <- GExdata.dehy %>%
  filter(Species =="Trae") %>%
  mutate(psi_neg =  `Psileaf from RWC`*(-1)) %>%
  dplyr::select(Species, psi_neg,  gsw.area ) %>%
  dplyr::rename(psi = psi_neg) %>%
  dplyr::rename(gs =  gsw.area) %>% #for the script by Megan
  dplyr::rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()

write.csv(x = GEx_g_curve_trae, file = "../results/GEx_g_curve_trae.csv")

# Pegl ----------

GEx_g_curve_pegl <- GExdata.dehy %>%
  filter(Species =="Pegl") %>%
  mutate(psi_neg =  `Psileaf from RWC`*(-1)) %>%
  dplyr::select(Species, psi_neg,  gsw.area) %>%
  dplyr::rename(psi = psi_neg) %>%
  dplyr::rename(gs =  gsw.area) %>% #for the script by Megan
  dplyr::rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()

write.csv(x = GEx_g_curve_pegl, file = "../results/GEx_g_curve_pegl.csv")

# Chga -------------

GEx_g_curve_chga <- GExdata.dehy %>%
  filter(Species =="Chga") %>%
  mutate(psi_neg =  `Psileaf from RWC`*(-1)) %>%
  dplyr::select(Species, psi_neg,  gsw.area ) %>%
  dplyr::rename(psi = psi_neg) %>%
  dplyr::rename(gs =  gsw.area) %>% #for the script by Megan
  dplyr::rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()

write.csv(x = GEx_g_curve_chga, file = "../results/GEx_g_curve_chga.csv")

# Zema ----------
GEx_g_curve_zema <- GExdata.dehy %>%
  filter(Species =="Zema") %>%
  mutate(psi_neg =  `Psileaf from RWC`*(-1)) %>%
  dplyr::select(Species, psi_neg,  gsw.area ) %>%
  dplyr::rename(psi = psi_neg) %>%
  dplyr::rename(gs =  gsw.area) %>% #for the script by Megan
  dplyr::rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()

write.csv(x = GEx_g_curve_zema, file = "../results/GEx_g_curve_zema.csv")

gs <- rbind(GEx_g_curve_avsa, GEx_g_curve_hovu, GEx_g_curve_trae, GEx_g_curve_chga, GEx_g_curve_pegl, GEx_g_curve_zema)

write.csv(x = gs, file = "../results/gs/gs.csv")
```

## AVSA - plot conductance
```{r}
avsa_g_sig <-  read.csv("../results/gs/model_fitting_results.csv") %>% #best model sigmodoidal
  filter(Species == 'Avsa') %>%
  filter(model == 'Sigmoidal')

data_avsa <- GExdata.dehy %>%
  filter(Species == 'Avsa')

x_seq.avsa <- seq(0.1, 2, by=0.01)*(-1)
x_seq.avsa

# Correct the sign of the inflection point
C <- -avsa_g_sig$C
B <- -avsa_g_sig$B
A <- avsa_g_sig$A

# Recalculate the model
y_model.avsa_g_sigmoidal <- A / (1 + exp(-((x_seq.avsa - C) / B)))

avsa_g50= (-avsa_g_sig$B*(log(1+exp((avsa_g_sig$C/avsa_g_sig$B)-0.5)/0.5))+avsa_g_sig$C)*-1 

Avsa_GEx_g<-ggplot()+
  geom_point(data=data_avsa,aes(x=`Psileaf from RWC`,y=gsw.area/avsa_g_sig$Kmax_at_0.1MPa*100),size=5,color="black")+
  geom_line(aes(x = x_seq.avsa, y = y_model.avsa_g_sigmoidal/avsa_g_sig$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("A. sativa")+
   ylab(expression(paste("relative g"[sw],", (%)")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,101)

  Avsa_GEx_g

Avsa_GEx_g_SI<-ggplot()+
 geom_point(data=data_avsa,aes(x=`Psileaf from RWC`,y=gsw.area),size=5,color="#6DB9F8", alpha = 0.3)+
   geom_line(aes(x = x_seq.avsa, y = y_model.avsa_g_sigmoidal), color = '#6DB9F8', size=1.5)+
  # geom_point(data= GExdata.midd %>% filter(Species == "Avsa"), aes(x= F.wp.leaf, y=gsw.area), color = 'red', size = 4, alpha = 0.3)+
    geom_vline(xintercept = avsa_g_sig$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
  # ggtitle("A. sativa")+
   ylab(expression(atop(g[s], "(mol" ~ m^{-2} ~ s^{-1}*")")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,0.65)

Avsa_GEx_g_SI
```

## HOVU plot conductance
```{r}
hovu_g_sig <-  read.csv("../results/gs/model_fitting_results.csv") %>% #best model sigmodoidal
  filter(Species == 'Hovu') %>%
  filter(model == 'Sigmoidal')

data_hovu <- GExdata.dehy %>%
  filter(Species == 'Hovu')

x_seq.hovu <- seq(0.1, 2, by=0.01)*(-1)
x_seq.hovu

# Correct the sign of the inflection point
C <- -hovu_g_sig$C
B <- -hovu_g_sig$B
A <- hovu_g_sig$A

# Recalculate the model
y_model.hovu_g_sigmoidal <- A / (1 + exp(-((x_seq.hovu - C) / B)))

hovu_g50= (-hovu_g_sig$B*(log(1+exp((hovu_g_sig$C/hovu_g_sig$B)-0.5)/0.5))+hovu_g_sig$C)*-1 

Hovu_GEx_g<-ggplot()+
  geom_point(data=data_hovu,aes(x=`Psileaf from RWC`,y=gsw.area/hovu_g_sig$Kmax_at_0.1MPa*100),size=5,color="black")+
  geom_line(aes(x = x_seq.hovu, y = y_model.hovu_g_sigmoidal/hovu_g_sig$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("H. vulgare")+
   ylab(expression(paste("relative g"[sw],", (%)")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,101)

Hovu_GEx_g

Hovu_GEx_g_SI<-ggplot()+
 geom_point(data=data_hovu,aes(x=`Psileaf from RWC`,y=gsw.area),size=5,color="#6DB9F8", alpha = 0.3)+
   geom_line(aes(x = x_seq.hovu, y = y_model.hovu_g_sigmoidal), color = '#6DB9F8', size=1.5)+
   #geom_point(data= GExdata.midd %>% filter(Species == "Hovu"), aes(x= F.wp.leaf, y=gsw.area), color = 'red', size = 4, alpha = 0.3)+
   geom_vline(xintercept = hovu_g_sig$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
  #  ggtitle("H. vulgare")+
    ylab(expression(paste("g"[sw], " (mol m"^{-2}~"s"^{-1}*")")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,0.65)

Hovu_GEx_g_SI
```

## TRAE - plot conductance
```{r}
trae_g_sig <-  read.csv("../results/gs/model_fitting_results.csv") %>% #best model sigmodoidal
  filter(Species == 'Trae') %>%
  filter(model == 'Sigmoidal')

data_trae <- GExdata.dehy %>%
  filter(Species == 'Trae')

x_seq.trae <- seq(0.1, 2, by=0.01)*(-1)
x_seq.trae

# Correct the sign of the inflection point
C <- -trae_g_sig$C
B <- -trae_g_sig$B
A <- trae_g_sig$A

# Recalculate the model
y_model.trae_g_sigmoidal <- A / (1 + exp(-((x_seq.trae - C) / B)))

trae_g50= (-trae_g_sig$B*(log(1+exp((trae_g_sig$C/trae_g_sig$B)-0.5)/0.5))+trae_g_sig$C)*-1 

Trae_GEx_g<-ggplot()+
 geom_point(data=data_trae,aes(x=`Psileaf from RWC`,y=gsw.area/trae_g_sig$Kmax_at_0.1MPa*100),size=5, color="black")+
  geom_line(aes(x = x_seq.trae, y = y_model.trae_g_sigmoidal/trae_g_sig$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("T. aestivum")+
   ylab(expression(paste("relative g"[sw],", (%)")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
xlim(0,-1.6)+
  ylim(0,101)
 

Trae_GEx_g

Trae_GEx_g_SI<-ggplot()+
 geom_point(data=data_trae,aes(x=`Psileaf from RWC`,y=gsw.area),size=5,color="#6DB9F8", alpha = 0.3)+
   geom_line(aes(x = x_seq.trae, y = y_model.trae_g_sigmoidal), color = '#6DB9F8', size=1.5)+
#   geom_point(data= GExdata.midd %>% filter(Species == "Trae"), aes(x= F.wp.leaf, y=gsw.area), color = 'red', size = 4, alpha = 0.3)+
   geom_vline(xintercept = trae_g_sig$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
#   ggtitle("T. aestivum")+
   ylab(expression(paste("g"[sw], " (mol m"^{-2}~"s"^{-1}*")")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,0.65)

Trae_GEx_g_SI

```

## CHGA - plot conductance
```{r}
  
chga_g_sig <-  read.csv("../results/gs/model_fitting_results.csv") %>% #best model sigmodoidal
  filter(Species == 'Chga') %>%
  filter(model == 'Sigmoidal')

data_chga <- GExdata.dehy %>%
  filter(Species == 'Chga')

x_seq.chga <- seq(0.1, 2, by=0.01)*(-1)
x_seq.chga

# Correct the sign of the inflection point
C <- -chga_g_sig$C
B <- -chga_g_sig$B
A <- chga_g_sig$A

# Recalculate the model
y_model.chga_g_sigmoidal <- A / (1 + exp(-((x_seq.chga - C) / B)))

chga_g50= (-chga_g_sig$B*(log(1+exp((chga_g_sig$C/chga_g_sig$B)-0.5)/0.5))+chga_g_sig$C)*-1 


Chga_GEx_g<-ggplot()+
  geom_point(data=data_chga,aes(x=`Psileaf from RWC`,y=gsw.area/chga_g_sig$Kmax_at_0.1MPa*100),size=5, color="black")+
   geom_line(aes(x = x_seq.chga, y = y_model.chga_g_sigmoidal/chga_g_sig$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
         axis.title.x=element_text(size=20),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("C. gayan")+
   ylab(expression(paste("relative g"[sw],", (%)")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
 xlim(0,-1.6)+
  ylim(0,101)
 
Chga_GEx_g


Chga_GEx_g_SI<-ggplot()+
 geom_point(data=data_chga,aes(x=`Psileaf from RWC`,y=gsw.area),size=5,color="#D9AB33", alpha = 0.3)+
   geom_line(aes(x = x_seq.chga, y = y_model.chga_g_sigmoidal), color = '#D9AB33', size=1.5)+
 #  geom_point(data= GExdata.midd %>% filter(Species == "Chga"), aes(x= F.wp.leaf, y=gsw.area), color = 'red', size = 4, alpha = 0.3)+
   geom_vline(xintercept = chga_g_sig$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
  # ggtitle("C. gayan")+
   ylab(expression(paste("g"[sw], " (mol m"^{-2}~"s"^{-1}*")")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,0.65)

Chga_GEx_g_SI

```

## PEGL - plot conductance
```{r}
pegl_g_sig <-  read.csv("../results/gs/model_fitting_results.csv") %>% #best model sigmodoidal
  filter(Species == 'Pegl') %>%
  filter(model == 'Sigmoidal')

data_pegl <- GExdata.dehy %>%
  filter(Species == 'Pegl')

x_seq.pegl <- seq(0.1, 2, by=0.01)*(-1)
x_seq.pegl

# Correct the sign of the inflection point
C <- -pegl_g_sig$C
B <- -pegl_g_sig$B
A <- pegl_g_sig$A

# Recalculate the model
y_model.pegl_g_sigmoidal <- A / (1 + exp(-((x_seq.pegl - C) / B)))

pegl_g50= (-pegl_g_sig$B*(log(1+exp((pegl_g_sig$C/pegl_g_sig$B)-0.5)/0.5))+pegl_g_sig$C)*-1 


Pegl_GEx_g<-ggplot()+
  geom_point(data=GExdata.dehy[GExdata.dehy$Species=="Pegl",],aes(x=`Psileaf from RWC`,y=gsw.area/pegl_g_sig$Kmax_at_0.1MPa*100),size=5, color="black")+
   geom_line(aes(x = x_seq.pegl, y = y_model.pegl_g_sigmoidal/pegl_g_sig$Kmax_at_0.1MPa*100), color = 'black', size=3)+
   geom_vline(xintercept = pegl_g_sig$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
         axis.title.x=element_text(size=20),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("P. glaucum")+
   ylab(expression(paste("relative g"[sw],", (%)")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,101)
  
Pegl_GEx_g


Pegl_GEx_g_SI<-ggplot()+
 geom_point(data=data_pegl,aes(x=`Psileaf from RWC`,y=gsw.area),size=5,color="#D9AB33", alpha = 0.3)+
   geom_line(aes(x = x_seq.pegl, y = y_model.pegl_g_sigmoidal), color = '#D9AB33', size=1.5)+
#   geom_point(data= GExdata.midd %>% filter(Species == "Pegl"), aes(x= F.wp.leaf, y=gsw.area), color = 'red', size = 4, alpha = 0.3)+
   geom_vline(xintercept = pegl_g_sig$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
 #  ggtitle("P. glaucum")+
   ylab(expression(paste("g"[sw], " (mol m"^{-2}~"s"^{-1}*")")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,0.65)

Pegl_GEx_g_SI
 
```

## ZEMA - plot conductance
```{r}

zema_g_sig <-  read.csv("../results/gs/model_fitting_results.csv") %>% #best model sigmodoidal
  filter(Species == 'Zema') %>%
  filter(model == 'Linear')

data_zema <- GExdata.dehy %>%
  filter(Species == 'Zema')

x_seq.zema <-seq(0.1, 2, by=0.01)*(-1)
x_seq.zema

# Correct the sign of the inflection point
C <- -zema_g_sig$C
B <- -zema_g_sig$B
A <- zema_g_sig$A

# Recalculate the model
y_model.zema_g_sigmoidal <- A + x_seq.zema * B

Zema_GEx_g<-ggplot()+
   geom_point(data=data_zema,aes(x=`Psileaf from RWC`,y=gsw.area/zema_g_sig$Kmax_at_0.1MPa*100),size=5, color="black")+
  geom_line(aes(x = x_seq.zema, y = y_model.zema_g_sigmoidal/zema_g_sig$Kmax_at_0.1MPa*100), color = 'black', size=2)+
   geom_vline(xintercept = zema_g_sig$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_text(size=20),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("Z. mays")+
   ylab(expression(paste("relative g"[sw],", (%)")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,101)
 
Zema_GEx_g


Zema_GEx_g_SI<-ggplot()+
 geom_point(data=data_zema,aes(x=`Psileaf from RWC`,y=gsw.area),size=5,color="#D9AB33", alpha = 0.3)+
   geom_line(aes(x = x_seq.zema, y = y_model.zema_g_sigmoidal), color = '#D9AB33', size=1.5)+
  # geom_point(data= GExdata.midd %>% filter(Species == "Zema"), aes(x= F.wp.leaf, y=gsw.area), color = 'red', size = 4, alpha = 0.3)+
   geom_vline(xintercept = zema_g_sig$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
#  ggtitle("Z. mays")+
  ylab(expression(paste("g"[sw], " (mol m"^{-2}~"s"^{-1}*")")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,0.65)

Zema_GEx_g_SI
```

#WUE - fit curves
```{r}
WUE <- GExdata.dehy %>%
  mutate(psi_neg =  `Psileaf from RWC`*(-1)) %>%
  dplyr::select(Species, `psi_neg`,  WUEi ) %>%
  filter(WUEi >0) %>%
  dplyr::rename(psi = `psi_neg`) %>%
  dplyr::rename(gs =  `WUEi`) %>% #for the script 
  dplyr::rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()

write.csv(x = WUE, file = "../results/WUE/WUE_curve.csv")
```

##AVSA - plot WUE
```{r}
data_W_avsa <- GExdata.dehy %>% 
  filter(Species == "Avsa") %>%
  dplyr::select(Species, Metabolism, WUEi, `Psileaf from RWC`) %>%
  filter(WUEi >0)

avsa_W<-  read.csv("../results/WUE/model_fitting_results.csv") %>% 
  filter(Species == 'Avsa') 

x_seq.avsa_W <- seq(0.1, 2, by=0.01)
x_seq.avsa_W


avsa_W$rsq

pval_from_R2_gaussian(R2 = avsa_W$rsq, n = length(data_W_avsa$`Psileaf from RWC`))
pval_from_R2_regression(R2 = avsa_W$rsq, n = length(data_W_avsa$`Psileaf from RWC`))

#it's like an anova actually
# Observed data
y <- data_W_avsa$WUEi
psi <- data_W_avsa$`Psileaf from RWC`

# Nonlinear Gaussian fit
full_model <- nls(y ~ a * exp(-(psi - mu)^2 / (2 * sigma^2)),
  start = list(a = max(y),mu = mean(psi),sigma = 1),control = nls.control(maxiter = 1000, warnOnly = TRUE))
null_model <- nls(y ~ m,start = list(m = mean(y)))
anova(full_model, null_model, test= "LRT")
anova(full_model, null_model, test= "Chisq")



# Recalculate the model
y_model.avsa_W <- avsa_W$a * exp(-(x_seq.avsa_W - avsa_W$mu)^2 / (2 * avsa_W$sigma^2))

avsa_W_plot<-ggplot()+
 geom_point(data=data_W_avsa,aes(x=`Psileaf from RWC`,y=WUEi),size=5,color="#56B4E9", alpha = 0.7)+
 geom_line(aes(x = x_seq.avsa_W *(-1), y = y_model.avsa_W), color = '#56B4E9', size=3)+
  geom_vline(xintercept = avsa_W$mu*(-1), linetype = 2, linewidth = 1.5)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("A. sativa")+
   annotate("text", x = -2, y =200, label = "r² = 0.37", size = 5)+
  annotate("text", x = -2, y =170, label = as.character(expression(P < 0.001)), size = 5)+
   ylab(expression(paste("WUE"[i])))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-3)+
  ylim(0,252)
  
avsa_W_plot
```

##HOVU - plot WUE
```{r}
data_W_hovu <- GExdata.dehy %>% 
  filter(Species == "Hovu") %>%
  dplyr::select(Species, Metabolism, WUEi, `Psileaf from RWC`)%>%
  filter(WUEi >0)

hovu_W<-  read.csv("../results/WUE/model_fitting_results.csv") %>% 
  filter(Species == 'Hovu') 

x_seq.hovu_W <- seq(0.1, 2, by=0.01)
x_seq.hovu_W

hovu_W$rsq

pval_from_R2_gaussian(R2 = hovu_W$rsq, n = length(data_W_hovu$`Psileaf from RWC`))
pval_from_R2_regression(R2 = hovu_W$rsq, n = length(data_W_hovu$`Psileaf from RWC`))

# Recalculate the model
y_model.hovu_W <- hovu_W$a * exp(-(x_seq.hovu_W - hovu_W$mu)^2 / (2 * hovu_W$sigma^2))

hovu_W_plot<-ggplot()+
 geom_point(data=data_W_hovu,aes(x=`Psileaf from RWC`,y=WUEi),size=5,color="#56B4E9", alpha = 0.7)+
 geom_line(aes(x = x_seq.hovu_W *(-1), y = y_model.hovu_W), color = '#56B4E9', size=3)+
  geom_vline(xintercept = hovu_W$mu*(-1), linetype = 2, linewidth = 1.5)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("H. vulgare")+
  annotate("text", x = -2, y =200, label = "r² = 0.21", size = 5)+
   annotate("text", x = -2, y =170, label = as.character(expression(P < 0.001)), size = 5)+
   ylab(expression(paste("WUE"[i])))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-3)+
  ylim(0,252)
hovu_W_plot
```

##TRAE - plot WUE
```{r}
data_W_trae <- GExdata.dehy %>% 
  filter(Species == "Trae") %>%
  dplyr::select(Species, Metabolism, WUEi, `Psileaf from RWC`)%>%
  filter(WUEi >0)

trae_W<-  read.csv("../results/WUE/model_fitting_results.csv") %>% 
  filter(Species == 'Trae') 

x_seq.trae_W <- seq(0.1, 2, by=0.01)
x_seq.trae_W

trae_W$rsq

pval_from_R2_gaussian(R2 = trae_W$rsq, n = length(data_W_trae$`Psileaf from RWC`))
pval_from_R2_regression(R2 = trae_W$rsq, n = length(data_W_trae$`Psileaf from RWC`))

# Recalculate the model
y_model.trae_W <- trae_W$a * exp(-(x_seq.trae_W - trae_W$mu)^2 / (2 * trae_W$sigma^2))

trae_W_plot<-ggplot()+
 geom_point(data=data_W_trae,aes(x=`Psileaf from RWC`,y=WUEi),size=5,color="#56B4E9", alpha = 0.7)+
 geom_line(aes(x = x_seq.trae_W *(-1), y = y_model.trae_W), color = '#56B4E9', size=2)+
  geom_vline(xintercept = trae_W$mu*(-1), linetype = 2, linewidth = 1.5)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_text(size=14),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("T. aestivum")+
  annotate("text", x = -2, y =200, label = "r² = 0.16", size = 5)+
   annotate("text", x = -2, y =170, label = as.character(expression(P < 0.01)), size = 5)+
   ylab(expression(paste("WUE"[i])))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-3)+
  ylim(0,252)
trae_W_plot
```

##CHGA - plot WUE

```{r}
data_W_chga <- GExdata.dehy %>% 
  filter(Species == "Chga") %>%
  dplyr::select(Species, Metabolism, WUEi, `Psileaf from RWC`)%>%
  filter(WUEi >0)

chga_W<-  read.csv("../results/WUE/model_fitting_results.csv") %>% 
  filter(Species == 'Chga') 

x_seq.chga_W <- seq(0.1, 2, by=0.01)
x_seq.chga_W

chga_W$rsq

pval_from_R2_gaussian(R2 = chga_W$rsq, n = length(data_W_chga$`Psileaf from RWC`))
pval_from_R2_regression(R2 = chga_W$rsq, n = length(data_W_chga$`Psileaf from RWC`))

# Recalculate the model
y_model.chga_W <- chga_W$a * exp(-(x_seq.chga_W - chga_W$mu)^2 / (2 * chga_W$sigma^2))

chga_W_plot<-ggplot()+
 geom_point(data=data_W_chga,aes(x=`Psileaf from RWC`,y=WUEi),size=5,color="#E69F00", alpha = 0.7)+
 geom_line(aes(x = x_seq.chga_W *(-1), y = y_model.chga_W), color = '#E69F00', size=2)+
  geom_vline(xintercept = chga_W$mu*(-1), linetype = 2, linewidth = 1.5)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("C. gayan")+
  annotate("text", x = -2, y =200, label = "r² = 0.61", size = 5)+
   annotate("text", x = -2, y =170, label = as.character(expression(P < 0.001)), size = 5)+
   ylab(expression(paste("WUE"[i])))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-3)+
  ylim(0,252)

chga_W_plot
```


##PEGL - plot WUE
```{r}
data_W_pegl <- GExdata.dehy %>% 
  filter(Species == "Pegl") %>%
  dplyr::select(Species, Metabolism, WUEi, `Psileaf from RWC`)%>%
  filter(WUEi >0)

pegl_W<-  read.csv("../results/WUE/model_fitting_results.csv") %>% 
  filter(Species == 'Pegl') 

x_seq.pegl_W <- seq(0.1, 2, by=0.01)
x_seq.pegl_W

pegl_W$rsq
pval_from_R2_gaussian(R2 = pegl_W$rsq, n = length(data_W_pegl$`Psileaf from RWC`))
pval_from_R2_regression(R2 = pegl_W$rsq, n = length(data_W_pegl$`Psileaf from RWC`))

# Recalculate the model
y_model.pegl_W <- pegl_W$a * exp(-(x_seq.pegl_W - pegl_W$mu)^2 / (2 * pegl_W$sigma^2))

pegl_W_plot<-ggplot()+
 geom_point(data=data_W_pegl,aes(x=`Psileaf from RWC`,y=WUEi),size=5,color="#E69F00", alpha = 0.7)+
 geom_line(aes(x = x_seq.pegl_W *(-1), y = y_model.pegl_W), color = '#E69F00', size=2)+
  geom_vline(xintercept = pegl_W$mu*(-1), linetype = 2, linewidth = 1.5)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("P. glaucum")+
  annotate("text", x = -2, y =200, label = "r² = 0.53", size = 5)+
  annotate("text", x = -2, y =170, label = as.character(expression(P < 0.001)), size = 5)+
   ylab(expression(paste("WUE"[i])))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-3)+
  ylim(0,252)
pegl_W_plot
```

##ZEMA - plot WUE
```{r}
data_W_zema <- GExdata.dehy %>% 
  filter(Species == "Zema") %>%
  dplyr::select(Species, Metabolism, WUEi, `Psileaf from RWC`)%>%
  filter(WUEi >0)

zema_W<-  read.csv("../results/WUE/model_fitting_results.csv") %>% 
  filter(Species == 'Zema') 

x_seq.zema_W <- seq(0.1, 2, by=0.01)
x_seq.zema_W

zema_W$rsq
pval_from_R2_gaussian(R2 = zema_W$rsq, n = length(data_W_zema$`Psileaf from RWC`))
pval_from_R2_regression(R2 = zema_W$rsq, n = length(data_W_zema$`Psileaf from RWC`))

# Recalculate the model
y_model.zema_W <- zema_W$a * exp(-(x_seq.zema_W - zema_W$mu)^2 / (2 * zema_W$sigma^2))

zema_W_plot<-ggplot()+
 geom_point(data=data_W_zema,aes(x=`Psileaf from RWC`,y=WUEi),size=5,color="#E69F00", alpha = 0.7)+
 geom_line(aes(x = x_seq.zema_W *(-1), y = y_model.zema_W), color = '#E69F00', size=2)+
  geom_vline(xintercept = zema_W$mu*(-1), linetype = 2, linewidth = 1.5)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_text(size=14),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("Z. mays")+
  annotate("text", x = -2, y =200, label = "r² = 0.22", size = 5)+
  annotate("text", x = -2, y =170, label = as.character(expression(P < 0.05)), size = 5)+
   ylab(expression(paste("WUE"[i])))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-3)+
  ylim(0,252)

zema_W_plot
```

##all WUE plots
```{r}
WUE <- ggarrange(avsa_W_plot, chga_W_plot, hovu_W_plot, pegl_W_plot, trae_W_plot,  zema_W_plot, ncol = 2, nrow = 3, labels = c("A", "B", "C", "D", "E", "F"))
WUE


ggsave(filename = "../results/WUE_plot.jpg", plot = WUE, width = 9, height = 9)
```


#Kleaf - fit curve

```{r}

#AVSA -----------
Kleaf_avsa<-read_excel("../data/Kleaf_september13_2022.xlsx", sheet = "AVSA")
Kleaf_avsa$`Lowest Psileaf` <- as.numeric(Kleaf_avsa$`Lowest Psileaf`)*-1
Kleaf_avsa$`Kleaf Tcorr` <- as.numeric(Kleaf_avsa$`Kleaf Tcorr`)
Kleaf_avsa$Kleaf_relative <- Kleaf_avsa$`Kleaf Tcorr`/max(Kleaf_avsa$`Kleaf Tcorr`,na.rm=TRUE)*100

#HOVU--------

Kleaf_hovu<-read_excel("../data/Kleaf_september13_2022.xlsx", sheet = "HOVU") %>% dplyr::select(-`...27`)
Kleaf_hovu$`Lowest Psileaf` <- as.numeric(Kleaf_hovu$`Lowest Psileaf`)*-1
Kleaf_hovu$`Kleaf Tcorr` <- as.numeric(Kleaf_hovu$`Kleaf Tcorr`)
Kleaf_hovu$Kleaf_relative <- Kleaf_hovu$`Kleaf Tcorr`/max(Kleaf_hovu$`Kleaf Tcorr`,na.rm=TRUE)*100

#TRAE -------------
Kleaf_trae<-read_excel("../data/Kleaf_september13_2022.xlsx", sheet = "TRAE")
Kleaf_trae$`Lowest Psileaf` <- as.numeric(Kleaf_trae$`Lowest Psileaf`)*-1
Kleaf_trae$`Kleaf Tcorr` <- as.numeric(Kleaf_trae$`Kleaf Tcorr`)
Kleaf_trae$Kleaf_relative <- Kleaf_trae$`Kleaf Tcorr`/max(Kleaf_trae$`Kleaf Tcorr`,na.rm=TRUE)*100


#PEGL ---------
Kleaf_pegl<-read_excel("../data/Kleaf_september13_2022.xlsx", sheet = "PEGL")
Kleaf_pegl$`Lowest Psileaf` <- as.numeric(Kleaf_pegl$`Lowest Psileaf`)*-1
Kleaf_pegl$`Kleaf Tcorr` <- as.numeric(Kleaf_pegl$`Kleaf Tcorr`)
Kleaf_pegl$Kleaf_relative <- Kleaf_pegl$`Kleaf Tcorr`/max(Kleaf_pegl$`Kleaf Tcorr`,na.rm=TRUE)*100

#CHGA----------
Kleaf_chga<-read_excel("../data/Kleaf_september13_2022.xlsx", sheet = "CHGA")
Kleaf_chga$`Lowest Psileaf` <- as.numeric(Kleaf_chga$`Lowest Psileaf`)*-1
Kleaf_chga$`Kleaf Tcorr` <- as.numeric(Kleaf_chga$`Kleaf Tcorr`)
Kleaf_chga$Kleaf_relative <- Kleaf_chga$`Kleaf Tcorr`/max(Kleaf_chga$`Kleaf Tcorr`,na.rm=TRUE)*100

#ZEMA----------
Kleaf_zema<-read_excel("../data/Kleaf_september13_2022.xlsx", sheet = "ZEMA")
Kleaf_zema$`Lowest Psileaf` <- as.numeric(Kleaf_zema$`Lowest Psileaf`)*-1
Kleaf_zema$`Kleaf Tcorr` <- as.numeric(Kleaf_zema$`Kleaf Tcorr`)
Kleaf_zema$Kleaf_relative <- Kleaf_zema$`Kleaf Tcorr`/max(Kleaf_zema$`Kleaf Tcorr`,na.rm=TRUE)*100

Kleaf <- rbind(Kleaf_avsa, Kleaf_hovu, Kleaf_trae, Kleaf_pegl, Kleaf_zema, Kleaf_chga)


Kleaf_curve <- Kleaf %>%
  mutate(psi_neg =  `Lowest Psileaf`*(-1)) %>%
  dplyr::select(Species, psi_neg, `Kleaf Tcorr` ) %>%
  dplyr::rename(psi = psi_neg) %>%
  dplyr::rename(gs = `Kleaf Tcorr`) %>% #for the script by Megan
  dplyr::rename(species = Species) %>%
 # mutate(psi =  psi*(-1)) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()

write.csv(x = Kleaf_curve, file = "../results/Kleaf/Kleaf_curve.csv") #ready for 

#after fitting curve with "Closure Script 2017 for FvFm" and "R function MB 2017 for FvFm"


```

## AVSA - Plot Kleaf
```{r}
avsa_K <-   read.csv("../results/Kleaf/model_fitting_results.csv") %>% #best model log
  filter(Species == 'AVSA') %>%
  filter(model == 'Logistic')

x_seq.avsa.kleaf <- seq(-2, 0.1, by=0.01)
x_seq.avsa.kleaf

# Correct the sign of the inflection point
 C <- -avsa_K$C
 B <- avsa_K$B
 A <- avsa_K$A

# Recalculate the model
y_model.avsa_Kleaf <- A/(1+((x_seq.avsa.kleaf/C)^B))

Avsa_kleaf<-ggplot()+
  geom_point(data=Kleaf_avsa,aes(x=`Lowest Psileaf`,y=`Kleaf Tcorr`/avsa_K$Kmax_at_0.1MPa*100),size=5,color="black")+
   geom_line(aes(x = x_seq.avsa.kleaf, y = y_model.avsa_Kleaf/avsa_K$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("A. sativa")+
   ylab(expression(paste("relative K"[leaf],", (%)")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,101)
 
Avsa_kleaf

Avsa_kleaf_SI<-ggplot()+
  geom_point(data=Kleaf_avsa,aes(x=`Lowest Psileaf`,y=`Kleaf Tcorr`),size=5,color="#6DB9F8", alpha = 0.3)+
   geom_line(aes(x = x_seq.avsa.kleaf, y = y_model.avsa_Kleaf), color = '#6DB9F8', size=1.5)+
   geom_vline(xintercept = avsa_K$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
 #  ggtitle("A. sativa")+
   ylab(expression(atop(K[leaf], "(mmol" ~ m^{-2} ~ s^{-1} ~ MPa^{-1}*")")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,60)
 
Avsa_kleaf_SI


```
  
##HOVU - Plot Kleaf
```{r}
hovu_K <- read.csv("../results/Kleaf/model_fitting_results.csv") %>% #best model exp2
  filter(Species == 'HOVU') %>%
  filter(model == 'Exponential2')

x_seq.hovu.kleaf <- seq(0.1, 2, by=0.01)
x_seq.hovu.kleaf

# Recalculate the model
y_model.hovu_Kleaf <-  hovu_K$C+hovu_K$A*exp(-hovu_K$B*x_seq.hovu.kleaf)


Hovu_kleaf<-ggplot()+
  geom_point(data=Kleaf_hovu,aes(x=`Lowest Psileaf`,y=`Kleaf Tcorr`/hovu_K$Kmax_at_0.1MPa*100),size=5,color="black")+
 geom_line(aes(x = (-1)*x_seq.hovu.kleaf, y = y_model.hovu_Kleaf/hovu_K$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("H. vulgare")+
   ylab(expression(paste("relative K"[leaf],", (%)")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
   xlim(0,-1.6)
  # ylim(0,101)

Hovu_kleaf


Hovu_kleaf_SI<-ggplot()+
  geom_point(data=Kleaf_hovu,aes(x=`Lowest Psileaf`,y=`Kleaf Tcorr`),size=5,color="#6DB9F8", alpha = 0.3)+
   geom_line(aes(x = (-1)*x_seq.hovu.kleaf, y = y_model.hovu_Kleaf), color = '#6DB9F8', size=1.5)+
   geom_vline(xintercept = hovu_K$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
#  ggtitle("H. vulgare")+
  ylab(expression(paste("K"[leaf], " (mmol "*m^{-2}*" "*s^{-1}*" "*MPa^{-1},")")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,60)
 
Hovu_kleaf_SI
```


##TRAE - Plot Kleaf

```{r}
trae_K <-   read.csv("../results/Kleaf/model_fitting_results.csv") %>% #best model exp
  filter(Species == 'TRAE') %>%
  filter(model == 'Exponential')

x_seq.trae.kleaf <-seq(-2, 0.1, by=0.01)
x_seq.trae.kleaf

# Correct the sign of the inflection point
 B <- trae_K$B
 A <- trae_K$A

# Recalculate the model
y_model.trae_Kleaf <- A * exp(B*x_seq.trae.kleaf)


Trae_kleaf<-ggplot()+
  geom_point(data=Kleaf_trae,aes(x=`Lowest Psileaf`,y=`Kleaf Tcorr`/trae_K$Kmax_at_0.1MPa*100),size=5,color="black")+
   geom_line(aes(x = x_seq.trae.kleaf, y = y_model.trae_Kleaf/trae_K$Kmax_at_0.1MPa*100), color = 'black', size=3)+
    theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("T. aestivum")+
   ylab(expression(paste("relative K"[leaf],", (%)")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
xlim(0,-1.6)+
  ylim(0,101)
 
Trae_kleaf_SI<-ggplot()+
  geom_point(data=Kleaf_trae,aes(x=`Lowest Psileaf`,y=`Kleaf Tcorr`),size=5,color="#6DB9F8", alpha = 0.3)+
   geom_line(aes(x = x_seq.trae.kleaf, y = y_model.trae_Kleaf), color = '#6DB9F8', size=1.5)+
   geom_vline(xintercept = trae_K$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
 #  ggtitle("T. aestivum")+
  ylab(expression(paste("K"[leaf], " (mmol "*m^{-2}*" "*s^{-1}*" "*MPa^{-1},")")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,60)
 
Trae_kleaf_SI

```


##CHGA - Plot Kleaf

```{r}
 
chga_K <-   read.csv("../results/Kleaf/model_fitting_results.csv") %>% #best model exp
  filter(Species == 'CHGA') %>%
  filter(model == 'Logistic')

x_seq.chga.kleaf <- seq(-2, 0.1, by=0.01)
x_seq.chga.kleaf

# Correct the sign of the inflection point
C <- -chga_K$C
B  <- chga_K$B
A <- chga_K$A

# Recalculate the model
y_model.chga_Kleaf <- A/(1+((x_seq.chga.kleaf/C)^B))


Chga_kleaf<- ggplot()+
  geom_point(data=Kleaf_chga,aes(x=`Lowest Psileaf`,y=`Kleaf Tcorr`/chga_K$Kmax_at_0.1MPa*100),size=5,color="black")+
   geom_line(aes(x = x_seq.chga.kleaf, y = y_model.chga_Kleaf/chga_K$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
         axis.title.x=element_text(size=20),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("C. gayan")+
   ylab(expression(paste("relative K"[leaf],", (%)")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
 xlim(0,-1.6)+
  ylim(0,101)
Chga_kleaf

Chga_kleaf_SI<-ggplot()+
  geom_point(data=Kleaf_chga,aes(x=`Lowest Psileaf`,y=`Kleaf Tcorr`),size=5,color="#D9AB33", alpha = 0.3)+
   geom_line(aes(x = x_seq.chga.kleaf, y = y_model.chga_Kleaf), color = '#D9AB33', size=1.5)+
   geom_vline(xintercept = chga_K$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
 #   ggtitle("C. gayan")+
  ylab(expression(paste("K"[leaf], " (mmol "*m^{-2}*" "*s^{-1}*" "*MPa^{-1},")")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,60)
 
Chga_kleaf_SI
```


##PEGL - Plot Kleaf

```{r}
pegl_K <-   read.csv("../results/Kleaf/model_fitting_results.csv") %>% #best model exp
  filter(Species == 'PEGL') %>%
  filter(model == 'Logistic')

x_seq.pegl.kleaf <- seq(-2, 0.1, by=0.01)
x_seq.pegl.kleaf

# Correct the sign of the inflection point
 C <- -pegl_K$C
 B <- pegl_K$B
 A <- pegl_K$A

# Recalculate the model
y_model.pegl_Kleaf <- A/(1+((x_seq.pegl.kleaf/C)^B))


Pegl_kleaf<-ggplot()+
  geom_point(data=Kleaf_pegl,aes(x=`Lowest Psileaf`,y=`Kleaf Tcorr`/pegl_K$Kmax_at_0.1MPa*100),size=5,color="black")+
  geom_line(aes(x = x_seq.pegl.kleaf, y = y_model.pegl_Kleaf/pegl_K$Kmax_at_0.1MPa*100), color = 'black', size=3)+
    theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
         axis.title.x=element_text(size=20),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("P. glaucum")+
   ylab(expression(paste("relative K"[leaf],", (%)")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,101)


Pegl_kleaf_SI<-ggplot()+
  geom_point(data=Kleaf_pegl,aes(x=`Lowest Psileaf`,y=`Kleaf Tcorr`),size=5,color="#D9AB33", alpha = 0.3)+
   geom_line(aes(x = x_seq.pegl.kleaf, y = y_model.pegl_Kleaf), color = '#D9AB33', size=1.5)+
   geom_vline(xintercept = pegl_K$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
#   ggtitle("P. glaucum")+
  ylab(expression(paste("K"[leaf], " (mmol "*m^{-2}*" "*s^{-1}*" "*MPa^{-1},")")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,60)
 
Pegl_kleaf_SI
```


##ZEMA - Plot Kleaf

```{r}
zema_K <-     read.csv("../results/Kleaf/model_fitting_results.csv") %>% #best model exp
  filter(Species == 'ZEMA') %>%
  filter(model == 'Logistic')

x_seq.zema.kleaf <- seq(-2, 0.1, by=0.01)
x_seq.zema.kleaf

# Correct the sign of the inflection point
 C <- -zema_K$C
 B <- zema_K$B
 A <- zema_K$A

# Recalculate the model
y_model.zema_Kleaf <- A/(1+((x_seq.zema.kleaf/C)^B))


Zema_kleaf<- ggplot()+
  geom_point(data=Kleaf_zema,aes(x=`Lowest Psileaf`,y=`Kleaf Tcorr`/zema_K$Kmax_at_0.1MPa*100),size=5,color="black")+
  geom_line(aes(x = x_seq.zema.kleaf, y = y_model.zema_Kleaf/zema_K$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_text(size=20),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("Z. mays")+
   ylab(expression(paste("relative K"[leaf],", (%)")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,101)

Zema_kleaf_SI<-ggplot()+
  geom_point(data=Kleaf_zema,aes(x=`Lowest Psileaf`,y=`Kleaf Tcorr`),size=5,color="#D9AB33", alpha = 0.3)+
   geom_line(aes(x = x_seq.zema.kleaf, y = y_model.zema_Kleaf), color = '#D9AB33', size=1.5)+
   geom_vline(xintercept = zema_K$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
#  ggtitle("Z. mays")+
  ylab(expression(paste("K"[leaf], " (mmol "*m^{-2}*" "*s^{-1}*" "*MPa^{-1},")")))+
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,60)
 
Zema_kleaf_SI
```


#Kplant - fit curve
```{r}
#AVSA -----------
Kplant_avsa<-read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs21Aout25.xlsx", sheet = "AVSA")
Kplant_avsa$`psi Licor (Mpa)` <- as.numeric(Kplant_avsa$`psi Licor (Mpa)`)*-1
Kplant_avsa$Kplant <- as.numeric(Kplant_avsa$Kplant)
Kplant_avsa$Species <- 'AVSA'

Kplant_avsa <- Kplant_avsa %>% dplyr::select(`psi Licor (Mpa)`, Kplant, Species)

#HOVU--------

Kplant_hovu<-read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs21aout25.xlsx", sheet = "HOVU")
Kplant_hovu$`psi Licor (Mpa)` <- as.numeric(Kplant_hovu$`psi Licor (Mpa)`)*-1
Kplant_hovu$Kplant <- as.numeric(Kplant_hovu$Kplant)
Kplant_hovu$Species <- 'HOVU'

Kplant_hovu <- Kplant_hovu%>% dplyr::select(`psi Licor (Mpa)`, Kplant, Species)

#TRAE -------------
Kplant_trae<-read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs21aout25.xlsx", sheet = "TRAE")
Kplant_trae$`psi Licor (Mpa)` <- as.numeric(Kplant_trae$`psi Licor (Mpa)`)*-1
Kplant_trae$Kplant <- as.numeric(Kplant_trae$Kplant)
Kplant_trae$Species <- 'TRAE'

Kplant_trae <- Kplant_trae %>% dplyr::select(`psi Licor (Mpa)`, Kplant, Species)

#PEGL ---------
Kplant_pegl<-read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs21aout25.xlsx", sheet = "PEGL")
Kplant_pegl$`psi Licor (Mpa)` <- as.numeric(Kplant_pegl$`psi Licor (Mpa)`)*-1
Kplant_pegl$Kplant <- as.numeric(Kplant_pegl$Kplant)
Kplant_pegl$Species <- 'PEGL'

Kplant_pegl <- Kplant_pegl %>% dplyr::select(`psi Licor (Mpa)`, Kplant, Species)

#CHGA----------
Kplant_chga<-read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs21aout25.xlsx", sheet = "CHGA")
Kplant_chga$`psi Licor (Mpa)` <- as.numeric(Kplant_chga$`psi Licor (Mpa)`)*-1
Kplant_chga$Kplant <- as.numeric(Kplant_chga$Kplant)
Kplant_chga$Species <- 'CHGA'

Kplant_chga <- Kplant_chga %>% dplyr::select(`psi Licor (Mpa)`, Kplant, Species)

#ZEMA----------
Kplant_zema<-read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs21aout25.xlsx", sheet = "ZEMA")
Kplant_zema$`psi Licor (Mpa)` <- as.numeric(Kplant_zema$`psi Licor (Mpa)`)*-1
Kplant_zema$Kplant <- as.numeric(Kplant_zema$Kplant)
Kplant_zema$Species <- 'ZEMA'

Kplant_zema <- Kplant_zema %>% dplyr::select(`psi Licor (Mpa)`, Kplant, Species)

Kplant <- rbind(Kplant_avsa, Kplant_hovu, Kplant_trae, Kplant_pegl, Kplant_zema, Kplant_chga)


Kplant_curve <- Kplant %>%
  mutate(psi_neg =  `psi Licor (Mpa)`*(-1)) %>%
  dplyr::select(Species, psi_neg, Kplant ) %>%
  dplyr::rename(psi = psi_neg) %>%
  dplyr::rename(gs = Kplant) %>% #for the script by Megan
  dplyr::rename(species = Species) %>%
 # mutate(psi =  psi*(-1)) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()

write.csv(x = Kplant_curve, file = "../results/KplantKroots_results/Kplant/Kplant_curve.csv") #ready for 

#after fitting curve with "Closure Script 2017 for FvFm" and "R function MB 2017 for FvFm"

```

## AVSA - Plot Kplant
```{r}
avsa_Kplant_summary <-read.csv("../results/KplantKroots_results/Kplant/model_fitting_results.csv") %>% #best model exp
  filter(Species == 'AVSA') %>%
  filter(model == 'Exponential')

data_Kplant_avsa <-  read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs21aout25.xlsx", 
    sheet = "AVSA", col_types = c("skip", 
        "skip", "skip", "skip", "skip", "skip", 
        "skip", "skip", "skip", "skip", "skip", 
        "numeric", "numeric")) 
#%>%   mutate(`psi Licor (Mpa)` = -1 * `psi Licor (Mpa)`)

x_seq.avsa.kplant <- seq(0.1, 2, by=0.01)

# Compute Kplant values using the equation - exponential
y.model.Kplant.avsa <- avsa_Kplant_summary$A  * exp(-avsa_Kplant_summary$B* x_seq.avsa.kplant)
y.model.Kplant.avsa

#plot
Avsa_kplant<- ggplot()+
 geom_point(data=data_Kplant_avsa,aes(x=(-1)*`psi Licor (Mpa)`,y=Kplant/avsa_Kplant_summary$Kmax_at_0.1MPa*100),size=5,color="black")+
  geom_line(aes(x =(-1)*x_seq.avsa.kplant, y = y.model.Kplant.avsa/avsa_Kplant_summary$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("A. sativa")+
   ylab(expression(paste("relative K"[plant],", (%)")))+
  xlab(expression(paste(Psi["plant"]," (MPa)")))+
  xlim(0,-1.6)#+
 # ylim(0,101)
 
Avsa_kplant

#plot SI
Avsa_kplant_SI<- ggplot()+
 geom_point(data=data_Kplant_avsa,aes(x=(-1)*`psi Licor (Mpa)`,y=Kplant*10^3),size=5,color="#6DB9F8", alpha = 0.3)+
  geom_line(aes(x =(-1)*x_seq.avsa.kplant, y = y.model.Kplant.avsa*10^3), color = '#6DB9F8', size=1.5)+
   geom_vline(xintercept =avsa_Kplant_summary$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
 #  ggtitle("A. sativa")+
   ylab(expression(atop(K[plant], "(mmol" ~ m^{-2} ~ s^{-1} ~ MPa^{-1}*")")))+
  xlab(expression(paste(Psi["plant"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,25)
 
Avsa_kplant_SI
```

## HOVU - Plot Kplant
```{r}
hovu_Kplant_summary <-  read.csv("../results/KplantKroots_results/Kplant/model_fitting_results.csv") %>% #best model log
  filter(Species == 'HOVU') %>%
  filter(model == 'Sigmoidal')

data_Kplant_hovu <- read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs12Aout25.xlsx", 
    sheet = "HOVU", col_types = c("skip", 
        "skip", "skip", "skip", "skip", "skip", 
        "skip", "skip", "skip", "skip", "skip", 
        "numeric", "numeric")) 
#%>%   mutate(`psi Licor (Mpa)` = -1 * `psi Licor (Mpa)`)

x_seq.hovu.kplant <-  seq(0.1, 2, by=0.01)
x_seq.hovu.kplant

# Correct the sign of the inflection point
C<- hovu_Kplant_summary$C
B <- hovu_Kplant_summary$B
A <- hovu_Kplant_summary$A

# model
y.model.Kplant.hovu <-  A  / (1 + exp(-((x_seq.hovu.kplant - C) / B)))


#plot
hovu_kplant<- ggplot()+
 geom_point(data=data_Kplant_hovu,aes(x=(-1)*`psi Licor (Mpa)`,y=Kplant/hovu_Kplant_summary$Kmax_at_0.1MPa*100),size=5,color="black")+
  geom_line(aes(x =(-1)*x_seq.hovu.kplant, y = y.model.Kplant.hovu/hovu_Kplant_summary$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("H. vulgare")+
   ylab(expression(paste("relative K"[plant],", (%)")))+
  xlab(expression(paste(Psi["plant"]," (MPa)")))+
  xlim(0,-1.6)#+
 # ylim(0,101)
 
hovu_kplant

#plot SI
hovu_kplant_SI<- ggplot()+
 geom_point(data=data_Kplant_hovu,aes(x=(-1)*`psi Licor (Mpa)`,y=Kplant*10^3),size=5,color="#6DB9F8", alpha = 0.3)+
  geom_line(aes(x =(-1)*x_seq.hovu.kplant, y = y.model.Kplant.hovu*10^3), color = '#6DB9F8', size=1.5)+
   geom_vline(xintercept =hovu_Kplant_summary$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
  # ggtitle("H. vulgare")+
  xlab(expression(paste(Psi["plant"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,25)
 
hovu_kplant_SI
```

## TRAE - Plot Kplant
```{r}
trae_Kplant_summary <-  read.csv("../results/KplantKroots_results/Kplant/model_fitting_results.csv") %>% #best model
  filter(Species == 'TRAE') %>%
  filter(model == 'Sigmoidal')

data_Kplant_trae <- read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs12Aout25.xlsx", 
    sheet = "TRAE", col_types = c("skip", 
        "skip", "skip", "skip", "skip", "skip", 
        "skip", "skip", "skip", "skip", "skip", 
        "numeric", "numeric")) 
#%>%   mutate(`psi Licor (Mpa)` = -1 * `psi Licor (Mpa)`)

x_seq.trae.kplant <-  seq(0.1, 2, by=0.01)
x_seq.trae.kplant

# Correct the sign of the inflection point
C <- trae_Kplant_summary$C
B<- trae_Kplant_summary$B
A <- trae_Kplant_summary$A

# Recalculate the model
y.model.Kplant.trae <- A / (1 + exp(-((x_seq.trae.kplant - C) / B)))

#plot
trae_kplant<- ggplot()+
 geom_point(data=data_Kplant_trae,aes(x=(-1)*`psi Licor (Mpa)`,y=Kplant/trae_Kplant_summary$Kmax_at_0.1MPa*100),size=5,color="black")+
  geom_line(aes(x =(-1)*x_seq.trae.kplant, y = y.model.Kplant.trae/trae_Kplant_summary$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("T. aestivum")+
   ylab(expression(paste("relative K"[plant],", (%)")))+
  xlab(expression(paste(Psi["plant"]," (MPa)")))+
  xlim(0,-1.6)#+
 # ylim(0,101)
 
trae_kplant

#plot SI
trae_kplant_SI<- ggplot()+
 geom_point(data=data_Kplant_trae,aes(x=(-1)*`psi Licor (Mpa)`,y=Kplant*10^3),size=5,color="#6DB9F8", alpha = 0.3)+
  geom_line(aes(x =(-1)*x_seq.trae.kplant, y = y.model.Kplant.trae*10^3), color = '#6DB9F8', size=1.5)+
   geom_vline(xintercept =trae_Kplant_summary$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
 #  ggtitle("T. aestivum")+
  xlab(expression(paste(Psi["plant"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,25)
 
trae_kplant_SI
```

## CHGA - Plot Kplant
```{r}
chga_Kplant_summary <-  read.csv("../results/KplantKroots_results/Kplant/model_fitting_results.csv") %>% #best model
  filter(Species == 'CHGA') %>%
  filter(model == 'Exponential')

data_Kplant_chga <-  read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs12Aout25.xlsx", 
    sheet = "CHGA", col_types = c("skip", 
        "skip", "skip", "skip", "skip", "skip", 
        "skip", "skip", "skip", "skip", "skip", 
        "numeric", "numeric")) 
#%>%   mutate(`psi Licor (Mpa)` = -1 * `psi Licor (Mpa)`)

x_seq.chga.kplant <-  seq(0.1, 2, by=0.01)
x_seq.chga.kplant


# Compute Kplant values using the equation - exponential
y.model.Kplant.chga <- chga_Kplant_summary$A  * exp(-chga_Kplant_summary$B* x_seq.chga.kplant)

y.model.Kplant.chga


#plot
chga_kplant<- ggplot()+
 geom_point(data=data_Kplant_chga,aes(x=(-1)*`psi Licor (Mpa)`,y=Kplant/chga_Kplant_summary$Kmax_at_0.1MPa*100),size=5,color="black")+
  geom_line(aes(x =(-1)*x_seq.chga.kplant, y = y.model.Kplant.chga/chga_Kplant_summary$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("C. gayan")+
   ylab(expression(paste("relative K"[plant],", (%)")))+
  xlab(expression(paste(Psi["plant"]," (MPa)")))+
  xlim(0,-1.6)#+
 # ylim(0,101)
 
chga_kplant

#plot SI
chga_kplant_SI<- ggplot()+
 geom_point(data=data_Kplant_chga,aes(x=(-1)*`psi Licor (Mpa)`,y=Kplant*10^3),size=5,color="#D9AB33", alpha = 0.3)+
  geom_line(aes(x =(-1)*x_seq.chga.kplant, y = y.model.Kplant.chga*10^3), color = '#D9AB33', size=1.5)+
   geom_vline(xintercept =chga_Kplant_summary$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
#  ggtitle("C. gayan")+
   ylab(expression(paste("K"[plant], " (mmol "*m^{-2}*" "*s^{-1}*" "*MPa^{-1},")")))+
  xlab(expression(paste(Psi["plant"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,25)
 
chga_kplant_SI
```

## PEGL - Plot Kplant
```{r}
pegl_Kplant_summary <-  read.csv("../results/KplantKroots_results/Kplant/model_fitting_results.csv") %>% #best model
  filter(Species == 'PEGL') %>%
  filter(model == 'Exponential')

data_Kplant_pegl <-  read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs12Aout25.xlsx", 
    sheet = "PEGL", col_types = c("skip", 
        "skip", "skip", "skip", "skip", "skip", 
        "skip", "skip", "skip", "skip", "skip", 
        "numeric", "numeric")) 
#%>%   mutate(`psi Licor (Mpa)` = -1 * `psi Licor (Mpa)`)

x_seq.pegl.kplant <-  seq(0.1, 2, by=0.01)
x_seq.pegl.kplant

# Compute Kplant values using the equation - exponential
y.model.Kplant.pegl <- pegl_Kplant_summary$A * exp(-pegl_Kplant_summary$B* x_seq.pegl.kplant)
y.model.Kplant.pegl

#plot
pegl_kplant<- ggplot()+
 geom_point(data=data_Kplant_pegl,aes(x=(-1)*`psi Licor (Mpa)`,y=Kplant/pegl_Kplant_summary$Kmax_at_0.1MPa*100),size=5,color="black")+
  geom_line(aes(x =(-1)*x_seq.pegl.kplant, y = y.model.Kplant.pegl/pegl_Kplant_summary$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("P. glaucum")+
   ylab(expression(paste("relative K"[plant],", (%)")))+
  xlab(expression(paste(Psi["plant"]," (MPa)")))+
  xlim(0,-1.6)#+
 # ylim(0,101)
 
pegl_kplant

#plot SI
pegl_kplant_SI<- ggplot()+
 geom_point(data=data_Kplant_pegl,aes(x=(-1)*`psi Licor (Mpa)`,y=Kplant*10^3),size=5,color="#D9AB33",alpha = 0.3)+
  geom_line(aes(x =(-1)*x_seq.pegl.kplant, y = y.model.Kplant.pegl*10^3), color = '#D9AB33', size=1.5)+
   geom_vline(xintercept =pegl_Kplant_summary$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   #ggtitle("P. glaucum")+
  xlab(expression(paste(Psi["plant"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,25)
 
pegl_kplant_SI
```

## ZEMA - Plot Kplant
```{r}
zema_Kplant_summary <-    read.csv("../results/KplantKroots_results/Kplant/model_fitting_results.csv") %>% #best model
  filter(Species == 'ZEMA') %>%
  filter(model == 'Linear')

data_Kplant_zema <-  read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs12Aout25.xlsx", 
    sheet = "ZEMA", col_types = c("skip", 
        "skip", "skip", "skip", "skip", "skip", 
        "skip", "skip", "skip", "skip", "skip", 
        "numeric", "numeric")) 
#%>%   mutate(`psi Licor (Mpa)` = -1 * `psi Licor (Mpa)`)

x_seq.zema.kplant <-  seq(0.1, 2, by=0.01)
x_seq.zema.kplant

# Compute Kplant values using the equation - exp
y.model.Kplant.zema <- zema_Kplant_summary$A  + zema_Kplant_summary$B* x_seq.zema.kplant
y.model.Kplant.zema


#plot
zema_kplant<- ggplot()+
 geom_point(data=data_Kplant_zema,aes(x=(-1)*`psi Licor (Mpa)`,y=Kplant/zema_Kplant_summary$Kmax_at_0.1MPa*100),size=5,color="black")+
  geom_line(aes(x =(-1)*x_seq.zema.kplant, y = y.model.Kplant.zema/zema_Kplant_summary$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("Z. mays")+
   ylab(expression(paste("relative K"[plant],", (%)")))+
  xlab(expression(paste(Psi["plant"]," (MPa)")))+
  xlim(0,-1.6)#+
 # ylim(0,101)
 
zema_kplant


#plot SI
zema_kplant_SI<- ggplot()+
 geom_point(data=data_Kplant_zema,aes(x=(-1)*`psi Licor (Mpa)`,y=Kplant*10^3),size=5,color="#D9AB33", alpha = 0.3)+
  geom_line(aes(x =(-1)*x_seq.zema.kplant, y = y.model.Kplant.zema*10^3), color = '#D9AB33', size=1.5)+
   geom_vline(xintercept =zema_Kplant_summary$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
  # ggtitle("Z. mays")+
  xlab(expression(paste(Psi["plant"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,25)
 
zema_kplant_SI
```

#Kroot - fit curve
```{r}
#AVSA -----------
Kroot_avsa<-read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs21Aout25.xlsx", sheet = "AVSA")
Kroot_avsa$`psi roots` <- as.numeric(Kroot_avsa$`psi roots`)*-1
Kroot_avsa$Kroot <- as.numeric(Kroot_avsa$Kroot)
Kroot_avsa$Species <- 'AVSA'

Kroot_avsa <- Kroot_avsa %>% dplyr::select(Species, `psi roots`, Kroot ) 

#HOVU--------

Kroot_hovu<-read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs21Aout25.xlsx", sheet = "HOVU")
Kroot_hovu$`psi roots` <- as.numeric(Kroot_hovu$`psi roots`)*-1
Kroot_hovu$Kroot <- as.numeric(Kroot_hovu$Kroot)
Kroot_hovu$Species <- 'HOVU'

Kroot_hovu <- Kroot_hovu %>% dplyr::select(Species, `psi roots`, Kroot )

#TRAE -------------
Kroot_trae<-read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs21Aout25.xlsx", sheet = "TRAE")
Kroot_trae$`psi roots` <- as.numeric(Kroot_trae$`psi roots`)*-1
Kroot_trae$Kroot <- as.numeric(Kroot_trae$Kroot)
Kroot_trae$Species <- 'TRAE'


Kroot_trae <- Kroot_trae %>% dplyr::select(Species, `psi roots`, Kroot )

#PEGL ---------
Kroot_pegl<-read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs21Aout25.xlsx", sheet = "PEGL")
Kroot_pegl$`psi roots` <- as.numeric(Kroot_pegl$`psi roots`)*-1
Kroot_pegl$Kroot <- as.numeric(Kroot_pegl$Kroot)
Kroot_pegl$Species <- 'PEGL'


Kroot_pegl <- Kroot_pegl %>% dplyr::select(Species, `psi roots`, Kroot )

#CHGA----------
Kroot_chga<-read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs21Aout25.xlsx", sheet = "CHGA")
Kroot_chga$`psi roots` <- as.numeric(Kroot_chga$`psi roots`)*-1
Kroot_chga$Kroot <- as.numeric(Kroot_chga$Kroot)
Kroot_chga$Species <- 'CHGA'


Kroot_chga <- Kroot_chga %>% dplyr::select(Species, `psi roots`, Kroot )

#ZEMA----------
Kroot_zema<-read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs21Aout25.xlsx", sheet = "ZEMA")
Kroot_zema$`psi roots` <- as.numeric(Kroot_zema$`psi roots`)*-1
Kroot_zema$Kroot <- as.numeric(Kroot_zema$Kroot)
Kroot_zema$Species <- 'ZEMA'


Kroot_zema <- Kroot_zema %>% dplyr::select(Species, `psi roots`, Kroot )

Kroot <- rbind(Kroot_avsa, Kroot_hovu, Kroot_trae, Kroot_pegl, Kroot_zema, Kroot_chga)


Kroot_curve <- Kroot %>%
  mutate(psi_neg =  `psi roots`*(-1)) %>%
  dplyr::select(Species, psi_neg, Kroot ) %>%
  dplyr::rename(psi = psi_neg) %>%
  dplyr::rename(gs = Kroot) %>% #for the script by Megan
  dplyr::rename(species = Species) %>%
 # mutate(psi =  psi*(-1)) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()

write.csv(x = Kroot_curve, file = "../results/KplantKroots_results/Kroot/Kroot_curve.csv") #ready for 

#after fitting curve with "Closure Script 2017 for FvFm" and "R function MB 2017 for FvFm"

```

## AVSA - Plot Kroot
```{r}
avsa_Kroot_summary <-   read.csv("../results/KplantKroots_results/Kroot/model_fitting_results.csv") %>% #best model
  filter(Species == 'AVSA') %>%
  filter(model == 'Logistic')

data_Kroot_avsa <-  read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs12Aout25.xlsx", 
    sheet = "AVSA", col_types = c("numeric", 
        "numeric", "skip", "skip", "skip", "skip", 
        "skip", "skip", "skip", "skip", "skip", 
        "skip", "skip")) 
#%>%   mutate(`psi Licor (Mpa)` = -1 * `psi Licor (Mpa)`)

x_seq.avsa.kroot <-  seq(0.1, 2, by=0.01)
x_seq.avsa.kroot

# Compute Kroot values using the equation - exponential
y.model.Kroot.avsa <- avsa_Kroot_summary$A / (1+ ((x_seq.avsa.kroot / avsa_Kroot_summary$C)^avsa_Kroot_summary$B))
y.model.Kroot.avsa

#plot
Avsa_kroot<- ggplot()+
 geom_point(data=data_Kroot_avsa,aes(x=(-1)*`psi roots`,y=Kroot/avsa_Kroot_summary$Kmax_at_0.1MPa*100),size=5,color="#56B4E9")+
  geom_line(aes(x =(-1)*x_seq.avsa.kroot, y = y.model.Kroot.avsa/avsa_Kroot_summary$Kmax_at_0.1MPa*100), color = '#56B4E9', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("A. sativa")+
   ylab(expression(paste("relative K"[root],", (%)")))+
  xlab(expression(paste(Psi["root"]," (MPa)")))+
  xlim(0,-1.6)#+
 # ylim(0,101)
 Avsa_kroot
#SI Kroot
Avsa_kroot_SI<- ggplot()+
 geom_point(data=data_Kroot_avsa,aes(x=(-1)*`psi roots`,y=Kroot*10^3),size=5,color="#6DB9F8", alpha = 0.3)+
  geom_line(aes(x =(-1)*x_seq.avsa.kroot, y = y.model.Kroot.avsa*10^3), color = '#6DB9F8', size=1.5)+
   geom_vline(xintercept =avsa_Kroot_summary$P50_0.1kmax*(-1), linetype =2)+
 theme_minimal()+
theme(axis.title.y=element_text(size=14),
axis.text.y=element_text(size=13),
axis.title.x=element_blank(),
axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
legend.title=element_text(),
title = element_text(size=13, face = "bold.italic"))+
  ggtitle("A. sativa")+
  ylab(expression(atop(K[root], "(mmol" ~ m^{-2} ~ s^{-1} ~ MPa^{-1}*")")))+
  xlab(expression(paste(Psi["root"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,155)
Avsa_kroot_SI
```

## HOVU - Plot Kroot
```{r}
hovu_Kroot_summary <-   read.csv("../results/KplantKroots_results/Kroot/model_fitting_results.csv") %>% #best model
  filter(Species == 'HOVU') %>%
  filter(model == 'Exponential')

data_Kroot_hovu <-   read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs12Aout25.xlsx", 
    sheet = "HOVU", col_types = c("numeric", 
        "numeric", "skip", "skip", "skip", "skip", 
        "skip", "skip", "skip", "skip", "skip", 
        "skip", "skip")) 
#%>%   mutate(`psi Licor (Mpa)` = -1 * `psi Licor (Mpa)`)

x_seq.hovu.kroot <-  seq(0.1, 2, by=0.01)
x_seq.hovu.kroot

# Compute Kroot values using the equation - exponential
y.model.Kroot.hovu <- hovu_Kroot_summary$A  * exp(-hovu_Kroot_summary$B* x_seq.hovu.kroot)
y.model.Kroot.hovu

#plot
hovu_kroot<- ggplot()+
 geom_point(data=data_Kroot_hovu,aes(x=(-1)*`psi roots`,y=Kroot/hovu_Kroot_summary$Kmax_at_0.1MPa*100),size=5,color="#56B4E9")+
  geom_line(aes(x =(-1)*x_seq.hovu.kroot, y = y.model.Kroot.hovu/hovu_Kroot_summary$Kmax_at_0.1MPa*100), color = '#56B4E9', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("H. vulgare")+
   ylab(expression(paste("relative K"[root],", (%)")))+
  xlab(expression(paste(Psi["root"]," (MPa)")))+
  xlim(0,-1.6)#+
 # ylim(0,101)
hovu_kroot

#plot SI
hovu_kroot_SI<- ggplot()+
 geom_point(data=data_Kroot_hovu,aes(x=(-1)*`psi roots`,y=Kroot*10^3),size=5,color="#6DB9F8", alpha = 0.3)+
  geom_line(aes(x =(-1)*x_seq.hovu.kroot, y = y.model.Kroot.hovu*10^3), color = '#6DB9F8', size=1.5)+
   geom_vline(xintercept =hovu_Kroot_summary$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("H. vulgare")+
  ylab(expression(paste("K"[root], " (mmol "*m^{-2}*" "*s^{-1}*" "*MPa^{-1},")")))+
  xlab(expression(paste(Psi["root"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,155)
 
hovu_kroot_SI
```

## TRAE - Plot Kroot
```{r}
trae_Kroot_summary <-   read.csv("../results/KplantKroots_results/Kroot/model_fitting_results.csv") %>% #best model
  filter(Species == 'TRAE') %>%
  filter(model == 'Exponential2')

data_Kroot_trae <-  read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs12Aout25.xlsx", 
    sheet = "TRAE", col_types = c("numeric", 
        "numeric", "skip", "skip", "skip", "skip", 
        "skip", "skip", "skip", "skip", "skip", 
        "skip", "skip")) 
#%>%   mutate(`psi Licor (Mpa)` = -1 * `psi Licor (Mpa)`)

x_seq.trae.kroot <-  seq(0.1, 2, by=0.01)
x_seq.trae.kroot


# Compute Kroot values using the equation - exp2
y.model.Kroot.trae <- trae_Kroot_summary$C + trae_Kroot_summary$A  * exp(-trae_Kroot_summary$B* x_seq.trae.kroot)
  

#plot
trae_kroot<- ggplot()+
 geom_point(data=data_Kroot_trae,aes(x=(-1)*`psi roots`,y=Kroot/trae_Kroot_summary$Kmax_at_0.1MPa*100),size=5,color="black")+
  geom_line(aes(x =(-1)*x_seq.trae.kroot, y = y.model.Kroot.trae/trae_Kroot_summary$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("T. aestivum")+
   ylab(expression(paste("relative K"[root],", (%)")))+
  xlab(expression(paste(Psi["root"]," (MPa)")))+
  xlim(0,-1.6)#+
 # ylim(0,101)
 
trae_kroot

#plot SI
trae_kroot_SI<- ggplot()+
 geom_point(data=data_Kroot_trae,aes(x=(-1)*`psi roots`,y=Kroot*10^3),size=5,color="#6DB9F8", alpha = 0.3)+
  geom_line(aes(x =(-1)*x_seq.trae.kroot, y = y.model.Kroot.trae*10^3), color = '#6DB9F8', size=1.5)+
   geom_vline(xintercept =trae_Kroot_summary$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
   theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
  ggtitle("T. aestivum")+
  ylab(expression(paste("K"[root], " (mmol "*m^{-2}*" "*s^{-1}*" "*MPa^{-1},")")))+
  xlab(expression(paste(Psi["root"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,155)
 
trae_kroot_SI
```

## CHGA - Plot Kroot
```{r}
chga_Kroot_summary <-   read.csv("../results/KplantKroots_results/Kroot/model_fitting_results.csv") %>% #best model
  filter(Species == 'CHGA') %>%
  filter(model == 'Exponential')

data_Kroot_chga <-  read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs12Aout25.xlsx", 
    sheet = "CHGA", col_types = c("numeric", 
        "numeric", "skip", "skip", "skip", "skip", 
        "skip", "skip", "skip", "skip", "skip", 
        "skip", "skip")) 
#%>%   mutate(`psi Licor (Mpa)` = -1 * `psi Licor (Mpa)`)

x_seq.chga.kroot <-  seq(0.1, 2, by=0.01)
x_seq.chga.kroot

# Compute Kroot values using the equation - exponential 
y.model.Kroot.chga <- chga_Kroot_summary$A  * exp(-chga_Kroot_summary$B* x_seq.chga.kroot)
y.model.Kroot.chga

#plot
chga_kroot<- ggplot()+
 geom_point(data=data_Kroot_chga,aes(x=(-1)*`psi roots`,y=Kroot/chga_Kroot_summary$Kmax_at_0.1MPa*100),size=5,color="black")+
  geom_line(aes(x =(-1)*x_seq.chga.kroot, y = y.model.Kroot.chga/chga_Kroot_summary$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("C. gayana")+
   ylab(expression(paste("relative K"[root],", (%)")))+
  xlab(expression(paste(Psi["root"]," (MPa)")))+
  xlim(0,-1.6)#+
 # ylim(0,101)
 
chga_kroot

#plot SI
chga_kroot_SI<- ggplot()+
  geom_point(data=data_Kroot_chga,aes(x=(-1)*`psi roots`,y=Kroot*10^3),size=5,color="#D9AB33", alpha = 0.3)+
  geom_line(aes(x =(-1)*x_seq.chga.kroot, y = y.model.Kroot.chga*10^3), color = '#D9AB33', size=1.5)+
  geom_vline(xintercept =chga_Kroot_summary$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size = 13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("C. gayana")+
   ylab(expression(paste("K"[root], " (mmol "*m^{-2}*" "*s^{-1}*" "*MPa^{-1},")")))+
  xlab(expression(paste(Psi["root"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,155)
 
chga_kroot_SI
```

## PEGL - Plot Kroot
```{r}
pegl_Kroot_summary <-   read.csv("../results/KplantKroots_results/Kroot/model_fitting_results.csv") %>% #best model
  filter(Species == 'PEGL') %>%
  filter(model == 'Exponential')

data_Kroot_pegl <-  read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs12Aout25.xlsx", 
    sheet = "PEGL", col_types = c("numeric", 
        "numeric", "skip", "skip", "skip", "skip", 
        "skip", "skip", "skip", "skip", "skip", 
        "skip", "skip"))  %>% na.omit()

x_seq.pegl.kroot <-  seq(0.1, 2, by=0.01)
x_seq.pegl.kroot

# Compute Kroot values using the equation -exp
y.model.Kroot.pegl <- pegl_Kroot_summary$A  * exp(-pegl_Kroot_summary$B* x_seq.pegl.kroot)
  

#plot
pegl_kroot<- ggplot()+
 geom_point(data=data_Kroot_pegl,aes(x=(-1)*`psi roots`,y=Kroot/pegl_Kroot_summary$Kmax_at_0.1MPa*100),size=5,color="black")+
  geom_line(aes(x =(-1)*x_seq.pegl.kroot, y = y.model.Kroot.pegl/pegl_Kroot_summary$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("P. glaucum")+
   ylab(expression(paste("relative K"[root],", (%)")))+
  xlab(expression(paste(Psi["root"]," (MPa)")))+
  xlim(0,-1.6)#+
 # ylim(0,101)
 
pegl_kroot

#plot SI
pegl_kroot_SI<- ggplot()+
 geom_point(data=data_Kroot_pegl,aes(x=(-1)*`psi roots`,y=Kroot*10^3),size=5,color="#D9AB33", alpha = 0.3)+
  geom_line(aes(x =(-1)*x_seq.pegl.kroot, y = y.model.Kroot.pegl*10^3), color = '#D9AB33', size=1.5)+
   geom_vline(xintercept =pegl_Kroot_summary$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
   theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
         axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("P. glaucum")+
   ylab(expression(paste("K"[root], " (mmol "*m^{-2}*" "*s^{-1}*" "*MPa^{-1},")")))+
  xlab(expression(paste(Psi["root"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,155)
 
pegl_kroot_SI
```

## ZEMA - Plot Kroot
```{r}
zema_Kroot_summary <-   read.csv("../results/KplantKroots_results/Kroot/model_fitting_results.csv") %>% #best model
  filter(Species == 'ZEMA') %>%
  filter(model == 'Exponential')

data_Kroot_zema <-  read_excel("../data/Kroot_Kplants_no_outlier_MB2juin2025_Cs12Aout25.xlsx", 
    sheet = "ZEMA", col_types = c("numeric", 
        "numeric", "skip", "skip", "skip", "skip", 
        "skip", "skip", "skip", "skip", "skip", 
        "skip", "skip")) 
#%>%   mutate(`psi Licor (Mpa)` = -1 * `psi Licor (Mpa)`)

x_seq.zema.kroot <-  seq(0.1, 2, by=0.01)
x_seq.zema.kroot

# Compute Kroot values using the equation - exponential
y.model.Kroot.zema <- zema_Kroot_summary$A  * exp(-zema_Kroot_summary$B* x_seq.zema.kroot)
y.model.Kroot.zema

#plot
zema_kroot<- ggplot()+
 geom_point(data=data_Kroot_zema,aes(x=(-1)*`psi roots`,y=Kroot/zema_Kroot_summary$Kmax_at_0.1MPa*100),size=5,color="black")+
  geom_line(aes(x =(-1)*x_seq.zema.kroot, y = y.model.Kroot.zema/zema_Kroot_summary$Kmax_at_0.1MPa*100), color = 'black', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
   ggtitle("Z. mays")+
   ylab(expression(paste("relative K"[root],", (%)")))+
  xlab(expression(paste(Psi["root"]," (MPa)")))+
  xlim(0,-1.6)#+
 # ylim(0,101)
 
zema_kroot

#plot SI
zema_kroot_SI<- ggplot()+
 geom_point(data=data_Kroot_zema,aes(x=(-1)*`psi roots`,y=Kroot*10^3),size=5,color="#D9AB33", alpha = 0.3)+
  geom_line(aes(x =(-1)*x_seq.zema.kroot, y = y.model.Kroot.zema*10^3), color = '#D9AB33', size=1.5)+
   geom_vline(xintercept =zema_Kroot_summary$P50_0.1kmax*(-1), linetype =2)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        title = element_text(size=13, face = "bold.italic"))+
  ggtitle("Z. mays")+
   ylab(expression(paste("K"[root], " (mmol "*m^{-2}*" "*s^{-1}*" "*MPa^{-1},")")))+
  xlab(expression(paste(Psi["root"]," (MPa)")))+
  xlim(0,-1.6)+
  ylim(0,155)
 
zema_kroot_SI
```

#ALL PLOTS TOGETHER

```{r}

Avsa <- ggplot()+
 geom_line(aes(x = x_seq.avsa_A, y = y_model.avsa_A_sigmoidal/avsa_A_sig$Kmax_at_0.1MPa*100), color = '#E69F00', size = 3) +  # assimilation (gold-like)
geom_line(aes(x = x_seq.avsa, y = y_model.avsa_g_sigmoidal/avsa_g_sig$Kmax_at_0.1MPa*100), color = '#D55E00', size = 3) +   # gs (orange-like)
geom_line(aes(x = x_seq.avsa.kleaf, y = y_model.avsa_Kleaf/avsa_K$Kmax_at_0.1MPa*100), color = '#009E73', size = 3) +   # Kleaf (green-like)
geom_line(aes(x = (-1)*x_seq.avsa.kroot, y = y.model.Kroot.avsa/avsa_Kroot_summary$Kmax_at_0.1MPa*100), color = '#56B4E9', size = 3) + # Kroot (light blue)
geom_line(aes(x = (-1)*x_seq.avsa.kplant, y = y.model.Kplant.avsa/avsa_Kplant_summary$Kmax_at_0.1MPa*100), color = '#999999', size = 3) +  # Kplant (grey)
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        plot.title   = element_text(size=14, face="italic", hjust=0.1))+
   ggtitle("A. sativa")+
  ylab(expression(paste("Relative ", A[net], ", ", g[s], ", ", K[leaf], ", ", K[plant], ", ", K[root], " (%)")))+
  xlim(0,-2)+
  ylim(0,101)
 
Avsa


Hovu<-ggplot()+
  geom_line(aes(x = x_seq.hovu_A, y = y_model.hovu_A_sigmoidal/hovu_A_sig$Kmax_at_0.1MPa*100), color = '#E69F00', size=3)+
   geom_line(aes(x = x_seq.hovu, y = y_model.hovu_g_sigmoidal/hovu_g_sig$Kmax_at_0.1MPa*100), color = '#D55E00', size=3)+
  geom_line(aes(x =(-1)*x_seq.hovu.kleaf, y =y_model.hovu_Kleaf/hovu_K$Kmax_at_0.1MPa*100), color = '#009E73', size=3)+
  geom_line(aes(x =(-1)*x_seq.hovu.kplant, y = y.model.Kplant.hovu/hovu_Kplant_summary$Kmax_at_0.1MPa*100), color = '#999999', size=3)+
  geom_line(aes(x =(-1)*x_seq.hovu.kroot, y = y.model.Kroot.hovu/hovu_Kroot_summary$Kmax_at_0.1MPa*100), color = '#56B4E9', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        plot.title   = element_text(size=14, face="italic", hjust=0.1))+
   ggtitle("H. vulgare")+
  xlim(0,-2)+
ylim(0,101)
Hovu

Trae<-ggplot()+
  geom_line(aes(x = x_seq.trae_A, y = y_model.trae_A_sigmoidal/trae_A_sig$Kmax_at_0.1MPa*100), color = '#E69F00', size=3)+
  geom_line(aes(x = x_seq.trae, y = y_model.trae_g_sigmoidal/trae_g_sig$Kmax_at_0.1MPa*100), color = '#D55E00', size=3)+
  geom_line(aes(x = x_seq.trae.kleaf, y = y_model.trae_Kleaf/trae_K$Kmax_at_0.1MPa*100), color = '#009E73', size=3)+
  geom_line(aes(x =(-1)*x_seq.trae.kplant, y = y.model.Kplant.trae/trae_Kplant_summary$Kmax_at_0.1MPa*100), color = '#999999', size=3)+
  geom_line(aes(x =(-1)*x_seq.trae.kroot, y = y.model.Kroot.trae/trae_Kroot_summary$Kmax_at_0.1MPa*100), color = '#56B4E9', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        plot.title   = element_text(size=14, face="italic", hjust=0.1))+
   ggtitle("T. aestivum")+
  xlim(0,-2)+
ylim(0,101)
Trae

Pegl<-ggplot()+
  geom_line(aes(x = x_seq.Pegl_A, y = y_model.Pegl_A_sigmoidal/Pegl_A_sig$Kmax_at_0.1MPa*100), color = '#E69F00', size=5)+
  geom_line(aes(x = x_seq.pegl, y = y_model.pegl_g_sigmoidal/pegl_g_sig$Kmax_at_0.1MPa*100), color = '#D55E00', size=2)+
  geom_line(aes(x = x_seq.pegl.kleaf, y = y_model.pegl_Kleaf/pegl_K$Kmax_at_0.1MPa*100), color = '#009E73', size=3)+
  geom_line(aes(x =(-1)*x_seq.pegl.kplant, y = y.model.Kplant.pegl/pegl_Kplant_summary$Kmax_at_0.1MPa*100), color = '#999999', size=3)+
  geom_line(aes(x =(-1)*x_seq.pegl.kroot, y = y.model.Kroot.pegl/pegl_Kroot_summary$Kmax_at_0.1MPa*100), color = '#56B4E9', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
         axis.title.x=element_text(size=20),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        plot.title   = element_text(size=14, face="italic", hjust=0.1))+
   ggtitle("P. glaucum")+
  ylab(expression(paste("Relative ", A[net], ", ", g[s], ", ", K[leaf], ", ", K[plant], ", ", K[root], " (%)")))+
  xlab(expression(paste(Psi," (MPa)")))+
  xlim(0,-2)+
  ylim(0,101)
Pegl

Chga<-ggplot()+
  geom_line(aes(x = x_seq.chga_A, y = y_model.chga_A_sigmoidal/chga_A_sig$Kmax_at_0.1MPa*100), color = '#E69F00', size=3)+
   geom_line(aes(x = x_seq.chga, y = y_model.chga_g_sigmoidal/chga_g_sig$Kmax_at_0.1MPa*100), color = '#D55E00', size=2)+
  geom_line(aes(x = x_seq.chga.kleaf, y = y_model.chga_Kleaf/chga_K$Kmax_at_0.1MPa*100), color = '#009E73', size=3)+
   geom_line(aes(x =(-1)*x_seq.chga.kplant, y = y.model.Kplant.chga/chga_Kplant_summary$Kmax_at_0.1MPa*100), color = '#999999', size=3)+
  geom_line(aes(x =(-1)*x_seq.chga.kroot, y = y.model.Kroot.chga/chga_Kroot_summary$Kmax_at_0.1MPa*100), color = '#56B4E9', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
         axis.title.x=element_text(size=20),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        plot.title   = element_text(size=14, face="italic", hjust=0.1))+
   ggtitle("C. gayan")+
  ylab(expression(paste("Relative ", A[net], ", ", g[s], ", ", K[leaf], ", ", K[plant], ", ", K[root], " (%)")))+
  xlab(expression(paste(Psi," (MPa)")))+
  xlim(0,-2)+
  ylim(0,101)

Chga

Zema<-ggplot()+
  geom_line(aes(x = x_seq.zema_A, y = y_model.zema_A_sigmoidal/zema_A_sig$Kmax_at_0.1MPa*100), color = '#E69F00', size=3)+
  geom_line(aes(x = x_seq.zema, y = y_model.zema_g_sigmoidal/zema_g_sig$Kmax_at_0.1MPa*100), color = '#D55E00', size=4)+
  geom_line(aes(x = x_seq.zema.kleaf, y = y_model.zema_Kleaf/zema_K$Kmax_at_0.1MPa*100), color = '#009E73', size=3)+
  geom_line(aes(x =(-1)*x_seq.zema.kplant, y = y.model.Kplant.zema/zema_Kplant_summary$Kmax_at_0.1MPa*100), color = '#999999', size=2)+
   geom_line(aes(x =(-1)*x_seq.zema.kroot, y = y.model.Kroot.zema/zema_Kroot_summary$Kmax_at_0.1MPa*100), color = '#56B4E9', size=3)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=14),
        axis.text.y=element_text(size=13),
        axis.title.x=element_text(size=20),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13),
        legend.title=element_text(),
        plot.title   = element_text(size=14, face="italic", hjust=0.1))+
   ggtitle("Z. mays")+
  ylab(expression(paste("Relative ", A[net], ", ", g[s], ", ", K[leaf], ", ", K[plant], ", ", K[root], " (%)")))+
  xlab(expression(paste(Psi," (MPa)")))+
  xlim(0,-2)+
  ylim(0,101)
 
Zema
### all plots Kleaf ----
Figure1 <- ggarrange(Avsa, Hovu, Trae, Chga,Pegl, Zema,labels = c("A", "B", "C", "D", "E", "F"), label.x = 0.05, font.label = list(size = 18, face = "bold"), ncol =3, nrow = 2)

Figure1

ggsave(filename = "../results/Figure1.jpg", plot = Figure1, width = 12, height = 8)


```

#SI - Assimilation
```{r}

FigureSI_A <- ggarrange(Avsa_GEx_A_SI, Hovu_GEx_A_SI, Trae_GEx_A_SI, Chga_GEx_A_SI, Pegl_GEx_A_SI, Zema_GEx_A_SI,  ncol =6, nrow = 1)

FigureSI_A

ggsave(filename = "../results/FigureSI_A.jpg", plot = FigureSI_A, width = 12, height = 8)
```

#SI - Stomatal conductance
```{r}

FigureSI_g <- ggarrange(Avsa_GEx_g_SI, Hovu_GEx_g_SI, Trae_GEx_g_SI, Chga_GEx_g_SI, Pegl_GEx_g_SI, Zema_GEx_g_SI,  ncol =6, nrow = 1)

FigureSI_g

ggsave(filename = "../results/FigureSI_g.jpg", plot = FigureSI_g, width = 12, height = 8)
```


#SI - Kleaf
```{r}

FigureSI_Kleaf <- ggarrange(Avsa_kleaf_SI, Hovu_kleaf_SI, Trae_kleaf_SI, Chga_kleaf_SI, Pegl_kleaf_SI, Zema_kleaf_SI, ncol =6, nrow = 1)

FigureSI_Kleaf

ggsave(filename = "../results/FigureSI_Kleaf.jpg", plot = FigureSI_Kleaf, width = 12, height = 8)
```

#SI - Kplant
```{r}

FigureSI_kplant <-  ggarrange(Avsa_kplant_SI, hovu_kplant_SI, trae_kplant_SI, chga_kplant_SI, pegl_kplant_SI, zema_kplant_SI, ncol =6, nrow = 1)

FigureSI_kplant

ggsave(filename = "../results/FigureSI_kplant.jpg", plot = FigureSI_kplant, width = 12, height = 8)
```

#SI - Kroot
```{r}

FigureSI_kroot <- ggarrange(Avsa_kroot_SI, hovu_kroot_SI, trae_kroot_SI, chga_kroot_SI, pegl_kroot_SI, zema_kroot_SI, ncol =6, nrow = 1)

FigureSI_kroot

ggsave(filename = "../results/FigureSI_kroot.jpg", plot = FigureSI_kroot, width = 12, height = 8)
```

#tentative figure 1
```{r}
Figure1_tentative <- ggarrange(FigureSI_kroot,FigureSI_Kleaf, FigureSI_kplant,FigureSI_g, FigureSI_A, ncol = 1, nrow = 5)
Figure1_tentative

ggsave(filename = "../results/Figure1_tentative.jpg", plot = Figure1_tentative, width = 12, height = 10)
```

#Summary Max & P50
```{r}
# Max values
all_species_summary_max <- tribble(
  ~Species, ~Amax, ~gsmax,~Kleafmax,~Krootmax,~Kplantmax, ~WUEimax,
  "Avsa",   avsa_A_sig$Kmax_at_0.1MPa, avsa_g_sig$Kmax_at_0.1MPa, avsa_K$Kmax_at_0.1MPa, avsa_Kroot_summary$Kmax_at_0.1MPa, avsa_Kplant_summary$Kmax_at_0.1MPa, avsa_W$a,
  "Hovu",   hovu_A_sig$Kmax_at_0.1MPa, hovu_g_sig$Kmax_at_0.1MPa, hovu_K$Kmax_at_0.1MPa, hovu_Kroot_summary$Kmax_at_0.1MPa, hovu_Kplant_summary$Kmax_at_0.1MPa, hovu_W$a,
  "Trae",   trae_A_sig$Kmax_at_0.1MPa, trae_g_sig$Kmax_at_0.1MPa, trae_K$Kmax_at_0.1MPa, trae_Kroot_summary$Kmax_at_0.1MPa, trae_Kplant_summary$Kmax_at_0.1MPa, trae_W$a,
  "Pegl",   Pegl_A_sig$Kmax_at_0.1MPa, pegl_g_sig$Kmax_at_0.1MPa, pegl_K$Kmax_at_0.1MPa, pegl_Kroot_summary$Kmax_at_0.1MPa, pegl_Kplant_summary$Kmax_at_0.1MPa, pegl_W$a,
  "Chga",   chga_A_sig$Kmax_at_0.1MPa, chga_g_sig$Kmax_at_0.1MPa, chga_K$Kmax_at_0.1MPa, chga_Kroot_summary$Kmax_at_0.1MPa, chga_Kplant_summary$Kmax_at_0.1MPa, chga_W$a,
  "Zema",   zema_A_sig$Kmax_at_0.1MPa, zema_g_sig$Kmax_at_0.1MPa, zema_K$Kmax_at_0.1MPa, zema_Kroot_summary$Kmax_at_0.1MPa, zema_Kplant_summary$Kmax_at_0.1MPa, zema_W$a
) %>%
  mutate(Metabolism = c("C3","C3","C3","C4","C4","C4"))

# -----------------------------
# P50 values
all_species_summary_P50 <- tribble(
  ~Species, ~PA50,~Pgs50,~PKleaf50, ~PKroot50,~PKplant50, ~PWUEimax,
  "Avsa",   -avsa_A_sig$P50_0.1kmax,         -avsa_g_sig$P50_0.1kmax,          -avsa_K$P50_0.1kmax,           -avsa_Kroot_summary$P50_0.1kmax,    -avsa_Kplant_summary$P50_0.1kmax, -avsa_W$mu,
  "Hovu",   -hovu_A_sig$P50_0.1kmax,         -hovu_g_sig$P50_0.1kmax,          -hovu_K$P50_0.1kmax,           -hovu_Kroot_summary$P50_0.1kmax,    -hovu_Kplant_summary$P50_0.1kmax, -hovu_W$mu,
  "Trae",   -trae_A_sig$P50_0.1kmax,         -trae_g_sig$P50_0.1kmax,          -trae_K$P50_0.1kmax,           -trae_Kroot_summary$P50_0.1kmax,    -trae_Kplant_summary$P50_0.1kmax,-trae_W$mu,
  "Pegl",   -Pegl_A_sig$P50_0.1kmax,         -pegl_g_sig$P50_0.1kmax,          -pegl_K$P50_0.1kmax,           -pegl_Kroot_summary$P50_0.1kmax,    -pegl_Kplant_summary$P50_0.1kmax,-pegl_W$mu,
  "Chga",   -chga_A_sig$P50_0.1kmax,         -chga_g_sig$P50_0.1kmax,          -chga_K$P50_0.1kmax,           -chga_Kroot_summary$P50_0.1kmax,    -chga_Kplant_summary$P50_0.1kmax,-chga_W$mu,
  "Zema",   -zema_A_sig$P50_0.1kmax,         -zema_g_sig$P50_0.1kmax,          -zema_K$P50_0.1kmax,           -zema_Kroot_summary$P50_0.1kmax,    -zema_Kplant_summary$P50_0.1kmax, -zema_W$mu
)

all_species_summary <- left_join(all_species_summary_max, all_species_summary_P50)

write.csv(all_species_summary, file = "../results/summary_max_P50.csv")

```


#///////Figure 3

##data
SRC, data loading, variable calculation, outliers, means 
```{r}
SRCdata <- read_xlsx(path = "../data/C3C4 Grasses - OV monitoring, SRC.xlsx", sheet = "C3C4G SRC") 
##variable calculations
SRCdata$Metabolism<-factor(SRCdata$Metabolism)
SRCdata$Species<-factor(SRCdata$Species,levels=c("Avsa","Hovu","Trae","Pegl","Zema","Chga"))

# variable calculation
#T for initial, fully hydrated or turgid -- STAGE 1
#F for after dehydration or fresh -- STAGE 2
#R for Rehydration -- STAGE 3
#D for dry -- STAGE 4

#leaf thickness average
SRCdata$T.LT<-rowMeans(SRCdata[c("T.LT1","T.LT2","T.LT3","T.LT4","T.LT5","T.LT6")],na.rm=T) #stage 1
SRCdata$F.LT2 <- as.numeric(SRCdata$F.LT2)
SRCdata$F.LT<-rowMeans(SRCdata[c("F.LT1","F.LT2","F.LT3","F.LT4","F.LT5","F.LT6")],na.rm=T) #stage 2
SRCdata$D.LT2 <- as.numeric(SRCdata$D.LT2)
SRCdata$D.LT<-rowMeans(SRCdata[c("D.LT1","D.LT2","D.LT3","D.LT4","D.LT5","D.LT6")],na.rm=T) #stage 4

#leaf width average
SRCdata$F.LW1 <- as.numeric(SRCdata$F.LW1)
SRCdata$F.LW2 <- as.numeric(SRCdata$F.LW2)
SRCdata$F.LW3 <- as.numeric(SRCdata$F.LW3)
SRCdata$F.LW4 <- as.numeric(SRCdata$F.LW4)
SRCdata$F.LW5 <- as.numeric(SRCdata$F.LW5)

SRCdata$T.LW1<-rowMeans(SRCdata[c("T.LW1","T.LW2","T.LW3")],na.rm=T) #stage 1 - middle
SRCdata$F.LW1<-rowMeans(SRCdata[c("F.LW1","F.LW2","F.LW3")],na.rm=T) #stage 2
SRCdata$T.LW2<-rowMeans(SRCdata[c("T.LW1","T.LW4","T.LW5")],na.rm=T) #stage 1 - base
SRCdata$F.LW2<-rowMeans(SRCdata[c("F.LW1","F.LW4","F.LW5")],na.rm=T) #stage 2

SRCdata$D.LW1 <- as.numeric(SRCdata$D.LW1)
SRCdata$D.LW2 <- as.numeric(SRCdata$D.LW2)
SRCdata$D.LW3 <- as.numeric(SRCdata$D.LW3)
SRCdata$D.LW4 <- as.numeric(SRCdata$D.LW4)
SRCdata$D.LW5 <- as.numeric(SRCdata$D.LW5)

SRCdata$D.LW<-rowMeans(SRCdata[c("D.LW1","D.LW2","D.LW3","D.LW4","D.LW5")],na.rm=T) #stage 4

#Leaf volume 
SRCdata$F.LA <- as.numeric(SRCdata$F.LA)
SRCdata$D.LA <- as.numeric(SRCdata$D.LA)

SRCdata$T.LV<-SRCdata$T.LA*SRCdata$T.LT/10 #stage 1
SRCdata$F.LV<-SRCdata$F.LA*SRCdata$F.LT/10 #stage 2
SRCdata$D.LV<-SRCdata$D.LA*SRCdata$D.LT/10  #stage 4

#PLX : Leaf percentage loss of X variable

#Leaf percentage loss during dehydration: thickness
SRCdata$F.PLT<-100-SRCdata$F.LT/SRCdata$T.LT*100 #stage 2 leaf thickness compared to stage 1 leaf thickness
SRCdata$D.PLT<-100-SRCdata$D.LT/SRCdata$T.LT*100 #stage 4 dry leaf thickness compared to stage 4 

#Leaf percentage loss during dehydration: leaf area
SRCdata$F.PLA<-100-SRCdata$F.LA/SRCdata$T.LA*100
SRCdata$D.PLA<-100-SRCdata$D.LA/SRCdata$T.LA*100

#Leaf percentage loss during dehydration: leaf width
SRCdata$F.PLW1<-100-SRCdata$F.LW1/SRCdata$T.LW1*100
SRCdata$D.PLW1<-100-SRCdata$D.LW/SRCdata$T.LW1*100

#Leaf percentage loss during dehydration: leaf length
SRCdata$F.LLe <- as.numeric(SRCdata$F.LLe)
SRCdata$T.LLe <- as.numeric(SRCdata$T.LLe)
SRCdata$D.LLe <- as.numeric(SRCdata$D.LLe)
SRCdata$F.PLLe<-100-SRCdata$F.LLe/SRCdata$T.LLe*100
SRCdata$D.PLLe<-100-SRCdata$D.LLe/SRCdata$T.LLe*100

##Leaf percentage loss during dehydration: leaf volume
SRCdata$F.PLV<-100-SRCdata$F.LV/SRCdata$T.LV*100
SRCdata$D.PLV<-100-SRCdata$D.LV/SRCdata$T.LV*100

#RWC calculations & other variables
SRCdata$T.SWC<-(SRCdata$TW-SRCdata$DW)/SRCdata$DW
SRCdata$F.SWC<-(SRCdata$FW-SRCdata$DW)/SRCdata$DW
SRCdata$R.SWC<-(SRCdata$RW-SRCdata$DW)/SRCdata$DW
SRCdata$F.RWC<-(SRCdata$FW-SRCdata$DW)/(SRCdata$TW-SRCdata$DW)*100
SRCdata$R.RWC<-(SRCdata$RW-SRCdata$DW)/(SRCdata$TW-SRCdata$DW)*100 #marion

#??
SRCdata$F.1_LWi.LWhy<-1-SRCdata$FW/SRCdata$TW #???

#LMA, leaf density, LDMC, 
SRCdata$LMA<-SRCdata$DW/1000/(SRCdata$T.LA/10000)
SRCdata$LD<-SRCdata$DW/1000/SRCdata$T.LV
SRCdata$LDMC<-SRCdata$DW/SRCdata$TW

#Rehydration capacity PLRC = 100- LW_rehy / LW_full saturation *100
#what the leaf recovers compared to its full turgid capacity
SRCdata$PLRC<-100-SRCdata$R.SWC/SRCdata$T.SWC*100

#formula for the percentage loss of chlorophyll fluorescence (PLCF, in %), as an index of loss of fluorescence  capacity after dehydration

# variable calculation
#T for initial, fully hydrated or turgid -- STAGE 1
#F for after dehydration or fresh -- STAGE 2
#R for Rehydration -- STAGE 3
#D for dry -- STAGE 4


SRCdata$PLCF = 100* (1- (as.numeric(SRCdata$F.FvFm)/as.numeric(SRCdata$T.FvFm)))

```

# SRC, outliers

```{r}
# PLRC of -20% 
#SRCdata$Species[!SRCdata$PLRC>-20] (Chga and Hovu)
SRCdata$PLRC[!SRCdata$PLRC>-20]<-NA #why input NA for the two values: -23.9 and -21.5?

#Species 
# Avsa
#SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==17,5:84]<-NA
#SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==20,5:84]<-NA
#SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==21,5:84]<-NA
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==22,5:84]<-NA # FvFm
#SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==24,5:84]<-NA
#SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==25,5:84]<-NA
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==26,5:84]<-NA # FvFm
#SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==29,5:84]<-NA
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==30,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==31,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==32,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==43,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==44,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==45,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==46,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==47,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==49,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==51,5:84]<-NA # too small leaf (!)
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==52,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==53,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==54,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==55,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==56,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==57,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==59,5:84]<-NA # PLA
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==17,84]<-NA # only PLRC
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==20,84]<-NA # only PLRC
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==21,84]<-NA # only PLRC
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==24,84]<-NA # only PLRC
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==25,84]<-NA # only PLRC
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==24,74]<-NA # only D.PLLe - to check photos!
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==27,74]<-NA # only D.PLLe - to check photos!
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==28,74]<-NA # only D.PLLe - to check photos!
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==65,74]<-NA # only D.PLLe - to check photos!
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==66,74]<-NA # only D.PLLe - to check photos!
SRCdata[SRCdata$Species=="Avsa" & SRCdata$Leaf==48,70]<-NA # only D.PLA - to check photos!

## Chga
SRCdata[SRCdata$Species=="Chga" & SRCdata$Leaf==1,5:84]<-NA # PLT - to check
SRCdata[SRCdata$Species=="Chga" & SRCdata$Leaf==6,5:84]<-NA # PLA - to check photos!
SRCdata[SRCdata$Species=="Chga" & SRCdata$Leaf==9,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Chga" & SRCdata$Leaf==21,5:84]<-NA # PLT - to check
SRCdata[SRCdata$Species=="Chga" & SRCdata$Leaf==22,5:84]<-NA # LMA vs LDMC
SRCdata[SRCdata$Species=="Chga" & SRCdata$Leaf==24,74]<-NA # only D.PLLe - to check photos!
SRCdata[SRCdata$Species=="Chga" & SRCdata$Leaf==25,5:84]<-NA # LMA vs LDMC
SRCdata[SRCdata$Species=="Chga" & SRCdata$Leaf==30,5:84]<-NA # PLT - to check
SRCdata[SRCdata$Species=="Chga" & SRCdata$Leaf==31,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Chga" & SRCdata$Leaf==32,5:84]<-NA # PLRC
SRCdata[SRCdata$Species=="Chga" & SRCdata$Leaf==48,5:84]<-NA # FvFm

## Hovu
SRCdata[SRCdata$Species=="Hovu" & SRCdata$Leaf==3,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Hovu" & SRCdata$Leaf==4,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Hovu" & SRCdata$Leaf==5,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Hovu" & SRCdata$Leaf==6,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Hovu" & SRCdata$Leaf==7,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Hovu" & SRCdata$Leaf==8,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Hovu" & SRCdata$Leaf==15,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Hovu" & SRCdata$Leaf==17,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Hovu" & SRCdata$Leaf==19,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Hovu" & SRCdata$Leaf==49,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Hovu" & SRCdata$Leaf==50,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Hovu" & SRCdata$Leaf==56,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Hovu" & SRCdata$Leaf==55,84]<-NA # only PLRC
SRCdata[SRCdata$Species=="Hovu" & SRCdata$Leaf==14,c(69,75)]<-NA # only PLA, PLV - to check photos!

## Pegl 
SRCdata[SRCdata$Species=="Pegl" & SRCdata$Leaf==35,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Pegl" & SRCdata$Leaf==38,74]<-NA # only D.PLLe - to check photos!
SRCdata[SRCdata$Species=="Pegl" & SRCdata$Leaf==42,74]<-NA # only D.PLLe - to check photos!

## Trae
SRCdata[SRCdata$Species=="Trae" & SRCdata$Leaf==8,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Trae" & SRCdata$Leaf==9,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Trae" & SRCdata$Leaf==10,5:84]<-NA # FvFm
#SRCdata[SRCdata$Species=="Trae" & SRCdata$Leaf==18,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Trae" & SRCdata$Leaf==20,5:84]<-NA # FvFm
#SRCdata[SRCdata$Species=="Trae" & SRCdata$Leaf==23,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Trae" & SRCdata$Leaf==28,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Trae" & SRCdata$Leaf==29,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Trae" & SRCdata$Leaf==30,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Trae" & SRCdata$Leaf==31,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Trae" & SRCdata$Leaf==32,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Trae" & SRCdata$Leaf==45,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Trae" & SRCdata$Leaf==46,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Trae" & SRCdata$Leaf==47,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Trae" & SRCdata$Leaf==49,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Trae" & SRCdata$Leaf==50,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Trae" & SRCdata$Leaf==52,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Trae" & SRCdata$Leaf==53,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Trae" & SRCdata$Leaf==42,44]<-NA # only R FvFm - to check!

## Zema
SRCdata[SRCdata$Species=="Zema" & SRCdata$Leaf==8,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Zema" & SRCdata$Leaf==10,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Zema" & SRCdata$Leaf==15,5:84]<-NA # LDMC vs LD
SRCdata[SRCdata$Species=="Zema" & SRCdata$Leaf==20,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Zema" & SRCdata$Leaf==23,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Zema" & SRCdata$Leaf==34,5:84]<-NA # FvFm
SRCdata[SRCdata$Species=="Zema" & SRCdata$Leaf==24,84]<-NA # only PLRC
SRCdata[SRCdata$Species=="Zema" & SRCdata$Leaf==6,c(70,76)]<-NA # only DPLA, DPLV - to check photos!
```


## means 
```{r}
m.SRCdata<-ddply(SRCdata,c("Species","Metabolism"),summarise,
                m.LMA=mean(LMA,na.rm=TRUE),n.LMA=sum(!is.na(LMA)),se.LMA=sd(LMA,na.rm=T)/sqrt(n.LMA),
                m.T.LT=mean(T.LT,na.rm=TRUE),n.T.LT=sum(!is.na(T.LT)),se.T.LT=sd(T.LT,na.rm=T)/sqrt(n.T.LT),
                m.LD=mean(LD,na.rm=TRUE),n.LD=sum(!is.na(LD)),se.LD=sd(LD,na.rm=T)/sqrt(n.LD),
                m.LDMC=mean(LDMC,na.rm=TRUE),n.LDMC=sum(!is.na(LDMC)),se.LDMC=sd(LDMC,na.rm=T)/sqrt(n.LDMC),
                m.D.PLT=mean(D.PLT,na.rm=TRUE),n.D.PLT=sum(!is.na(D.PLT)),se.D.PLT=sd(D.PLT,na.rm=T)/sqrt(n.D.PLT),
                m.D.PLA=mean(D.PLA,na.rm=TRUE),n.D.PLA=sum(!is.na(D.PLA)),se.D.PLA=sd(D.PLA,na.rm=T)/sqrt(n.D.PLA),
                m.D.PLV=mean(D.PLV,na.rm=TRUE),n.D.PLV=sum(!is.na(D.PLV)),se.D.PLV=sd(D.PLV,na.rm=T)/sqrt(n.D.PLV),
                m.D.PLLe=mean(D.PLLe,na.rm=TRUE),n.D.PLLe=sum(!is.na(D.PLLe)),se.D.PLLe=sd(D.PLLe,na.rm=T)/sqrt(n.D.PLLe),
                m.D.PLW1=mean(D.PLW1,na.rm=TRUE),n.D.PLW1=sum(!is.na(D.PLW1)),se.D.PLW1=sd(D.PLW1,na.rm=T)/sqrt(n.D.PLW1))
```

## SRC data for analysis
```{r}

#write.csv(m.SRCdata, file = "../data/m.SRCdata.csv")
#write.csv(SRCdata, file = "../data/SRCdata.csv")
```


## SRC data RWC converted to psi
```{r}
SRCdata = read.csv("../data/SRCdata.csv",header=TRUE)

SRCdata_PV <- SRCdata %>% 
  mutate(
    tlp.coef = case_when(
      Species == "Avsa" ~ -0.84,
      Species == "Chga" ~ -0.75,
      Species == "Hovu" ~ -0.83,
      Species == "Pegl" ~ -0.68,
      Species == "Trae" ~ -0.85,
      Species == "Zema" ~ -0.68,
      TRUE ~ NA_real_
    ),
    elasticity = case_when(
      Species == "Avsa" ~ 8.57,
      Species == "Chga" ~ 11.6,
      Species == "Hovu" ~ 9.27,
      Species == "Pegl" ~ 8.99,
      Species == "Trae" ~ 9.25,
      Species == "Zema" ~ 8.07,
      TRUE ~ NA_real_
    )) %>% 
  mutate(Psip =-(tlp.coef)-(elasticity*(1-F.RWC/100))) %>% 
  mutate(Psip = if_else(Psip < 0, 0, Psip))%>%  # Replace negative Psip with 0
  mutate(Ps=tlp.coef/(F.RWC/100)) %>% #tlp en neg 
  mutate(Psileaf.from.RWC= Psip + Ps)


write.csv(x = SRCdata_PV, file = "../data/SRCdata_PV.csv")

# #avsa
# tlp = -0.84 
# elasticity 8.57 
# 
# #chga
# tlp = -0.75 
# elasticity 11.6
# 
# #hovu
# tlp = -0.83 
# elasticity 9.27
# 
# #pegl
# tlp = -0.68 
# elasticity 8.99
# 
# #trae
# tlp = -0.85 
# elasticity 9.25
# 
# #zema
# tlp = -0.68 
# elasticity 8.07
```

##leaf structure
```{r}
## SRC, boxplots, stat analysis ####

# LMA
plot_LMA<-ggplot(SRCdata,aes(x=Species,y=LMA,fill=Metabolism))+
  geom_boxplot(lwd=0.2,fatten=5)+
  theme_minimal()+
  scale_fill_manual(values=c(C3 = "#6DB9F8", C4 = "#D9AB33"))+
   ggtitle(expression(paste("LMA (g m"^-2,")")))+
  #geom_point(data=GExdata.0[GExdata.0$Dataset=="Dehydration",],aes(x=Species,y=LMA),size=4,shape=21,fill="yellow")+
  ylim(0,50)+
  #geom_hline(yintercept=0,lty=2)+
  theme(axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13,face="italic"),
        legend.text=element_text(size=13),
        plot.title = element_text(size = 20, hjust = 0.5))+
  #ylab(expression(paste("LMA (g m"^-2,")")))+
  annotate("text",x=1,y=7,label=expression(paste(italic(bar("x"))," = 31.1")),size=4)+
  annotate("text",x=1,y=4,label=expression(paste(italic("n")," = 49")),size=4)+
  annotate("text",x=2,y=7,label=expression(paste("21.2")),size=4)+
  annotate("text",x=2,y=4,label=expression(paste("48")),size=4)+
  annotate("text",x=3,y=7,label=expression(paste("27.4")),size=4)+
  annotate("text",x=3,y=4,label=expression(paste("38")),size=4)+
  annotate("text",x=4,y=7,label=expression(paste("24.7")),size=4)+
  annotate("text",x=4,y=4,label=expression(paste("41")),size=4)+
  annotate("text",x=5,y=7,label=expression(paste("20.6")),size=4)+
  annotate("text",x=5,y=4,label=expression(paste("42")),size=4)+
  annotate("text",x=6,y=7,label=expression(paste("27.5")),size=4)+
  annotate("text",x=6,y=4,label=expression(paste("42")),size=4)+
  annotate("text",x=1,y=max(SRCdata[SRCdata$Species=="Avsa","LMA"],na.rm=T)+4,label=expression(paste(bold("a"))),size=5)+
  annotate("text",x=2,y=max(SRCdata[SRCdata$Species=="Hovu","LMA"],na.rm=T)+4,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=3,y=max(SRCdata[SRCdata$Species=="Trae","LMA"],na.rm=T)+4,label=expression(paste(bold("b"))),size=5)+
  annotate("text",x=4,y=max(SRCdata[SRCdata$Species=="Pegl","LMA"],na.rm=T)+4,label=expression(paste(bold("b"))),size=5)+
  annotate("text",x=5,y=max(SRCdata[SRCdata$Species=="Zema","LMA"],na.rm=T)+4,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=6,y=max(SRCdata[SRCdata$Species=="Chga","LMA"],na.rm=T)+4,label=expression(paste(bold("b"))),size=5)
plot_LMA

# stat
lm1<-lm(LMA~Species,data=SRCdata)
anova(lm1)
tuk1<-HSD.test(lm1,"Species",group=T)
tuk1$groups

# LT
plot_LT<-ggplot(SRCdata,aes(x=Species,y=T.LT,fill=Metabolism))+
  theme_minimal()+
  geom_boxplot(lwd=0.2,fatten=5)+
  scale_fill_manual(values=c(C3 = "#6DB9F8", C4 = "#D9AB33"))+
  #geom_point(data=GExdata.0[GExdata.0$Dataset=="Dehydration",],aes(x=Species,y=LMA),size=4,shape=21,fill="yellow")+
  ylim(0,0.4)+
  #geom_hline(yintercept=0,lty=2)+
  ggtitle("LT (mm)")+
  theme(axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13,face="italic"),
        legend.text=element_text(size=13),
        plot.title = element_text(size = 20, hjust = 0.5))+
  annotate("text",x=1,y=0.056,label=expression(paste(italic(bar("x"))," = 0.22")),size=4)+
  annotate("text",x=1,y=0.032,label=expression(paste(italic("n")," = 49")),size=4)+
  annotate("text",x=2,y=0.056,label=expression(paste("0.19")),size=4)+
  annotate("text",x=2,y=0.032,label=expression(paste("48")),size=4)+
  annotate("text",x=3,y=0.056,label=expression(paste("0.17")),size=4)+
  annotate("text",x=3,y=0.032,label=expression(paste("38")),size=4)+
  annotate("text",x=4,y=0.056,label=expression(paste("0.13")),size=4)+
  annotate("text",x=4,y=0.032,label=expression(paste("41")),size=4)+
  annotate("text",x=5,y=0.056,label=expression(paste("0.16")),size=4)+
  annotate("text",x=5,y=0.032,label=expression(paste("42")),size=4)+
  annotate("text",x=6,y=0.056,label=expression(paste("0.12")),size=4)+
  annotate("text",x=6,y=0.032,label=expression(paste("42")),size=4)+
  annotate("text",x=1,y=max(SRCdata[SRCdata$Species=="Avsa","T.LT"],na.rm=T)+0.032,label=expression(paste(bold("a"))),size=5)+
  annotate("text",x=2,y=max(SRCdata[SRCdata$Species=="Hovu","T.LT"],na.rm=T)+0.032,label=expression(paste(bold("b"))),size=5)+
  annotate("text",x=3,y=max(SRCdata[SRCdata$Species=="Trae","T.LT"],na.rm=T)+0.032,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=4,y=max(SRCdata[SRCdata$Species=="Pegl","T.LT"],na.rm=T)+0.032,label=expression(paste(bold("d"))),size=5)+
  annotate("text",x=5,y=max(SRCdata[SRCdata$Species=="Zema","T.LT"],na.rm=T)+0.032,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=6,y=max(SRCdata[SRCdata$Species=="Chga","T.LT"],na.rm=T)+0.032,label=expression(paste(bold("e"))),size=5)
plot_LT

# stat
lm1<-lm(T.LT~Species,data=SRCdata)
anova(lm1)
tuk1<-HSD.test(lm1,"Species",group=T)
tuk1$groups

# LD
plot_LD<-ggplot(SRCdata,aes(x=Species,y=LD,fill=Metabolism))+
  theme_minimal()+
  geom_boxplot(lwd=0.2,fatten=5)+
  scale_fill_manual(values=c(C3 = "#6DB9F8", C4 = "#D9AB33"))+
  #geom_point(data=GExdata.0[GExdata.0$Dataset=="Dehydration",],aes(x=Species,y=LMA),size=4,shape=21,fill="yellow")+
  ylim(0,0.4)+
  #geom_hline(yintercept=0,lty=2)+
  ggtitle(expression(paste("LD (g cm"^-3,")")))+
  theme(axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13,face="italic"),
        legend.text=element_text(size=13),
        plot.title = element_text(size = 20, hjust = 0.5))+
  annotate("text",x=1,y=0.040,label=expression(paste(italic(bar("x"))," = 0.14")),size=4)+
  annotate("text",x=1,y=0.016,label=expression(paste(italic("n")," = 49")),size=4)+
  annotate("text",x=2,y=0.040,label=expression(paste("0.11")),size=4)+
  annotate("text",x=2,y=0.016,label=expression(paste("48")),size=4)+
  annotate("text",x=3,y=0.040,label=expression(paste("0.17")),size=4)+
  annotate("text",x=3,y=0.016,label=expression(paste("38")),size=4)+
  annotate("text",x=4,y=0.040,label=expression(paste("0.19")),size=4)+
  annotate("text",x=4,y=0.016,label=expression(paste("41")),size=4)+
  annotate("text",x=5,y=0.040,label=expression(paste("0.13")),size=4)+
  annotate("text",x=5,y=0.016,label=expression(paste("42")),size=4)+
  annotate("text",x=6,y=0.040,label=expression(paste("0.24")),size=4)+
  annotate("text",x=6,y=0.016,label=expression(paste("42")),size=4)+
  annotate("text",x=1,y=max(SRCdata[SRCdata$Species=="Avsa","LD"],na.rm=T)+0.032,label=expression(paste(bold("d"))),size=5)+
  annotate("text",x=2,y=max(SRCdata[SRCdata$Species=="Hovu","LD"],na.rm=T)+0.032,label=expression(paste(bold("e"))),size=5)+
  annotate("text",x=3,y=max(SRCdata[SRCdata$Species=="Trae","LD"],na.rm=T)+0.032,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=4,y=max(SRCdata[SRCdata$Species=="Pegl","LD"],na.rm=T)+0.032,label=expression(paste(bold("b"))),size=5)+
  annotate("text",x=5,y=max(SRCdata[SRCdata$Species=="Zema","LD"],na.rm=T)+0.032,label=expression(paste(bold("d"))),size=5)+
  annotate("text",x=6,y=max(SRCdata[SRCdata$Species=="Chga","LD"],na.rm=T)+0.032,label=expression(paste(bold("a"))),size=5)
plot_LD

# stat
lm1<-lm(LD~Species,data=SRCdata)
anova(lm1)
tuk1<-HSD.test(lm1,"Species",group=T)
tuk1$groups

# LDMC
plot_LDMC<-ggplot(SRCdata,aes(x=Species,y=LDMC,fill=Metabolism))+
  theme_minimal()+
  geom_boxplot(lwd=0.2,fatten=5)+
  scale_fill_manual(values=c(C3 = "#6DB9F8", C4 = "#D9AB33"))+
  #geom_point(data=GExdata.0[GExdata.0$Dataset=="Dehydration",],aes(x=Species,y=LMA),size=4,shape=21,fill="yellow")+
  ylim(0,0.3)+
  #geom_hline(yintercept=0,lty=2)+
  ggtitle(expression(paste("LDMC (g g"^-1,")")))+
  theme(axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13,face="italic"),
        legend.text=element_text(size=13),
        plot.title = element_text(size = 20, hjust = 0.5))+
  #ylab(expression(paste("LDMC (g g"^-1,")")))+
  annotate("text",x=1,y=0.024,label=expression(paste(italic(bar("x"))," = 0.13")),size=4)+
  annotate("text",x=1,y=0,label=expression(paste(italic("n")," = 44")),size=4)+
  annotate("text",x=2,y=0.024,label=expression(paste("0.11")),size=4)+
  annotate("text",x=2,y=0,label=expression(paste("47")),size=4)+
  annotate("text",x=3,y=0.024,label=expression(paste("0.16")),size=4)+
  annotate("text",x=3,y=0,label=expression(paste("38")),size=4)+
  annotate("text",x=4,y=0.024,label=expression(paste("0.11")),size=4)+
  annotate("text",x=4,y=0,label=expression(paste("41")),size=4)+
  annotate("text",x=5,y=0.024,label=expression(paste("0.10")),size=4)+
  annotate("text",x=5,y=0,label=expression(paste("41")),size=4)+
  annotate("text",x=6,y=0.024,label=expression(paste("0.16")),size=4)+
  annotate("text",x=6,y=0,label=expression(paste("42")),size=4)+
  annotate("text",x=1,y=max(SRCdata[SRCdata$Species=="Avsa","LDMC"],na.rm=T)+0.024,label=expression(paste(bold("b"))),size=5)+
  annotate("text",x=2,y=max(SRCdata[SRCdata$Species=="Hovu","LDMC"],na.rm=T)+0.024,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=3,y=max(SRCdata[SRCdata$Species=="Trae","LDMC"],na.rm=T)+0.024,label=expression(paste(bold("a"))),size=5)+
  annotate("text",x=4,y=max(SRCdata[SRCdata$Species=="Pegl","LDMC"],na.rm=T)+0.024,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=5,y=max(SRCdata[SRCdata$Species=="Zema","LDMC"],na.rm=T)+0.024,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=6,y=max(SRCdata[SRCdata$Species=="Chga","LDMC"],na.rm=T)+0.024,label=expression(paste(bold("a"))),size=5)

plot_LDMC
# stat
lm1<-lm(LDMC~Species,data=SRCdata)
anova(lm1)
tuk1<-HSD.test(lm1,"Species",group=T)
tuk1$groups


##all graphs for leaf structure

Leaf_structure<- ggarrange(plot_LMA, plot_LT, plot_LD, plot_LDMC, ncol = 2, nrow = 2, common.legend= TRUE, legend = "bottom")
Leaf_structure

ggsave(filename = "../results/leaf_structure.jpg", plot = Leaf_structure, width = 10, height = 10)
```

##leaf percentage loss
```{r}
# PLTdry
PLTdry_plot<-ggplot(SRCdata,aes(x=Species,y=D.PLT,fill=Metabolism))+
   geom_boxplot(lwd=0.2,fatten=5)+
  theme_minimal()+
  scale_fill_manual(values=c(C3 = "#6DB9F8", C4 = "#D9AB33"))+
   ggtitle(expression(paste("PL Thickness"["dry"]," (%)")))+
  ylim(0,100)+
  theme(axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13,face="italic"),
        legend.position = "none",
        #legend.text=element_text(size=13),
        plot.title = element_text(size = 20, hjust = 0.5))+
  #ylab()+
  annotate("text",x=1,y=10,label=expression(paste(italic(bar("x"))," = 46.1")),size=4)+
  annotate("text",x=1,y=4,label=expression(paste(italic("n")," = 49")),size=4)+
  annotate("text",x=2,y=10,label=expression(paste("69.8")),size=4)+
  annotate("text",x=2,y=4,label=expression(paste("48")),size=4)+
  annotate("text",x=3,y=10,label=expression(paste("45.8")),size=4)+
  annotate("text",x=3,y=4,label=expression(paste("38")),size=4)+
  annotate("text",x=4,y=10,label=expression(paste("56.5")),size=4)+
  annotate("text",x=4,y=4,label=expression(paste("41")),size=4)+
  annotate("text",x=5,y=10,label=expression(paste("69.2")),size=4)+
  annotate("text",x=5,y=4,label=expression(paste("42")),size=4)+
  annotate("text",x=6,y=10,label=expression(paste("46.4")),size=4)+
  annotate("text",x=6,y=4,label=expression(paste("42")),size=4)+
  annotate("text",x=1,y=max(SRCdata[SRCdata$Species=="Avsa","D.PLT"],na.rm=T)+8,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=2,y=max(SRCdata[SRCdata$Species=="Hovu","D.PLT"],na.rm=T)+8,label=expression(paste(bold("a"))),size=5)+
  annotate("text",x=3,y=max(SRCdata[SRCdata$Species=="Trae","D.PLT"],na.rm=T)+8,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=4,y=max(SRCdata[SRCdata$Species=="Pegl","D.PLT"],na.rm=T)+8,label=expression(paste(bold("b"))),size=5)+
  annotate("text",x=5,y=max(SRCdata[SRCdata$Species=="Zema","D.PLT"],na.rm=T)+8,label=expression(paste(bold("a"))),size=5)+
  annotate("text",x=6,y=max(SRCdata[SRCdata$Species=="Chga","D.PLT"],na.rm=T)+8,label=expression(paste(bold("c"))),size=5)

PLTdry_plot
# stat
lm1<-lm(D.PLT~Species,data=SRCdata)
anova(lm1)
tuk1<-HSD.test(lm1,"Species",group=T)
tuk1$groups

# PLAdry
PLAdry_plot<-ggplot(SRCdata,aes(x=Species,y=D.PLA,fill=Metabolism))+
   geom_boxplot(lwd=0.2,fatten=5)+
  theme_minimal()+
  scale_fill_manual(values=c(C3 = "#6DB9F8", C4 = "#D9AB33"))+
   ggtitle(expression(paste("PL Area"["dry"]," (%)")))+
  ylim(10,90)+
  theme(axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13,face="italic"),
        legend.position = "none",
        #legend.text=element_text(size=13),
        plot.title = element_text(size = 20, hjust = 0.5))+
  annotate("text",x=1,y=21.2,label=expression(paste(italic(bar("x"))," = 49.4")),size=4)+
  annotate("text",x=1,y=16.4,label=expression(paste(italic("n")," = 48")),size=4)+
  annotate("text",x=2,y=21.2,label=expression(paste("43.7")),size=4)+
  annotate("text",x=2,y=16.4,label=expression(paste("46")),size=4)+
  annotate("text",x=3,y=21.2,label=expression(paste("45.8")),size=4)+
  annotate("text",x=3,y=16.4,label=expression(paste("38")),size=4)+
  annotate("text",x=4,y=21.2,label=expression(paste("60.2")),size=4)+
  annotate("text",x=4,y=16.4,label=expression(paste("41")),size=4)+
  annotate("text",x=5,y=21.2,label=expression(paste("53.0")),size=4)+
  annotate("text",x=5,y=16.4,label=expression(paste("41")),size=4)+
  annotate("text",x=6,y=21.2,label=expression(paste("63.1")),size=4)+
  annotate("text",x=6,y=16.4,label=expression(paste("42")),size=4)+
  annotate("text",x=1,y=max(SRCdata[SRCdata$Species=="Avsa","D.PLA"],na.rm=T)+6.4,label=expression(paste(bold("bc"))),size=5)+
  annotate("text",x=2,y=max(SRCdata[SRCdata$Species=="Hovu","D.PLA"],na.rm=T)+6.4,label=expression(paste(bold("d"))),size=5)+
  annotate("text",x=3,y=max(SRCdata[SRCdata$Species=="Trae","D.PLA"],na.rm=T)+6.4,label=expression(paste(bold("cd"))),size=5)+
  annotate("text",x=4,y=max(SRCdata[SRCdata$Species=="Pegl","D.PLA"],na.rm=T)+6.4,label=expression(paste(bold("a"))),size=5)+
  annotate("text",x=5,y=max(SRCdata[SRCdata$Species=="Zema","D.PLA"],na.rm=T)+6.4,label=expression(paste(bold("b"))),size=5)+
  annotate("text",x=6,y=max(SRCdata[SRCdata$Species=="Chga","D.PLA"],na.rm=T)+6.4,label=expression(paste(bold("a"))),size=5)

PLAdry_plot

# stat
lm1<-lm(D.PLA~Species,data=SRCdata)
anova(lm1)
tuk1<-HSD.test(lm1,"Species",group=T)
tuk1$groups


# PLLedry
PLLedry_plot<-ggplot(SRCdata,aes(x=Species,y=D.PLLe,fill=Metabolism))+
  geom_boxplot(lwd=0.2,fatten=5)+
  theme_minimal()+
  scale_fill_manual(values=c(C3 = "#6DB9F8", C4 = "#D9AB33"))+
   ggtitle(expression(paste("PL Length"["dry"]," (%)")))+
  ylim(-15,20)+
  theme(axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13,face="italic"),
        legend.position = "none",
        #legend.text=element_text(size=13),
        plot.title = element_text(size = 20, hjust = 0.5))+
  annotate("text",x=1,y=-6,label=expression(paste(italic(bar("x"))," = 1.9")),size=4)+
  annotate("text",x=1,y=-8,label=expression(paste(italic("n")," = 41")),size=4)+
  annotate("text",x=2,y=-6,label=expression(paste("2.0")),size=4)+
  annotate("text",x=2,y=-8,label=expression(paste("46")),size=4)+
  annotate("text",x=3,y=-6,label=expression(paste("1.4")),size=4)+
  annotate("text",x=3,y=-8,label=expression(paste("38")),size=4)+
  annotate("text",x=4,y=-6,label=expression(paste("2.9")),size=4)+
  annotate("text",x=4,y=-8,label=expression(paste("39")),size=4)+
  annotate("text",x=5,y=-6,label=expression(paste("3.2")),size=4)+
  annotate("text",x=5,y=-8,label=expression(paste("42")),size=4)+
  annotate("text",x=6,y=-6,label=expression(paste("3.4")),size=4)+
  annotate("text",x=6,y=-8,label=expression(paste("41")),size=4)+
  annotate("text",x=1,y=max(SRCdata[SRCdata$Species=="Avsa","D.PLLe"],na.rm=T)+3,label=expression(paste(bold("bc"))),size=5)+
  annotate("text",x=2,y=max(SRCdata[SRCdata$Species=="Hovu","D.PLLe"],na.rm=T)+3,label=expression(paste(bold("bc"))),size=5)+
  annotate("text",x=3,y=max(SRCdata[SRCdata$Species=="Trae","D.PLLe"],na.rm=T)+3,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=4,y=max(SRCdata[SRCdata$Species=="Pegl","D.PLLe"],na.rm=T)+3,label=expression(paste(bold("ab"))),size=5)+
  annotate("text",x=5,y=max(SRCdata[SRCdata$Species=="Zema","D.PLLe"],na.rm=T)+3,label=expression(paste(bold("a"))),size=5)+
  annotate("text",x=6,y=max(SRCdata[SRCdata$Species=="Chga","D.PLLe"],na.rm=T)+3,label=expression(paste(bold("a"))),size=5)

PLLedry_plot
# stat
lm1<-lm(D.PLLe~Species,data=SRCdata)
anova(lm1)
tuk1<-HSD.test(lm1,"Species",group=T)
tuk1$groups

# PLWidry (PLW1dry)
PLWdry_plot<-ggplot(SRCdata,aes(x=Species,y=D.PLW1,fill=Metabolism))+
  geom_boxplot(lwd=0.2,fatten=5)+
  theme_minimal()+
  scale_fill_manual(values=c(C3 = "#6DB9F8", C4 = "#D9AB33"))+
   ggtitle(expression(paste("PL Width"["dry"]," (%)")))+
  ylim(0,100)+
  theme(axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13,face="italic"),
        legend.position = "none",
        #legend.text=element_text(size=13),
        plot.title = element_text(size = 20, hjust = 0.5))+
  annotate("text",x=1,y=14,label=expression(paste(italic(bar("x"))," = 49.0")),size=4)+
  annotate("text",x=1,y=8,label=expression(paste(italic("n")," = 49")),size=4)+
  annotate("text",x=2,y=14,label=expression(paste("44.9")),size=4)+
  annotate("text",x=2,y=8,label=expression(paste("46")),size=4)+
  annotate("text",x=3,y=14,label=expression(paste("46.8")),size=4)+
  annotate("text",x=3,y=8,label=expression(paste("38")),size=4)+
  annotate("text",x=4,y=14,label=expression(paste("57.9")),size=4)+
  annotate("text",x=4,y=8,label=expression(paste("41")),size=4)+
  annotate("text",x=5,y=14,label=expression(paste("56.3")),size=4)+
  annotate("text",x=5,y=8,label=expression(paste("42")),size=4)+
  annotate("text",x=6,y=14,label=expression(paste("61.6")),size=4)+
  annotate("text",x=6,y=8,label=expression(paste("42")),size=4)+
  annotate("text",x=1,y=max(SRCdata[SRCdata$Species=="Avsa","D.PLW1"],na.rm=T)+8,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=2,y=max(SRCdata[SRCdata$Species=="Hovu","D.PLW1"],na.rm=T)+8,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=3,y=max(SRCdata[SRCdata$Species=="Trae","D.PLW1"],na.rm=T)+8,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=4,y=max(SRCdata[SRCdata$Species=="Pegl","D.PLW1"],na.rm=T)+8,label=expression(paste(bold("ab"))),size=5)+
  annotate("text",x=5,y=max(SRCdata[SRCdata$Species=="Zema","D.PLW1"],na.rm=T)+8,label=expression(paste(bold("b"))),size=5)+
  annotate("text",x=6,y=max(SRCdata[SRCdata$Species=="Chga","D.PLW1"],na.rm=T)+8,label=expression(paste(bold("a"))),size=5)

PLWdry_plot

# stat
lm1<-lm(D.PLW1~Species,data=SRCdata)
anova(lm1)
tuk1<-HSD.test(lm1,"Species",group=T)
tuk1$groups


# PLV (PLW1dry)
PLV_plot<-ggplot(SRCdata,aes(x=Species,y=D.PLV,fill=Metabolism))+
  geom_boxplot(lwd=0.2,fatten=5)+
  theme_minimal()+
  scale_fill_manual(values=c(C3 = "#6DB9F8", C4 = "#D9AB33"))+
   ggtitle(expression(paste("PL Volume"["dry"]," (%)")))+
  ylim(40,110)+
  theme(axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13,face="italic"),
        legend.text=element_text(size=13),
        plot.title = element_text(size = 20, hjust = 0.5))+
  annotate("text",x=1,y=50,label=expression(paste(italic(bar("x"))," = 71.6")),size=4)+
  annotate("text",x=1,y=45,label=expression(paste(italic("n")," = 49")),size=4)+
  annotate("text",x=2,y=50,label=expression(paste("82.5")),size=4)+
  annotate("text",x=2,y=45,label=expression(paste("46")),size=4)+
  annotate("text",x=3,y=50,label=expression(paste("70.5")),size=4)+
  annotate("text",x=3,y=45,label=expression(paste("38")),size=4)+
  annotate("text",x=4,y=50,label=expression(paste("82.7")),size=4)+
  annotate("text",x=4,y=45,label=expression(paste("41")),size=4)+
  annotate("text",x=5,y=50,label=expression(paste("85.3")),size=4)+
  annotate("text",x=5,y=45,label=expression(paste("41")),size=4)+
  annotate("text",x=6,y=50,label=expression(paste("80.2")),size=4)+
  annotate("text",x=6,y=45,label=expression(paste("42")),size=4)+
  annotate("text",x=1,y=max(SRCdata[SRCdata$Species=="Avsa","D.PLV"],na.rm=T)+8,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=2,y=max(SRCdata[SRCdata$Species=="Hovu","D.PLV"],na.rm=T)+8,label=expression(paste(bold("ab"))),size=5)+
  annotate("text",x=3,y=max(SRCdata[SRCdata$Species=="Trae","D.PLV"],na.rm=T)+8,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=4,y=max(SRCdata[SRCdata$Species=="Pegl","D.PLV"],na.rm=T)+8,label=expression(paste(bold("ab"))),size=5)+
  annotate("text",x=5,y=max(SRCdata[SRCdata$Species=="Zema","D.PLV"],na.rm=T)+8,label=expression(paste(bold("a"))),size=5)+
  annotate("text",x=6,y=max(SRCdata[SRCdata$Species=="Chga","D.PLV"],na.rm=T)+8,label=expression(paste(bold("b"))),size=5)

PLV_plot


# stat
lm1<-lm(D.PLV~Species,data=SRCdata)
anova(lm1)
tuk1<-HSD.test(lm1,"Species",group=T)
tuk1$groups

##all graphs for leaf structure

# Extract the legend
legend <- get_legend(
  PLV_plot +
    theme(legend.position = "right", text = element_text(size=20)) # Adjust position if needed
)

#legend <- plot(legend) #to check if it plots

#now remove the legend from the PLV plot
PLV_plot <- PLV_plot + theme(legend.position = "none")

Percent_loss_dry<- ggarrange(PLTdry_plot, PLAdry_plot, PLWdry_plot, ncol =3, nrow = 1, common.legend = T, legend = "bottom")

Percent_loss_dry

ggsave(filename = "../results/Percentloss_dry.jpg", plot = Percent_loss_dry, width = 10, height = 5)

```



#FVFM recovery

T for initial, fully hydrated or turgid -- STAGE 1
F for after dehydration or fresh -- STAGE 2
R for Rehydration -- STAGE 3
D for dry -- STAGE 4

SRCdata$PLCF = 100* (1- (SRCdata$F.FvFm/SRCdata$T.FvFm))

```{r}

SRCdata = read.csv("../data/SRCdata.csv",header=TRUE)

SRCdata_recovery <- SRCdata %>% dplyr::select(Species, Metabolism, F.RWC,R.FvFm)


# data per species, FvFm ####
SRCdata_recovery$F.RWC <- as.numeric(SRCdata_recovery$F.RWC)
SRCdata_recovery$R.FvFm <- as.numeric(SRCdata_recovery$R.FvFm)

#max values for relative plotting
max.FvFm<- ddply(SRCdata_recovery, .(Species, Metabolism), summarise,
                   mean.FvFm = mean(`R.FvFm`[F.RWC > 90], na.rm = TRUE))

#format for fitting for Megan's script for RWC
FVFM_recovery_curve <- SRCdata_recovery %>%
  dplyr::select(Species, F.RWC , `R.FvFm` ) %>%
  dplyr::rename(psi = F.RWC) %>%
  dplyr::rename(gs = `R.FvFm`) %>% #for the script by Megan
  dplyr::rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()

write.csv(x = FVFM_recovery_curve, file = "../results/fvfm/FVFM_recovery_curve.csv") #ready for MB script

#replace calculated fvfm max by the ones just calculated above and calculate RWC fvfm50 accordingly


###recovery fittings with psi instead of RWC
SRCdata_PV = read.csv("../data/SRCdata_PV.csv",header=TRUE)

SRCdata_PVrecovery <- SRCdata_PV %>% dplyr::select(Species, Metabolism, Psileaf.from.RWC,R.FvFm)


# data per species, FvFm ####
SRCdata_PVrecovery$Psileaf.from.RWC <- as.numeric(SRCdata_PVrecovery$Psileaf.from.RWC)
SRCdata_PVrecovery$R.FvFm <- as.numeric(SRCdata_PVrecovery$R.FvFm)

#max values for relative plotting
max.FvFm<- ddply(SRCdata_PVrecovery, .(Species, Metabolism), summarise,
                   max.FvFm = max(`R.FvFm`, na.rm = TRUE))

#format for fitting for Megan's script for RWC
FVFM_PVrecovery_curve <- SRCdata_PVrecovery %>%
  dplyr::select(Species, Psileaf.from.RWC , `R.FvFm` ) %>%
  dplyr::rename(psi = `Psileaf.from.RWC`) %>%
  dplyr::rename(gs = `R.FvFm`) %>% #for the script by Megan
  dplyr::rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()

FVFM_PVrecovery_curve$psi <- FVFM_PVrecovery_curve$psi*(-1)

write.csv(x = FVFM_PVrecovery_curve, file = "../results/fvfm/FVFM_PVrecovery_curve.csv") #ready for MB script

```

##AVSA 
```{r}
SRCdata_recovery_avsa <- SRCdata %>% dplyr::select(Species, Metabolism, F.RWC ,R.FvFm)%>% filter(Species== "Avsa")

FvFm_recov_avsa <- read_csv("../results/fvfm/model_fitting_results_recovery.csv") %>% 
  filter(Species == 'Avsa') %>%
  filter(model == 'Logistic')

#output model
x_seq.avsa <- seq(0, 100, length.out = length(SRCdata_recovery_avsa$F.RWC))

y_model.avsa.recovery <-  FvFm_recov_avsa$A / (1 + ((x_seq.avsa  / FvFm_recov_avsa$C)^FvFm_recov_avsa$B))

#plot
Avsa_fvfm_recovery<-ggplot(SRCdata_recovery_avsa,aes(x=F.RWC,y=R.FvFm))+
  geom_point(data=SRCdata_recovery_avsa,aes(x=F.RWC,y=R.FvFm, colour= "blue"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("blue")) +
  geom_line(aes(x = x_seq.avsa, y = y_model.avsa.recovery), color = 'blue', size=2, alpha=0.7)+
  geom_vline(xintercept=FvFm_recov_avsa$psi_kleaf50,color="blue",lty=5, linewidth= 1)+
  xlim(0, 100)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Recovery FvFm")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("A. sativa")


Avsa_fvfm_recovery

```

##HOVU
```{r}
SRCdata_recovery_hovu <- SRCdata %>%  dplyr::select(Species, F.RWC, `R.FvFm` ) %>% filter(Species== "Hovu")

FvFm_recov_hovu <- read_csv("../results/fvfm/model_fitting_results_recovery.csv") %>% 
  filter(Species == 'Hovu') %>%
  filter(model == 'Logistic')

#output model
x_seq.hovu <- seq(0,100,length.out = length(SRCdata_recovery_hovu$F.RWC))

y_model.hovu.recovery <-  FvFm_recov_hovu$A / (1 + ((x_seq.hovu/FvFm_recov_hovu$C)^FvFm_recov_hovu$B))

#plot
hovu_fvfm_recovery<-ggplot(SRCdata_recovery_hovu,aes(x=F.RWC,y=R.FvFm))+
  geom_point(data=SRCdata_recovery_hovu,aes(x=F.RWC,y=R.FvFm, colour= "blue"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("blue")) +
  geom_line(aes(x = x_seq.hovu, y = y_model.hovu.recovery), color = 'blue', size=2, alpha=0.7)+
  geom_vline(xintercept=FvFm_recov_hovu$psi_kleaf50,color="blue",lty=5, linewidth= 1)+
  xlim(0, 100)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Recovery FvFm")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("H. vulgare")

hovu_fvfm_recovery
```

##TRAE
```{r}
SRCdata_trae_recovery <- SRCdata %>%  dplyr::select(Species, F.RWC, `R.FvFm` ) %>% filter(Species== "Trae")

FvFm_recov_trae <- read_csv("../results/fvfm/model_fitting_results_recovery.csv") %>% 
  filter(Species == 'Trae') %>%
  filter(model == 'Logistic')

#output model
x_seq.trae <- seq(0,100, length.out = length(SRCdata_trae_recovery$F.RWC)) 

y_model.trae.recovery <-  FvFm_recov_trae$A / (1 + ((x_seq.trae  / FvFm_recov_trae$C)^FvFm_recov_trae$B))

#plot
trae_fvfm_recovery<-ggplot(SRCdata_trae_recovery,aes(x=F.RWC,y=R.FvFm))+
  geom_point(data=SRCdata_trae_recovery,aes(x=F.RWC,y=R.FvFm, colour= "blue"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("blue")) +
  geom_line(aes(x = x_seq.trae, y = y_model.trae.recovery), color = 'blue', size=2, alpha=0.7)+
   geom_vline(xintercept=FvFm_recov_trae$psi_kleaf50,color="blue",lty=5, linewidth= 1)+
  xlim(0,100)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Recovery FvFm")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("T. aestivum")

trae_fvfm_recovery
```

##PEGL
```{r}
SRCdata_pegl_recovery <- SRCdata %>%  dplyr::select(Species, F.RWC, `R.FvFm` ) %>% filter(Species== "Pegl")

FvFm_recov_pegl <- read_csv("../results/fvfm/model_fitting_results_recovery.csv") %>% 
  filter(Species == 'Pegl') %>%
  filter(model == 'Logistic')

#output model
x_seq.pegl <- seq(0,100, length.out = length(SRCdata_pegl_recovery$F.RWC))

y_model.pegl.recovery <-  FvFm_recov_pegl$A / (1 + ((x_seq.pegl  / FvFm_recov_pegl$C)^FvFm_recov_pegl$B))

#plot
pegl_fvfm_recovery<-ggplot(SRCdata_pegl_recovery,aes(x=F.RWC,y=R.FvFm))+
  geom_point(data=SRCdata_pegl_recovery,aes(x=F.RWC,y=R.FvFm, colour= "blue"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("blue")) +
  geom_line(aes(x = x_seq.pegl, y = y_model.pegl.recovery), color = 'blue', size=2, alpha=0.7)+
    geom_vline(xintercept=FvFm_recov_pegl$psi_kleaf50,color="blue",lty=5, linewidth= 1)+
  xlim(0,100)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Recovery FvFm")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("P. glaucum")

pegl_fvfm_recovery
```

##CHGA
```{r}
SRCdata_chga_recovery <- SRCdata %>%  dplyr::select(Species, F.RWC, `R.FvFm` ) %>% filter(Species== "Chga")

FvFm_recov_chga <- read_csv("../results/fvfm/model_fitting_results_recovery.csv") %>% 
  filter(Species == 'Chga') %>%
  filter(model == 'Logistic')

#output model
x_seq.chga <- seq(0,100, length.out = length(SRCdata_chga_recovery$F.RWC)) 

y_model.chga.recovery <- FvFm_recov_chga$A / (1 + ((x_seq.chga / FvFm_recov_chga$C)^FvFm_recov_chga$B))

#plot
chga_fvfm_recovery<-ggplot(SRCdata_chga_recovery,aes(x=F.RWC,y=R.FvFm))+
  geom_point(data=SRCdata_chga_recovery,aes(x=F.RWC,y=R.FvFm, colour= "blue"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("blue")) +
  geom_line(aes(x = x_seq.chga, y = y_model.chga.recovery), color = 'blue', size=2, alpha=0.7)+
    geom_vline(xintercept=FvFm_recov_chga$psi_kleaf50,color="blue",lty=5, linewidth= 1)+
  xlim(0,100)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Recovery FvFm")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("C. gayan")

chga_fvfm_recovery
```

##ZEMA
```{r}
SRCdata_zema_recovery <- SRCdata %>%  dplyr::select(Species, F.RWC, `R.FvFm` ) %>% filter(Species== "Zema")

FvFm_recov_zema <- read_csv("../results/fvfm/model_fitting_results_recovery.csv") %>% 
  filter(Species == 'Zema') %>%
  filter(model == 'Logistic')

#output model
x_seq.zema <- seq(0,100, length.out = length(SRCdata_zema_recovery$F.RWC)) 

y_model.zema.recovery <-  FvFm_recov_zema$A / (1 + ((x_seq.zema / FvFm_recov_zema$C)^FvFm_recov_zema$B))

#plot
zema_fvfm_recovery<-ggplot(SRCdata_zema_recovery,aes(x=F.RWC,y=R.FvFm))+
  geom_point(data=SRCdata_zema_recovery,aes(x=F.RWC,y=R.FvFm, colour= "blue"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("blue")) +
  geom_line(aes(x = x_seq.zema, y = y_model.zema.recovery), color = 'blue', size=2, alpha=0.7)+
   geom_vline(xintercept=FvFm_recov_zema$psi_kleaf50,color="blue",lty=5, linewidth= 1)+
  xlim(0, 100)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Recovery FvFm")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("Z. mays")

zema_fvfm_recovery
```

##plot SI
```{r}
SI_fvfm_recovery <- ggarrange(Avsa_fvfm_recovery, hovu_fvfm_recovery, trae_fvfm_recovery, chga_fvfm_recovery, pegl_fvfm_recovery, zema_fvfm_recovery)
SI_fvfm_recovery

ggsave(filename = "../results/FigureSI_fvfmrecovery.jpg", plot = SI_fvfm_recovery, width = 12, height = 8)
```

##FvFm table
```{r}

FvFm_summary <- tribble(
  ~Species, ~RWC_FvFm50,
  "Avsa", FvFm_recov_avsa$psi_kleaf50, "Hovu", FvFm_recov_hovu$psi_kleaf50, "Trae", FvFm_recov_trae$psi_kleaf50,
  "Pegl", FvFm_recov_pegl$psi_kleaf50, "Chga", FvFm_recov_chga$psi_kleaf50, "Zema", FvFm_recov_zema$psi_kleaf50)

write.csv(FvFm_summary, file = "../results/FvFm_summary.csv")
```

#PLCF - non recoverable
```{r}
SRCdata = read.csv("../data/SRCdata.csv",header=TRUE)

SRCdata_recovery <- SRCdata %>% dplyr::select(Species, Metabolism, F.RWC,R.FvFm, T.FvFm)


# data per species, FvFm ####
SRCdata_recovery$F.RWC <- as.numeric(SRCdata_recovery$F.RWC)
SRCdata_recovery$T.FvFm <- as.numeric(SRCdata_recovery$T.FvFm)
SRCdata_recovery$R.FvFm <- as.numeric(SRCdata_recovery$R.FvFm)

SRCdata_recovery$PLNCF <- 100 * (1- (SRCdata_recovery$R.FvFm/SRCdata_recovery$T.FvFm))


#format for fitting for Megan's script for RWC
FVFM_recovery_curve <- SRCdata_recovery %>%
  dplyr::select(Species, F.RWC , `PLNCF` ) %>%
  dplyr::rename(psi = F.RWC) %>%
  dplyr::rename(gs = `PLNCF`) %>% #for the script by Megan
  dplyr::rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()

write.csv(x = FVFM_recovery_curve, file = "../results/fvfm/FVFM_recovery_curve_PLNCF.csv") #ready for MB script


library(drc)
library(RColorBrewer) 
#DR curve fitting 
DR.m <- drm(gs ~ psi, 
            data= FVFM_recovery_curve,
            species, #fit separate curves for each timepoint
            robust = 'mean', #non-robust least squares estimation ("mean")
            #fct = LL.3u(fixed = c(NA, 100, NA)))  # upper limit fixed at 100
            fct = LL.3(names = c("Hill slope", "max", "EC50")))
print(DR.m)
compParm(DR.m, "EC50", "-")
#extract manually: 
compParm(DR.m, "e", "-")

summary <- summary(DR.m)[[3]] #Coeffs are stored as 3rd element in list obj
confint(DR.m, level = 0.90)


Species <- unique(FVFM_recovery_curve$species)
curve_cnt <- length(Species)
cols <- colorRampPalette(brewer.pal(8,"Set2"))(curve_cnt)

par(mfrow=c(2,3))

for (i in 1:curve_cnt) {

  DR <- filter(FVFM_recovery_curve, species == Species[i])

  DR.mi <- drm(gs ~ psi,
               data = DR,
               robust = "mean",
               fct = LL.3(names = c("Hill slope", "Max", "EC50"))
  )

  plot(DR.mi,
       type = "all",
       col = cols[i],
       pch = 16,
       lwd = 1,
       cex.axis = 0.8,
       xlim = c(0, 100),
       ylim = c(0, 100),
       legend = TRUE,
       legendText = Species[i],
       xlab = "RWC (%)",
       ylab = "PLCFR"
  )

  plot(DR.mi,
       col = cols[i],
       xlim = c(0, 100),
       ylim = c(0, 100),
       add = TRUE,
       type = "confidence"
  )
}

#for Chga:  the curves does not reach a steady plateau. Therefore we can’t quantitatively compare best-fit curve EC50 and top values.

par(mfrow=c(1,1))

plot(NA, xlim=c(0,100), ylim=c(0,100), xlab="RWC (%)", ylab="PLCFR")  # blank canvas

for (i in 1:curve_cnt){ 
  DR = filter(FVFM_recovery_curve, species == Species[i]) 
  DR.mi <- drm(gs ~ psi, 
              data= DR,
              robust = 'mean', #non-robust least squares estimation ("mean")
              fct = LL.3(names = c("Hill slope", "Max", "EC50")))
  plot(DR.mi,
       type= "all",
       col=cols[i], #auto color selection for curves
       pch=16,
       lwd=1,
       cex.axis=0.8,
       xlim = c(0, 100),
       ylim = c(0, 100),
       legend = FALSE,
       xlab= "RWC (%)",
       ylab = "PLCFR")
  plot(DR.mi,
       col = cols[i],
       xlim = c(0, 100),
       ylim = c(0, 100),
       add=TRUE,
       type='confidence')
  par(new=TRUE)} #Add new=TRUE arg to overlay graphs

# Add legend for all species
legend("topright",
       legend = Species,
       col = cols,
       pch = 16,
       lwd = 2,
       bty = "n"
)

###Final plot
# Define metabolism per species
metabolism <- c(
  Avsa = "C3",
  Hovu = "C3",
  Trae = "C3",
  Chga = "C4",
  Pegl = "C4",
  Zema = "C4"
)

# Colors
cols <- ifelse(metabolism[Species] == "C3", "#6DB9F8", "#D9AB33")

# Line types per species
lt_C3 <- c("solid", "dotted", "longdash")
lt_C4 <- c("solid", "dotted", "longdash")

line_types <- character(length(Species))

# Assign line types within each metabolism group
line_types[metabolism[Species] == "C3"] <- lt_C3[1:sum(metabolism[Species]=="C3")]
line_types[metabolism[Species] == "C4"] <- lt_C4[1:sum(metabolism[Species]=="C4")]

par(mfrow=c(1,1))

# Define order
Species_order <- c("Avsa", "Hovu", "Trae", "Pegl", "Zema", "Chga")
cols_ordered <- cols[match(Species_order, Species)]
line_types_ordered <- line_types[match(Species_order, Species)]

# Blank canvas
plot(NA, xlim=c(0,100), ylim=c(0,100),
     xlab="RWC (%)", ylab="PLCFR")

first <- TRUE
for (i in 1:length(Species_order)) { 
  sp <- Species_order[i]
  DR <- subset(FVFM_recovery_curve, species == sp)
  
  DR.mi <- drm(
    gs ~ psi,
    data = DR,
    robust = 'mean',
    fct = LL.3(names = c("Hill slope", "Max", "EC50"))
  )
  
  # Plot curve
  plot(DR.mi,
       type = "all",
       col = cols_ordered[i],
       lty = line_types_ordered[i],
       pch = 16,
       lwd = 2,
       xlim = c(0,100),
       ylim = c(0,100),
       legend = FALSE,
       xlab = "RWC (%)",
       ylab = "PLCFR")
  
  # Plot confidence interval
  plot(DR.mi,
       type = "confidence",
       add = TRUE,
       col = cols_ordered[i],
       lty = line_types_ordered[i],
       xlim = c(0, 100),
       ylim = c(0, 100))
  
  if (first) {
    first <- FALSE
  } else {
    par(new = TRUE)
  }
}

# Add sorted legend
legend("topright",
       legend = Species_order,
       col = cols_ordered,
       lty = line_types_ordered,
       pch = 16,
       lwd = 2,
       bty = "n")

# Add panel letter
mtext("A.", side = 3, line = 2, at = 1, cex = 1.5, font = 2)



```


##AVSA 
```{r}
SRCdata_recovery_avsa <- FVFM_recovery_curve %>% rename(F.RWC = psi) %>%
  rename(PLNCF = gs)%>% dplyr::rename(Species = species) %>% filter(Species== "Avsa")

FvFm_recov_avsa <- read_csv("../results/fvfm/PLNCF/model_fitting_results_PLNCF.csv") %>% 
  filter(Species == 'Avsa') %>%
  filter(model == 'Linear')

#output model
x_seq.avsa <- seq(0, 100, length.out = length(SRCdata_recovery_avsa$F.RWC))

y_model.avsa.recovery <-  FvFm_recov_avsa$A + x_seq.avsa*FvFm_recov_avsa$B

#plot
Avsa_fvfm_recovery<-ggplot(SRCdata_recovery_avsa,aes(x=F.RWC,y=PLNCF))+
  geom_point(data=SRCdata_recovery_avsa,aes(x=F.RWC,y=PLNCF, colour= "blue"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("blue")) +
  geom_line(aes(x = x_seq.avsa, y = y_model.avsa.recovery), color = 'blue', size=2, alpha=0.7)+
  geom_vline(xintercept=FvFm_recov_avsa$RWC_fvfm50,color="blue",lty=5, linewidth= 1)+
  xlim(0, 100)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("PLNCF")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("A. sativa")


Avsa_fvfm_recovery

```

##HOVU
```{r}
SRCdata_recovery_hovu <- FVFM_recovery_curve %>% rename(F.RWC = psi) %>%
  rename(PLNCF = gs)%>% dplyr::rename(Species = species) %>% filter(Species== "Hovu")

FvFm_recov_hovu <- read_csv("../results/fvfm/PLNCF/model_fitting_results_PLNCF.csv") %>% 
  filter(Species == 'Hovu') %>%
  filter(model == 'Linear')

#output model
x_seq.hovu <- seq(0,100,length.out = length(SRCdata_recovery_hovu$F.RWC))

y_model.hovu.recovery <-  FvFm_recov_hovu$A + x_seq.hovu*FvFm_recov_hovu$B

#plot
hovu_fvfm_recovery<-ggplot(SRCdata_recovery_hovu,aes(x=F.RWC,y=PLNCF))+
  geom_point(data=SRCdata_recovery_hovu,aes(x=F.RWC,y=PLNCF, colour= "blue"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("blue")) +
  geom_line(aes(x = x_seq.hovu, y = y_model.hovu.recovery), color = 'blue', size=2, alpha=0.7)+
  geom_vline(xintercept=FvFm_recov_hovu$RWC_fvfm50,color="blue",lty=5, linewidth= 1)+
  xlim(0, 100)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("PLNCF")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("H. vulgare")

hovu_fvfm_recovery
```

##TRAE
```{r}
SRCdata_recovery_trae <- FVFM_recovery_curve %>% rename(F.RWC = psi) %>%
  rename(PLNCF = gs)%>% dplyr::rename(Species = species) %>% filter(Species== "Trae")

FvFm_recov_trae <- read_csv("../results/fvfm/PLNCF/model_fitting_results_PLNCF.csv") %>% 
  filter(Species == 'Trae') %>%
  filter(model == 'Sigmoidal')

#output model
x_seq.trae <- seq(0,100, length.out = length(SRCdata_recovery_trae$F.RWC)) 

y_model.trae.recovery <- FvFm_recov_trae$A / (1 + exp(-((x_seq.trae - FvFm_recov_trae$C) / FvFm_recov_trae$B)))

#plot
trae_fvfm_recovery<-ggplot(SRCdata_recovery_trae ,aes(x=F.RWC,y=PLNCF))+
  geom_point(data=SRCdata_recovery_trae,aes(x=F.RWC,y=PLNCF, colour= "blue"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("blue")) +
  geom_line(aes(x = x_seq.trae, y = y_model.trae.recovery), color = 'blue', size=2, alpha=0.7)+
   geom_vline(xintercept=FvFm_recov_trae$RWC_fvfm50,color="blue",lty=5, linewidth= 1)+
  xlim(0,100)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("PLNCF")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("T. aestivum")

trae_fvfm_recovery
```

##PEGL
```{r}
SRCdata_recovery_pegl <- FVFM_recovery_curve %>% rename(F.RWC = psi) %>%
  rename(PLNCF = gs)%>% dplyr::rename(Species = species) %>% filter(Species== "Pegl")

FvFm_recov_pegl <- read_csv("../results/fvfm/PLNCF/model_fitting_results_PLNCF.csv") %>% 
  filter(Species == 'Pegl') %>%
  filter(model == 'Exponential2')

#output model
x_seq.pegl <- seq(0,100, length.out = length(SRCdata_recovery_pegl $F.RWC))

y_model.pegl.recovery <-   FvFm_recov_pegl$C + FvFm_recov_pegl$A * exp(-FvFm_recov_pegl$B * x_seq.pegl ) 

#plot
pegl_fvfm_recovery<-ggplot(SRCdata_recovery_pegl ,aes(x=F.RWC,y=PLNCF))+
  geom_point(data=SRCdata_recovery_pegl ,aes(x=F.RWC,y=PLNCF, colour= "blue"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("blue")) +
  geom_line(aes(x = x_seq.pegl, y = y_model.pegl.recovery), color = 'blue', size=2, alpha=0.7)+
    geom_vline(xintercept=FvFm_recov_pegl$RWC_fvfm50,color="blue",lty=5, linewidth= 1)+
  xlim(0,100)+
  ylim(0,100)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("PLNCF")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("P. glaucum")

pegl_fvfm_recovery
```

##CHGA
```{r}
SRCdata_recovery_chga <- FVFM_recovery_curve %>% rename(F.RWC = psi) %>%
  rename(PLNCF = gs)%>% dplyr::rename(Species = species) %>% filter(Species== "Chga")

FvFm_recov_chga <- read_csv("../results/fvfm/PLNCF/model_fitting_results_PLNCF.csv") %>% 
  filter(Species == 'Chga') %>%
  filter(model == 'Exponential2')

#output model
x_seq.chga <- seq(0,100, length.out = length(SRCdata_recovery_chga $F.RWC))

y_model.chga.recovery <-   FvFm_recov_chga$C + FvFm_recov_chga$A * exp(-FvFm_recov_chga$B * x_seq.chga ) 

#plot
chga_fvfm_recovery<-ggplot(SRCdata_recovery_chga,aes(x=F.RWC,y=PLNCF))+
  geom_point(data=SRCdata_recovery_chga,aes(x=F.RWC,y=PLNCF, colour= "blue"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("blue")) +
  geom_line(aes(x = x_seq.chga, y = y_model.chga.recovery), color = 'blue', size=2, alpha=0.7)+
    geom_vline(xintercept=FvFm_recov_chga$RWC_fvfm50,color="blue",lty=5, linewidth= 1)+
  xlim(0,100)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("PLNCF")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("C. gayan")

chga_fvfm_recovery
```

##ZEMA
```{r}
SRCdata_recovery_zema <- FVFM_recovery_curve %>% rename(F.RWC = psi) %>%
  rename(PLNCF = gs)%>% dplyr::rename(Species = species) %>% filter(Species== "Zema")

FvFm_recov_zema <- read_csv("../results/fvfm/PLNCF/model_fitting_results_PLNCF.csv") %>% 
  filter(Species == 'Zema') %>%
  filter(model == 'Exponential2')

#output model
x_seq.zema <- seq(0,100, length.out = length(SRCdata_recovery_zema $F.RWC))

y_model.zema.recovery <-   FvFm_recov_zema$C + FvFm_recov_zema$A * exp(-FvFm_recov_zema$B * x_seq.zema ) 

#plot
zema_fvfm_recovery<-ggplot(SRCdata_recovery_zema,aes(x=F.RWC,y=PLNCF))+
  geom_point(data=SRCdata_recovery_zema,aes(x=F.RWC,y=PLNCF, colour= "blue"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("blue")) +
  geom_line(aes(x = x_seq.zema, y = y_model.zema.recovery), color = 'blue', size=2, alpha=0.7)+
   geom_vline(xintercept=FvFm_recov_zema$RWC_fvfm50,color="blue",lty=5, linewidth= 1)+
  xlim(0, 100)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("PLNCF")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("Z. mays")

zema_fvfm_recovery
```


##FvFm table
```{r}

FvFm_summary <- tribble(
  ~Species, ~RWC_PLNCF50,
    "Avsa", FvFm_recov_avsa$RWC_fvfm50, "Hovu", FvFm_recov_hovu$RWC_fvfm50, "Trae", FvFm_recov_trae$RWC_fvfm50,
  "Pegl", FvFm_recov_pegl$RWC_fvfm50, "Chga", FvFm_recov_chga$RWC_fvfm50, "Zema", FvFm_recov_zema$RWC_fvfm50)

write.csv(FvFm_summary, file = "../results/FvFm_summary_PLNCF.csv")
```



#RC
```{r}

#################Rehydration capacity
SRCdata = read.csv("../data/SRCdata.csv",header=TRUE)

SRCdata_RC <- SRCdata %>% select(Species, Metabolism, F.RWC,R.SWC, T.SWC) %>%
  mutate(RC = R.SWC/T.SWC)

# data per species, FvFm, PLRC ####
SRCdata_RC$F.RWC <- as.numeric(SRCdata_RC$F.RWC)
SRCdata_RC$RC <- as.numeric(SRCdata_RC$RC)

#format for fitting for Megan's script
RC_curve <- SRCdata_RC %>%
  dplyr::select(Species, `F.RWC`, `RC` ) %>%
  rename(psi = `F.RWC`) %>%
  rename(gs = `RC`) %>% #for the script by Megan
  rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()


write.csv(x = RC_curve, file = "../results/RC/RWC/RC_curve.csv") #ready for fitting with RWC

#max values for relative plotting
max.RC<- ddply(SRCdata_RC, .(Species, Metabolism), summarise,
                   mean.RC = mean(`RC`[F.RWC > 90], na.rm = TRUE))
```

##AVSA
```{r}

SRCdata_recovery_RC_avsa <- RC_curve %>% filter(species== "Avsa") %>%
  rename(F.RWC = psi, RC = gs, Species = species)

RC_recov_avsa <-  read.csv("../results/RC/RWC/model_fitting_results.csv") %>%
  filter(Species == 'Avsa') %>%
  filter(model == 'Exponential2')

#output model - exp2 : C + A * (1-exp(-B * psi))
x_seq.avsa.RC <- seq(0, 100, length.out = length(SRCdata_recovery_RC_avsa$F.RWC))

y_model.avsa.rc <-  RC_recov_avsa$C + (1-exp(-RC_recov_avsa$B * x_seq.avsa.RC))
  
#plot
Avsa_RC<-ggplot(SRCdata_recovery_RC_avsa,aes(x=F.RWC,y=RC))+
  geom_point(data=SRCdata_recovery_RC_avsa,aes(x=F.RWC,y=RC, colour= "black"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("black")) +
  geom_line(aes(x = x_seq.avsa.RC, y = y_model.avsa.rc), color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_avsa$psi_kleaf50,color="black",lty=5, linewidth = 1)+
  ylim(0,2)+
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Rehydration capacity (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("A. sativa")+
  annotate("text", x = 90, y = 95, label = expression(r^2 == 0.90), size = 5, fontface = "bold")+
    geom_segment(aes(x=86, xend=86, y=20, yend=5), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
  
Avsa_RC
```
##HOVU
```{r}

SRCdata_recovery_RC_hovu <- SRCdata_RC %>% dplyr::select(Species, Metabolism, F.RWC ,RC)%>% filter(Species== "Hovu")

RC_recov_hovu <-  read.csv("../results/RC/RWC/model_fitting_results.csv") %>%
  filter(Species == 'Hovu') %>%
  filter(model == 'Exponential')

#output model - exp :  A * (1-exp(-B * psi))
x_seq.hovu.RC <- seq(0,100, length.out = length(SRCdata_recovery_RC_hovu$F.RWC))

y_model.hovu.rc <-  (1-exp(-RC_recov_hovu$B * x_seq.hovu.RC))
  
#plot
hovu_RC<-ggplot(SRCdata_recovery_RC_hovu,aes(x=F.RWC,y=RC))+
  geom_point(data=SRCdata_recovery_RC_hovu,aes(x=F.RWC,y=RC, colour= "black"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("black")) +
  geom_line(aes(x = x_seq.hovu.RC, y = y_model.hovu.rc), color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_hovu$psi_kleaf50,color="black",lty=5, linewidth = 1)+
  ylim(0,2)+
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Rehydration capacity (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("H. vulgare")+
  annotate("text", x = 90, y = 95, label = expression(r^2 == 0.90), size = 5, fontface = "bold")+
    geom_segment(aes(x=86, xend=86, y=20, yend=5), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
  
hovu_RC

```
##TRAE
```{r}
SRCdata_recovery_RC_trae <- SRCdata_RC %>% dplyr::select(Species, Metabolism, F.RWC ,RC)%>% filter(Species== "Trae")

RC_recov_trae <-  read.csv("../results/RC/RWC/model_fitting_results.csv") %>%
  filter(Species == 'Trae') %>%
  filter(model == 'Logistic')

#output model - exp2 : C + A * (1-exp(-B * psi))
x_seq.trae.RC <- seq(0,100, length.out = length(SRCdata_recovery_RC_trae$F.RWC))

y_model.trae.rc <-  RC_recov_trae$A /(1+((x_seq.trae.RC/RC_recov_trae$C)^RC_recov_trae$B))

  
#plot
trae_RC<-ggplot(SRCdata_recovery_RC_trae,aes(x=F.RWC,y=RC))+
  geom_point(data=SRCdata_recovery_RC_trae,aes(x=F.RWC,y=RC, colour= "black"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("black")) +
  geom_line(aes(x = x_seq.trae.RC, y = y_model.trae.rc), color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_trae$psi_kleaf50,color="black",lty=5, linewidth = 1)+
  ylim(0,2)+
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Percent loss of rehydration capacity (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("T. aestivum")+
  annotate("text", x = 90, y = 95, label = expression(r^2 == 0.77), size = 5, fontface = "bold")+
   geom_segment(aes(x=68, xend=68, y=30, yend=15), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
  
trae_RC
```
##PEGL
```{r}
SRCdata_recovery_RC_pegl <- SRCdata_RC %>% dplyr::select(Species, Metabolism, F.RWC ,RC)%>% filter(Species== "Pegl")

RC_recov_pegl <-  read.csv("../results/RC/RWC/model_fitting_results.csv") %>%
  filter(Species == 'Pegl') %>%
  filter(model == 'Exponential2')

#output model - exp2 : C + A * (1-exp(-B * psi))
x_seq.pegl.RC <- seq(0,100, length.out = length(SRCdata_recovery_RC_pegl$F.RWC))

y_model.pegl.rc <-  RC_recov_pegl$C + (1-exp(-RC_recov_pegl$B * x_seq.pegl.RC))
  
#plot
pegl_RC<-ggplot(SRCdata_recovery_RC_pegl,aes(x=F.RWC,y=RC))+
  geom_point(data=SRCdata_recovery_RC_pegl,aes(x=F.RWC,y=RC, colour= "black"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("black")) +
  geom_line(aes(x = x_seq.pegl.RC, y = y_model.pegl.rc), color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_pegl$psi_kleaf50,color="black",lty=5, linewidth = 1)+
  ylim(0,2)+
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=13),
        axis.title.x=element_text(size= 13),
        axis.text.x=element_text(size=13),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Percent loss of rehydration capacity (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("P. glaucum")+
  annotate("text", x = 90, y = 95, label = expression(r^2 == 0.98), size = 5, fontface = "bold")+
  geom_segment(aes(x=19, xend=19, y=70, yend=55), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
pegl_RC
```
##CHGA
```{r}
SRCdata_recovery_RC_chga <- SRCdata_RC %>% dplyr::select(Species, Metabolism, F.RWC ,RC)%>% filter(Species== "Chga")

RC_recov_chga <-  read.csv("../results/RC/RWC/model_fitting_results.csv") %>%
  filter(Species == 'Chga') %>%
  filter(model == 'Logistic')

#output model -  A / (1 + ((psi / Xo)^B))
x_seq.chga.RC <- seq(0,100, length.out = length(SRCdata_recovery_RC_chga$F.RWC))

y_model.chga.rc <-  RC_recov_chga$A / (1+((x_seq.chga.RC/ RC_recov_chga$C)^RC_recov_chga$B))
  
#plot
chga_RC<-ggplot(SRCdata_recovery_RC_chga,aes(x=F.RWC,y=RC))+
  geom_point(data=SRCdata_recovery_RC_chga,aes(x=F.RWC,y=RC, colour= "black"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("black")) +
  geom_line(aes(x = x_seq.chga.RC, y = y_model.chga.rc), color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_chga$psi_kleaf50,color="black",lty=5, linewidth = 1)+
  ylim(0,2)+
  xlim(100,0)+
  theme_minimal()+
  theme(
        axis.title.y=element_blank(),
        #axis.text.y=element_text(size=12),
        axis.title.x=element_text(size=13),
        axis.text.x=element_text(size=13),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
 # ylab(expression(paste("Percent loss of rehydration capacity (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("C. gayan")+
  annotate("text", x = 90, y = 95, label = expression(r^2 == 0.87), size = 5, fontface = "bold")+
  geom_segment(aes(x=34, xend=34, y=40, yend=25), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
   
chga_RC
```
##ZEMA
```{r}

SRCdata_recovery_RC_zema <- SRCdata_RC %>% dplyr::select(Species, Metabolism, F.RWC ,RC)%>% filter(Species== "Zema")

RC_recov_zema <-  read.csv("../results/RC/RWC/model_fitting_results.csv") %>%
  filter(Species == 'Zema') %>%
  filter(model == 'Exponential2')

#output model - exp2 : C + A * (1-exp(-B * psi))
x_seq.zema.RC <- seq(0,100, length.out = length(SRCdata_recovery_RC_zema$F.RWC))

y_model.zema.rc <-  RC_recov_zema$C + (1-exp(-RC_recov_zema$B * x_seq.zema.RC))
  
#plot
zema_RC<-ggplot(SRCdata_recovery_RC_zema,aes(x=F.RWC,y=RC))+
  geom_point(data=SRCdata_recovery_RC_zema,aes(x=F.RWC,y=RC, colour= "black"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("black")) +
  geom_line(aes(x = x_seq.zema.RC, y = y_model.zema.rc), color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_zema$psi_kleaf50,color="black",lty=5, linewidth = 1)+
  ylim(0,2)+
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_text(size=13),
        axis.text.x=element_text(size=13),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Percent loss of rehydration capacity (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("Z. mays")+
  annotate("text", x = 90, y = 95, label = expression(r^2 == 0.89), size = 5, fontface = "bold")+
  geom_segment(aes(x=19, xend=19, y=70, yend=55), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
  
zema_RC
```

##ALL PLOTS RC + fvfm

```{r}
Avsa_recovery <- ggplot() +
  # --- FvFm recovery ---
  geom_point(data = SRCdata_recovery_avsa,
             aes(x = F.RWC, y = R.FvFm),
             color = "blue", size = 3, alpha = 0.5) +
  geom_line(data = NULL,
            aes(x = x_seq.avsa, y = y_model.avsa.recovery),
            color = "blue", size = 2, alpha = 0.7) +
  geom_vline(xintercept = FvFm_recov_avsa$psi_kleaf50,
             color = "blue", lty = 5, linewidth = 1) +

  # --- RC recovery ---
  geom_point(data = SRCdata_recovery_RC_avsa,
             aes(x = F.RWC, y = RC),
             color = "black", size = 3, alpha = 0.5) +
  geom_line(data = NULL,
            aes(x = x_seq.avsa.RC, y = y_model.avsa.rc),
            color = "black", size = 2, alpha = 0.7) +
  geom_vline(xintercept = RC_recov_avsa$psi_kleaf50,
             color = "black", lty = 5, linewidth = 1) +
  
 # annotate("text", x = 90, y = 0.25, label = expression(r^2 == X), size = 5, fontface = "bold", color="black")+ #in black
 # annotate("text", x = 90, y = 0.20, label = expression(r^2 == 0.82), size = 5, fontface = "bold", color="blue")+ # in blue
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "italic"),
        legend.position = "none") +
  ylab(expression("RC & " * " " * F[v]/F[m] * " post rehydration"))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("A. sativa")+
  geom_segment(aes(x=86, xend=86, y=0.85, yend=0.75), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)

Avsa_recovery

Hovu_recovery <- ggplot()+
  # --- FvFm recovery ---
  geom_point(data=SRCdata_recovery_hovu,
              aes(x=F.RWC,y=R.FvFm),
              color= "blue",size=3,alpha=0.5)+
  geom_line(data= NULL,
            aes(x = x_seq.hovu, y = y_model.hovu.recovery), 
            color = 'blue', size=2, alpha=0.7)+
  geom_vline(xintercept=FvFm_recov_hovu$psi_kleaf50,
             color="blue",lty=5, linewidth= 1)+

  # ---RC---
  geom_point(data=SRCdata_recovery_RC_hovu,
             aes(x=F.RWC,y=RC),
             color= "black",size=3,alpha=0.5)+
  geom_line(aes(x = x_seq.hovu.RC, y = y_model.hovu.rc), 
            color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_hovu$psi_kleaf50,
             color="black",lty=5, linewidth = 1)+
   #   annotate("text", x = 90, y = 0.25, label = expression(r^2 == X), size = 5, fontface = "bold", color="black")+ #in black
#  annotate("text", x = 90, y = 0.20, label = expression(r^2 == 0.81), size = 5, fontface = "bold", color="blue")+ # in blue
  #ylim(0,1.5)+
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "italic"),
        legend.position = "none") +
  ylab(expression(paste("FvFm")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("H. vulgare")+
   geom_segment(aes(x=72, xend=72, y=0.85, yend=0.75), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)

Hovu_recovery

Trae_recovery <- ggplot()+
  ## --- fvfm ---
  geom_point(data=SRCdata_trae_recovery,
             aes(x=F.RWC,y=R.FvFm), 
             color= "blue",size=3,alpha=0.5)+
  geom_line(aes(x = x_seq.trae, y = y_model.trae.recovery), 
            color = 'blue', size=2, alpha=0.7)+
   geom_vline(xintercept=FvFm_recov_trae$psi_kleaf50,
              color="blue",lty=5, linewidth= 1)+
  
  ## ---RC---
  geom_point(data=SRCdata_recovery_RC_trae,
             aes(x=F.RWC,y=RC), 
             color= "black",size=3,alpha=0.5)+
  geom_line(aes(x = x_seq.trae.RC, y = y_model.trae.rc), 
            color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_trae$psi_kleaf50,
             color="black",lty=5, linewidth = 1)+
   # annotate("text", x = 90, y = 0.25, label = expression(r^2 ==x), size = 5, fontface = "bold", color="black")+ #in black
 # annotate("text", x = 90, y = 0.20, label = expression(r^2 == 0.70), size = 5, fontface = "bold", color="blue")+ # in blue
  #ylim(0,1)+
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "italic"),
        legend.position = "none") +
  ylab(expression(paste("FvFm")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("T. aestivum")+
  geom_segment(aes(x=68, xend=68, y=0.85, yend=0.75), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
Trae_recovery

Pegl_recovery <- ggplot()+
  ## --------fvfm---------------
  geom_point(data=SRCdata_pegl_recovery,
             aes(x=F.RWC,y=R.FvFm), 
             color= "blue",size=3,alpha=0.5)+
  geom_line(aes(x = x_seq.pegl, y = y_model.pegl.recovery), 
            color = 'blue', size=2, alpha=0.7)+
    geom_vline(xintercept=FvFm_recov_pegl$psi_kleaf50,
               color="blue",lty=5, linewidth= 1)+
  ## ---RC---
  geom_point(data=SRCdata_recovery_RC_pegl,
             aes(x=F.RWC,y=RC), 
             color= "black",size=3,alpha=0.5)+
  geom_line(aes(x = x_seq.pegl.RC, y = y_model.pegl.rc), 
            color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_pegl$psi_kleaf50,
             color="black",lty=5, linewidth = 1)+
  #  annotate("text", x = 90, y = 0.25, label = expression(r^2 == x), size = 5, fontface = "bold", color="black")+ #in black
#  annotate("text", x = 90, y = 0.20, label = expression(r^2 == 0.95), size = 5, fontface = "bold", color="blue")+ # in blue
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=12),
        axis.title.x=element_text(size=13),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "italic"),
        legend.position = "none") +
   ylab(expression("PLRC & " * " " * F[v]/F[m] * " post rehydration"))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("P. glaucum")+
  geom_segment(aes(x=19, xend=19, y=0.85, yend=0.75), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
Pegl_recovery

Chga_recovery <-ggplot()+
  # ---fvfm ---
  geom_point(data=SRCdata_chga_recovery,
             aes(x=F.RWC,y=R.FvFm),
             color= "blue",size=3,alpha=0.5)+
  geom_line(aes(x = x_seq.chga, y = y_model.chga.recovery), 
            color = 'blue', size=2, alpha=0.7)+
    geom_vline(xintercept=FvFm_recov_chga$psi_kleaf50,
               color="blue",lty=5, linewidth= 1)+
  
  # --- RC ---
  geom_point(data=SRCdata_recovery_RC_chga,
             aes(x=F.RWC,y=RC),
             color= "black",size=3,alpha=0.5)+
  geom_line(aes(x = x_seq.chga.RC, y = y_model.chga.rc),
            color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_chga$psi_kleaf50,
             color="black",lty=5, linewidth = 1)+
  #  annotate("text", x = 90, y = 0.25, label = expression(r^2 == x), size = 5, fontface = "bold", color="black")+ #in black
#  annotate("text", x = 90, y = 0.20, label = expression(r^2 == 0.95), size = 5, fontface = "bold", color="blue")+ # in blue
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_text(size=13),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "italic"),
        legend.position = "none") +
   ylab(expression("RC & " * " " * F[v]/F[m] * " post rehydration"))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("C. gayan")+
   geom_segment(aes(x=34, xend=34, y=0.85, yend=0.75), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
  
Chga_recovery

Zema_recovery <- ggplot()+
  
  # --- fvfm---
  geom_point(data=SRCdata_zema_recovery,
             aes(x=F.RWC,y=R.FvFm), 
             color= "blue",size=3,alpha=0.5)+
  geom_line(aes(x = x_seq.zema, y = y_model.zema.recovery), 
            color = 'blue', size=2, alpha=0.7)+
  geom_vline(xintercept=FvFm_recov_zema$psi_kleaf50,color="blue",lty=5, linewidth= 1)+
  
  # --- RC ---
  geom_point(data=SRCdata_recovery_RC_zema,
             aes(x=F.RWC,y=RC),
             colour= "black",size=3,alpha=0.5)+
  geom_line(aes(x = x_seq.zema.RC, y = y_model.zema.rc), 
            color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_zema$psi_kleaf50,
             color="black",lty=5, linewidth = 1)+
   # annotate("text", x = 90, y = 0.25, label = expression(r^2 == x), size = 5, fontface = "bold", color="black")+ #in black
 # annotate("text", x = 90, y = 0.20, label = expression(r^2 == 0.74), size = 5, fontface = "bold", color="blue")+ # in blue
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=12),
        axis.title.x=element_text(size=13),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "italic"),
        legend.position = "none") +
  ylab(expression(paste("FvFm")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("Z. mays")+
    geom_segment(aes(x=19, xend=19, y=0.85, yend=0.75), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
  
  
Zema_recovery

### all plots Kleaf ----
Figure3 <- ggarrange(Avsa_recovery, Hovu_recovery, Trae_recovery, Chga_recovery, Pegl_recovery, Zema_recovery, labels = c("A", "B", "C", "D", "E", "F"),ncol =3, nrow = 2)

Figure3

ggsave(filename = "../results/Figure3.jpg", plot = Figure3, width = 12, height = 8)

```

#PLRC
```{r}

#################Rehydration capacity
SRCdata = read.csv("../data/SRCdata.csv",header=TRUE)

SRCdata_RC <- SRCdata %>% select(Species, Metabolism, F.RWC,PLRC) 

# data per species, FvFm, PLRC ####
SRCdata_RC$F.RWC <- as.numeric(SRCdata_RC$F.RWC)
SRCdata_RC$PLRC <- as.numeric(SRCdata_RC$PLRC)

#format for fitting for Megan's script
PLRC_curve <- SRCdata_RC %>%
  dplyr::select(Species, `F.RWC`, `PLRC` ) %>%
  rename(psi = `F.RWC`) %>%
  rename(gs = `PLRC`) %>% #for the script by Megan
  rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()


write.csv(x = PLRC_curve, file = "../results/PLRC/PLRC_curve.csv") #ready for fitting with RWC

library(drc)
library(RColorBrewer) 
#DR curve fitting 
DR.m <- drm(gs ~ psi, 
            data= PLRC_curve,
            species, #fit separate curves for each timepoint
            robust = 'mean', #non-robust least squares estimation ("mean")
            #fct = LL.3u(fixed = c(NA, 100, NA)))  # upper limit fixed at 100
            fct = LL.3(names = c("Hill slope", "max", "EC50")))
print(DR.m)
compParm(DR.m, "EC50", "-")
#extract manually: 
compParm(DR.m, "e", "-")

summary <- summary(DR.m)[[3]] #Coeffs are stored as 3rd element in list obj
confint(DR.m, level = 0.90)


Species <- unique(PLRC_curve$species)
curve_cnt <- length(Species)
cols <- colorRampPalette(brewer.pal(8,"Set2"))(curve_cnt)

par(mfrow=c(2,3))

for (i in 1:curve_cnt) {

  DR <- filter(PLRC_curve, species == Species[i])

  DR.mi <- drm(gs ~ psi,
               data = DR,
               robust = "mean",
               fct = LL.3(names = c("Hill slope", "Max", "EC50"))
  )

  plot(DR.mi,
       type = "all",
       col = cols[i],
       pch = 16,
       lwd = 1,
       cex.axis = 0.8,
       xlim = c(0, 100),
       ylim = c(0, 100),
       legend = TRUE,
       legendText = Species[i],
       xlab = "RWC (%)",
       ylab = "PLRC"
  )

  plot(DR.mi,
       col = cols[i],
       xlim = c(0, 100),
       ylim = c(0, 100),
       add = TRUE,
       type = "confidence"
  )
}

#for Chga:  the curves does not reach a steady plateau. Therefore we can’t quantitatively compare best-fit curve EC50 and top values.

par(mfrow=c(1,1))

plot(NA, xlim=c(0,100), ylim=c(0,100), xlab="RWC (%)", ylab="PLRC")  # blank canvas

for (i in 1:curve_cnt){ 
  DR = filter(PLRC_curve, species == Species[i]) 
  DR.mi <- drm(gs ~ psi, 
              data= DR,
              robust = 'mean', #non-robust least squares estimation ("mean")
              fct = LL.3(names = c("Hill slope", "Max", "EC50")))
  plot(DR.mi,
       type= "all",
       col=cols[i], #auto color selection for curves
       pch=16,
       lwd=1,
       cex.axis=0.8,
       xlim = c(0, 100),
       ylim = c(0, 100),
       legend = FALSE,
       xlab= "RWC (%)",
       ylab = "PLRC")
  plot(DR.mi,
       col = cols[i],
       xlim = c(0, 100),
       ylim = c(0, 100),
       add=TRUE,
       type='confidence')
  par(new=TRUE)} #Add new=TRUE arg to overlay graphs

# Add legend for all species
legend("topright",
       legend = Species,
       col = cols,
       pch = 16,
       lwd = 2,
       bty = "n"
)

###Final plot
# Define metabolism per species
metabolism <- c(
  Avsa = "C3",
  Hovu = "C3",
  Trae = "C3",
  Chga = "C4",
  Pegl = "C4",
  Zema = "C4"
)

# Colors
cols <- ifelse(metabolism[Species] == "C3", "#6DB9F8", "#D9AB33")

# Line types per species
lt_C3 <- c("solid", "dotted", "longdash")
lt_C4 <- c("solid", "dotted", "longdash")

line_types <- character(length(Species))

# Assign line types within each metabolism group
line_types[metabolism[Species] == "C3"] <- lt_C3[1:sum(metabolism[Species]=="C3")]
line_types[metabolism[Species] == "C4"] <- lt_C4[1:sum(metabolism[Species]=="C4")]

par(mfrow=c(1,1))

# Define order
Species_order <- c("Avsa", "Hovu", "Trae", "Pegl", "Zema", "Chga")
cols_ordered <- cols[match(Species_order, Species)]
line_types_ordered <- line_types[match(Species_order, Species)]

# Blank canvas
plot(NA, xlim=c(0,100), ylim=c(0,100),
     xlab="RWC (%)", ylab="PLRC")

first <- TRUE
for (i in 1:length(Species_order)) { 
  sp <- Species_order[i]
  DR <- subset(PLRC_curve, species == sp)
  
  DR.mi <- drm(
    gs ~ psi,
    data = DR,
    robust = 'mean',
    fct = LL.3(names = c("Hill slope", "Max", "EC50"))
  )
  
  # Plot curve
  plot(DR.mi,
       type = "all",
       col = cols_ordered[i],
       lty = line_types_ordered[i],
       pch = 16,
       lwd = 2,
       xlim = c(0,100),
       ylim = c(0,100),
       legend = FALSE,
       xlab = "RWC (%)",
       ylab = "PLRC")
  
  # Plot confidence interval
  plot(DR.mi,
       type = "confidence",
       add = TRUE,
       col = cols_ordered[i],
       lty = line_types_ordered[i],
       xlim = c(0, 100),
       ylim = c(0, 100))
  
  if (first) {
    first <- FALSE
  } else {
    par(new = TRUE)
  }
}

# Add sorted legend
legend("topright",
       legend = Species_order,
       col = cols_ordered,
       lty = line_types_ordered,
       pch = 16,
       lwd = 2,
       bty = "n")

# Add panel letter
mtext("B.", side = 3, line = 2, at = 1, cex = 1.5, font = 2)

```



##AVSA
```{r}

SRCdata_recovery_RC_avsa <- PLRC_curve %>% filter(species== "Avsa") %>%
  rename(F.RWC = psi, PLRC = gs, Species = species)

RC_recov_avsa <-  read.csv("../results/PLRC/model_fitting_results_PLRC.csv") %>%
  filter(Species == 'Avsa') %>%
  filter(model == 'Exponential2')

#output model - exp2 : C + A * exp(-B * psi) 
x_seq.avsa.RC <- seq(0, 100, length.out = length(SRCdata_recovery_RC_avsa$F.RWC))

y_model.avsa.rc <-  RC_recov_avsa$C +  RC_recov_avsa$A *exp(-RC_recov_avsa$B * x_seq.avsa.RC)
  
#plot
Avsa_RC<-ggplot(SRCdata_recovery_RC_avsa,aes(x=F.RWC,y=PLRC))+
  geom_point(data=SRCdata_recovery_RC_avsa,aes(x=F.RWC,y=PLRC, colour= "black"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("black")) +
  geom_line(aes(x = x_seq.avsa.RC, y = y_model.avsa.rc), color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_avsa$RWC_PLRC50,color="black",lty=5, linewidth = 1)+
  ylim(0,100)+
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("PLRC (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("A. sativa")+
  annotate("text", x = 90, y = 95, label = expression(r^2 == 0.90), size = 5, fontface = "bold")+
    geom_segment(aes(x=86, xend=86, y=20, yend=5), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
  
Avsa_RC
```
##HOVU
```{r}

SRCdata_recovery_RC_hovu <- SRCdata_RC %>% dplyr::select(Species, Metabolism, F.RWC ,PLRC)%>% filter(Species== "Hovu")

RC_recov_hovu <-  read.csv("../results/PLRC/model_fitting_results_PLRC.csv") %>%
  filter(Species == 'Hovu') %>%
  filter(model == 'Exponential2')

#output model - exp :  A * (exp(-B * psi)) +C
x_seq.hovu.RC <- seq(0,100, length.out = length(SRCdata_recovery_RC_hovu$F.RWC))

y_model.hovu.rc <-  RC_recov_hovu$A * (exp(-RC_recov_hovu$B * x_seq.hovu.RC)) + RC_recov_hovu$C
  
#plot
hovu_RC<-ggplot(SRCdata_recovery_RC_hovu,aes(x=F.RWC,y=PLRC))+
  geom_point(data=SRCdata_recovery_RC_hovu,aes(x=F.RWC,y=PLRC, colour= "black"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("black")) +
  geom_line(aes(x = x_seq.hovu.RC, y = y_model.hovu.rc), color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_hovu$RWC_PLRC50,color="black",lty=5, linewidth = 1)+
  ylim(0,100)+
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("PLRC (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("H. vulgare")+
  annotate("text", x = 90, y = 95, label = expression(r^2 == 0.90), size = 5, fontface = "bold")+
    geom_segment(aes(x=86, xend=86, y=20, yend=5), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
  
hovu_RC

```
##TRAE
```{r}
SRCdata_recovery_RC_trae <- SRCdata_RC %>% dplyr::select(Species, Metabolism, F.RWC ,PLRC)%>% filter(Species== "Trae")

RC_recov_trae <-  read.csv("../results/PLRC/model_fitting_results_PLRC.csv") %>%
  filter(Species == 'Trae') %>%
  filter(model == 'Exponential2')

#output model - exp2 : C + A * (1-exp(-B * psi))
x_seq.trae.RC <- seq(0,100, length.out = length(SRCdata_recovery_RC_trae$F.RWC))

y_model.trae.rc <-   RC_recov_trae$A * (exp(-RC_recov_trae$B * x_seq.trae.RC)) + RC_recov_trae$C

  
#plot
trae_RC<-ggplot(SRCdata_recovery_RC_trae,aes(x=F.RWC,y=PLRC))+
  geom_point(data=SRCdata_recovery_RC_trae,aes(x=F.RWC,y=PLRC, colour= "black"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("black")) +
  geom_line(aes(x = x_seq.trae.RC, y = y_model.trae.rc), color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_trae$psi_kleaf50,color="black",lty=5, linewidth = 1)+
  ylim(0,100)+
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Percent loss of rehydration capacity (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("T. aestivum")+
  annotate("text", x = 90, y = 95, label = expression(r^2 == 0.77), size = 5, fontface = "bold")+
   geom_segment(aes(x=68, xend=68, y=30, yend=15), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
  
trae_RC
```
##PEGL
```{r}
SRCdata_recovery_RC_pegl <- SRCdata_RC %>% dplyr::select(Species, Metabolism, F.RWC ,PLRC)%>% filter(Species== "Pegl")

RC_recov_pegl <-  read.csv("../results/PLRC/model_fitting_results_PLRC.csv") %>%
  filter(Species == 'Pegl') %>%
  filter(model == 'Exponential2')

#output model - exp2 : C + A * (1-exp(-B * psi))
x_seq.pegl.RC <- seq(0,100, length.out = length(SRCdata_recovery_RC_pegl$F.RWC))

y_model.pegl.rc <-  RC_recov_pegl$C +  RC_recov_pegl$A* (exp(-RC_recov_pegl$B * x_seq.pegl.RC))
  
#plot
pegl_RC<-ggplot(SRCdata_recovery_RC_pegl,aes(x=F.RWC,y=PLRC))+
  geom_point(data=SRCdata_recovery_RC_pegl,aes(x=F.RWC,y=PLRC, colour= "black"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("black")) +
  geom_line(aes(x = x_seq.pegl.RC, y = y_model.pegl.rc), color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_pegl$RWC_PLRC50,color="black",lty=5, linewidth = 1)+
  ylim(0,100)+
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=13),
        axis.title.x=element_text(size= 13),
        axis.text.x=element_text(size=13),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Percent loss of rehydration capacity (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("P. glaucum")+
  annotate("text", x = 90, y = 95, label = expression(r^2 == 0.98), size = 5, fontface = "bold")+
  geom_segment(aes(x=19, xend=19, y=70, yend=55), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
pegl_RC
```
##CHGA
```{r}
SRCdata_recovery_RC_chga <- SRCdata_RC %>% dplyr::select(Species, Metabolism, F.RWC ,PLRC)%>% filter(Species== "Chga")

RC_recov_chga <-  read.csv("../results/PLRC/model_fitting_results_PLRC.csv") %>%
  filter(Species == 'Chga') %>%
  filter(model == 'Exponential2')

#output model - 
x_seq.chga.RC <- seq(0,100, length.out = length(SRCdata_recovery_RC_chga$F.RWC))

y_model.chga.rc <-   RC_recov_chga$C +  RC_recov_chga$A* (exp(-RC_recov_chga$B * x_seq.chga.RC))
  
#plot
chga_RC<-ggplot(SRCdata_recovery_RC_chga,aes(x=F.RWC,y=PLRC))+
  geom_point(data=SRCdata_recovery_RC_chga,aes(x=F.RWC,y=PLRC, colour= "black"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("black")) +
  geom_line(aes(x = x_seq.chga.RC, y = y_model.chga.rc), color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_chga$RWC_PLRC50,color="black",lty=5, linewidth = 1)+
  ylim(0,100)+
  xlim(100,0)+
  theme_minimal()+
  theme(
        axis.title.y=element_blank(),
        #axis.text.y=element_text(size=12),
        axis.title.x=element_text(size=13),
        axis.text.x=element_text(size=13),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
 # ylab(expression(paste("Percent loss of rehydration capacity (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("C. gayan")+
  annotate("text", x = 90, y = 95, label = expression(r^2 == 0.87), size = 5, fontface = "bold")+
  geom_segment(aes(x=34, xend=34, y=40, yend=25), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
   
chga_RC
```
##ZEMA
```{r}

SRCdata_recovery_RC_zema <- SRCdata_RC %>% dplyr::select(Species, Metabolism, F.RWC ,PLRC)%>% filter(Species== "Zema")

RC_recov_zema <-  read.csv("../results/PLRC/model_fitting_results_PLRC.csv") %>%
  filter(Species == 'Zema') %>%
  filter(model == 'Linear')

#output model - 
x_seq.zema.RC <- seq(0,100, length.out = length(SRCdata_recovery_RC_zema$F.RWC))

y_model.zema.rc <-  RC_recov_zema$B * x_seq.zema.RC + RC_recov_zema$A
  
#plot
zema_RC<-ggplot(SRCdata_recovery_RC_zema,aes(x=F.RWC,y=PLRC))+
  geom_point(data=SRCdata_recovery_RC_zema,aes(x=F.RWC,y=PLRC, colour= "black"),size=3,alpha=0.5)+
  scale_colour_manual(values=c("black")) +
  geom_line(aes(x = x_seq.zema.RC, y = y_model.zema.rc), color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_zema$RWC_PLRC50,color="black",lty=5, linewidth = 1)+
  ylim(0,100)+
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=13),
        axis.title.x=element_text(size=13),
        axis.text.x=element_text(size=13),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Percent loss of rehydration capacity (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("Z. mays")+
  annotate("text", x = 90, y = 95, label = expression(r^2 == 0.89), size = 5, fontface = "bold")+
  geom_segment(aes(x=19, xend=19, y=70, yend=55), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
  
zema_RC
```

##ALL PLOTS PLRC + PLNCF

```{r}
Avsa_recovery <- ggplot() +
  # --- FvFm recovery ---
  geom_point(data = SRCdata_recovery_avsa,
             aes(x = F.RWC, y = PLNCF),
             color = "blue", size = 3, alpha = 0.5) +
  geom_line(data = NULL,
            aes(x = x_seq.avsa, y = y_model.avsa.recovery),
            color = "blue", size = 2, alpha = 0.7) +
  geom_vline(xintercept = FvFm_recov_avsa$RWC_fvfm50,
             color = "blue", lty = 5, linewidth = 1) +

  # --- RC recovery ---
  geom_point(data = SRCdata_recovery_RC_avsa,
             aes(x = F.RWC, y = PLRC),
             color = "black", size = 3, alpha = 0.5) +
  geom_line(data = NULL,
            aes(x = x_seq.avsa.RC, y = y_model.avsa.rc),
            color = "black", size = 2, alpha = 0.7) +
  geom_vline(xintercept = RC_recov_avsa$RWC_PLRC50,
             color = "black", lty = 5, linewidth = 1) +
  
 # annotate("text", x = 90, y = 0.25, label = expression(r^2 == X), size = 5, fontface = "bold", color="black")+ #in black
 # annotate("text", x = 90, y = 0.20, label = expression(r^2 == 0.82), size = 5, fontface = "bold", color="blue")+ # in blue
  xlim(100,0)+
    ylim(0,100)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "italic"),
        legend.position = "none") +
  ylab(expression("PLRC & " * "PLNCF"))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("A. sativa")+
  geom_segment(aes(x=86, xend=86, y=25, yend=10), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)

Avsa_recovery

Hovu_recovery <- ggplot()+
  # --- FvFm recovery ---
  geom_point(data=SRCdata_recovery_hovu,
              aes(x=F.RWC,y=PLNCF),
              color= "blue",size=3,alpha=0.5)+
  geom_line(data= NULL,
            aes(x = x_seq.hovu, y = y_model.hovu.recovery), 
            color = 'blue', size=2, alpha=0.7)+
  geom_vline(xintercept=FvFm_recov_hovu$RWC_fvfm50,
             color="blue",lty=5, linewidth= 1)+

  # ---RC---
  geom_point(data=SRCdata_recovery_RC_hovu,
             aes(x=F.RWC,y=PLRC),
             color= "black",size=3,alpha=0.5)+
  geom_line(aes(x = x_seq.hovu.RC, y = y_model.hovu.rc), 
            color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_hovu$RWC_PLRC50,
             color="black",lty=5, linewidth = 1)+
   #   annotate("text", x = 90, y = 0.25, label = expression(r^2 == X), size = 5, fontface = "bold", color="black")+ #in black
#  annotate("text", x = 90, y = 0.20, label = expression(r^2 == 0.81), size = 5, fontface = "bold", color="blue")+ # in blue
  #ylim(0,1.5)+
  xlim(100,0)+
    ylim(0,100)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "italic"),
        legend.position = "none") +
  ylab(expression(paste("FvFm")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("H. vulgare")+
   geom_segment(aes(x=72, xend=72, y=45, yend=25), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)

Hovu_recovery

Trae_recovery <- ggplot()+
  ## --- fvfm ---
  geom_point(data=SRCdata_recovery_trae,
             aes(x=F.RWC,y=PLNCF), 
             color= "blue",size=3,alpha=0.5)+
  geom_line(aes(x = x_seq.trae, y = y_model.trae.recovery), 
            color = 'blue', size=2, alpha=0.7)+
   geom_vline(xintercept=FvFm_recov_trae$RWC_fvfm50,
              color="blue",lty=5, linewidth= 1)+
  
  ## ---RC---
  geom_point(data=SRCdata_recovery_RC_trae,
             aes(x=F.RWC,y=PLRC), 
             color= "black",size=3,alpha=0.5)+
  geom_line(aes(x = x_seq.trae.RC, y = y_model.trae.rc), 
            color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_trae$RWC_PLRC50,
             color="black",lty=5, linewidth = 1)+
   # annotate("text", x = 90, y = 0.25, label = expression(r^2 ==x), size = 5, fontface = "bold", color="black")+ #in black
 # annotate("text", x = 90, y = 0.20, label = expression(r^2 == 0.70), size = 5, fontface = "bold", color="blue")+ # in blue
  #ylim(0,1)+
  xlim(100,0)+
    ylim(0,100)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "italic"),
        legend.position = "none") +
  ylab(expression(paste("FvFm")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("T. aestivum")+
  geom_segment(aes(x=68, xend=68, y=30, yend=15), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
Trae_recovery

Pegl_recovery <- ggplot()+
  ## --------fvfm---------------
  geom_point(data=SRCdata_recovery_pegl,
             aes(x=F.RWC,y=PLNCF), 
             color= "blue",size=3,alpha=0.5)+
  geom_line(aes(x = x_seq.pegl, y = y_model.pegl.recovery), 
            color = 'blue', size=2, alpha=0.7)+
    geom_vline(xintercept=FvFm_recov_pegl$RWC_fvfm50,
               color="blue",lty=5, linewidth= 1)+
  ## ---RC---
  geom_point(data=SRCdata_recovery_RC_pegl,
             aes(x=F.RWC,y=PLRC), 
             color= "black",size=3,alpha=0.5)+
  geom_line(aes(x = x_seq.pegl.RC, y = y_model.pegl.rc), 
            color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_pegl$RWC_PLRC50,
             color="black",lty=5, linewidth = 1)+
  #  annotate("text", x = 90, y = 0.25, label = expression(r^2 == x), size = 5, fontface = "bold", color="black")+ #in black
#  annotate("text", x = 90, y = 0.20, label = expression(r^2 == 0.95), size = 5, fontface = "bold", color="blue")+ # in blue
  xlim(100,0)+
    ylim(0,100)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=12),
        axis.title.x=element_text(size=13),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "italic"),
        legend.position = "none") +
   ylab(expression("PLRC & " * "PLNCF"))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("P. glaucum")+
  geom_segment(aes(x=19, xend=19, y=75, yend=55), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
Pegl_recovery

Chga_recovery <-ggplot()+
  # ---fvfm ---
  geom_point(data=SRCdata_recovery_chga,
             aes(x=F.RWC,y=PLNCF),
             color= "blue",size=3,alpha=0.5)+
  geom_line(aes(x = x_seq.chga, y = y_model.chga.recovery), 
            color = 'blue', size=2, alpha=0.7)+
    geom_vline(xintercept=FvFm_recov_chga$RWC_fvfm50,
               color="blue",lty=5, linewidth= 1)+
  
  # --- RC ---
  geom_point(data=SRCdata_recovery_RC_chga,
             aes(x=F.RWC,y=PLRC),
             color= "black",size=3,alpha=0.5)+
  geom_line(aes(x = x_seq.chga.RC, y = y_model.chga.rc),
            color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_chga$RWC_PLRC50,
             color="black",lty=5, linewidth = 1)+
  #  annotate("text", x = 90, y = 0.25, label = expression(r^2 == x), size = 5, fontface = "bold", color="black")+ #in black
#  annotate("text", x = 90, y = 0.20, label = expression(r^2 == 0.95), size = 5, fontface = "bold", color="blue")+ # in blue
  xlim(100,0)+
  ylim(0,100)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_text(size=13),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "italic"),
        legend.position = "none") +
   ylab(expression("PLRC & " * "PLNCF"))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("C. gayana")+
   geom_segment(aes(x=34, xend=34, y=60, yend=30), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
  
Chga_recovery

Zema_recovery <- ggplot()+
  
  # --- fvfm---
  geom_point(data=SRCdata_recovery_zema,
             aes(x=F.RWC,y=PLNCF), 
             color= "blue",size=3,alpha=0.5)+
  geom_line(aes(x = x_seq.zema, y = y_model.zema.recovery), 
            color = 'blue', size=2, alpha=0.7)+
  geom_vline(xintercept=FvFm_recov_zema$RWC_fvfm50,color="blue",lty=5, linewidth= 1)+
  
  # --- RC ---
  geom_point(data=SRCdata_recovery_RC_zema,
             aes(x=F.RWC,y=PLRC),
             colour= "black",size=3,alpha=0.5)+
  geom_line(aes(x = x_seq.zema.RC, y = y_model.zema.rc), 
            color = 'black', size=2, alpha=0.7)+
  geom_vline(xintercept=RC_recov_zema$RWC_PLRC50,
             color="black",lty=5, linewidth = 1)+
   # annotate("text", x = 90, y = 0.25, label = expression(r^2 == x), size = 5, fontface = "bold", color="black")+ #in black
 # annotate("text", x = 90, y = 0.20, label = expression(r^2 == 0.74), size = 5, fontface = "bold", color="blue")+ # in blue
  xlim(100,0)+
  ylim(0,100)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=12),
        axis.title.x=element_text(size=13),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "italic"),
        legend.position = "none") +
  ylab(expression(paste("FvFm")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("Z. mays")+
    geom_segment(aes(x=19, xend=19, y=90, yend=70), 
               arrow=arrow(type="closed", length=unit(0.2, "inches")), 
               color="black", size=1)
  
  
Zema_recovery

### all plots Kleaf ----
Figure3 <- ggarrange(Avsa_recovery, Hovu_recovery, Trae_recovery, Chga_recovery, Pegl_recovery, Zema_recovery, labels = c("A", "B", "C", "D", "E", "F"),ncol =3, nrow = 2)

Figure3

ggsave(filename = "../results/Figure3_PLRC_PLNCF.jpg", plot = Figure3, width = 12, height = 8)

```




##PLRC Table recap
```{r}
RC_summary <- tribble(
  ~Species, ~RWC_PLRC50,
  "Avsa", RC_recov_avsa$RWC_PLRC50, "Hovu", RC_recov_hovu$RWC_PLRC50, "Trae", RC_recov_trae$RWC_PLRC50,
  "Pegl", RC_recov_pegl$RWC_PLRC50, "Chga", RC_recov_chga$RWC_PLRC50, "Zema", RC_recov_zema$RWC_PLRC50
)

write.csv(RC_summary, file = "../results/RC_summary_PLRC.csv")
```

#///////ANATOMY

#Absolute - leaf structure
##leaf structure
```{r}
## SRC, boxplots, stat analysis ####

SRCdata = read.csv("../data/SRCdata.csv",header=TRUE) #same data as in Figure 3 above

# Define order: all C3 species first, then all C4 species
species_order <- c("Avsa", "Hovu", "Trae", "Pegl", "Zema", "Chga")

# Set Species as factor with this order
SRCdata$Species <- factor(SRCdata$Species, levels = species_order)


# LMA
plot_LMA<-ggplot(SRCdata,aes(x=Species,y=LMA,fill=Metabolism))+
  geom_boxplot(lwd=0.2,fatten=5)+
  theme_minimal()+
  scale_fill_manual(values=c("#E1BE6A", "#40B0A6"))+
   ggtitle(expression(paste("LMA (g m"^-2,")")))+
  #geom_point(data=GExdata.0[GExdata.0$Dataset=="Dehydration",],aes(x=Species,y=LMA),size=4,shape=21,fill="yellow")+
  ylim(0,50)+
  #geom_hline(yintercept=0,lty=2)+
  theme(axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13,face="italic"),
        legend.text=element_text(size=13),
        plot.title = element_text(size = 20, hjust = 0.5))+
  #ylab(expression(paste("LMA (g m"^-2,")")))+
  annotate("text",x=1,y=7,label=expression(paste(italic(bar("x"))," = 31.1")),size=4)+
  annotate("text",x=1,y=4,label=expression(paste(italic("n")," = 49")),size=4)+
  annotate("text",x=2,y=7,label=expression(paste("21.2")),size=4)+
  annotate("text",x=2,y=4,label=expression(paste("48")),size=4)+
  annotate("text",x=3,y=7,label=expression(paste("27.4")),size=4)+
  annotate("text",x=3,y=4,label=expression(paste("38")),size=4)+
  annotate("text",x=4,y=7,label=expression(paste("24.7")),size=4)+
  annotate("text",x=4,y=4,label=expression(paste("41")),size=4)+
  annotate("text",x=5,y=7,label=expression(paste("20.6")),size=4)+
  annotate("text",x=5,y=4,label=expression(paste("42")),size=4)+
  annotate("text",x=6,y=7,label=expression(paste("27.5")),size=4)+
  annotate("text",x=6,y=4,label=expression(paste("42")),size=4)+
  annotate("text",x=1,y=max(SRCdata[SRCdata$Species=="Avsa","LMA"],na.rm=T)+4,label=expression(paste(bold("a"))),size=5)+
  annotate("text",x=2,y=max(SRCdata[SRCdata$Species=="Hovu","LMA"],na.rm=T)+4,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=3,y=max(SRCdata[SRCdata$Species=="Trae","LMA"],na.rm=T)+4,label=expression(paste(bold("b"))),size=5)+
  annotate("text",x=4,y=max(SRCdata[SRCdata$Species=="Pegl","LMA"],na.rm=T)+4,label=expression(paste(bold("b"))),size=5)+
  annotate("text",x=5,y=max(SRCdata[SRCdata$Species=="Zema","LMA"],na.rm=T)+4,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=6,y=max(SRCdata[SRCdata$Species=="Chga","LMA"],na.rm=T)+4,label=expression(paste(bold("b"))),size=5)
plot_LMA

# stat
lm1<-lm(LMA~Species,data=SRCdata)
anova(lm1)
tuk1<-HSD.test(lm1,"Species",group=T)
tuk1$groups

# LT
plot_LT<-ggplot(SRCdata,aes(x=Species,y=T.LT,fill=Metabolism))+
  theme_minimal()+
  geom_boxplot(lwd=0.2,fatten=5)+
  scale_fill_manual(values=c("#E1BE6A", "#40B0A6"))+
  #geom_point(data=GExdata.0[GExdata.0$Dataset=="Dehydration",],aes(x=Species,y=LMA),size=4,shape=21,fill="yellow")+
  ylim(0,0.4)+
  #geom_hline(yintercept=0,lty=2)+
  ggtitle("LT (mm)")+
  theme(axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13,face="italic"),
        legend.text=element_text(size=13),
        plot.title = element_text(size = 20, hjust = 0.5))+
  annotate("text",x=1,y=0.056,label=expression(paste(italic(bar("x"))," = 0.22")),size=4)+
  annotate("text",x=1,y=0.032,label=expression(paste(italic("n")," = 49")),size=4)+
  annotate("text",x=2,y=0.056,label=expression(paste("0.19")),size=4)+
  annotate("text",x=2,y=0.032,label=expression(paste("48")),size=4)+
  annotate("text",x=3,y=0.056,label=expression(paste("0.17")),size=4)+
  annotate("text",x=3,y=0.032,label=expression(paste("38")),size=4)+
  annotate("text",x=4,y=0.056,label=expression(paste("0.13")),size=4)+
  annotate("text",x=4,y=0.032,label=expression(paste("41")),size=4)+
  annotate("text",x=5,y=0.056,label=expression(paste("0.16")),size=4)+
  annotate("text",x=5,y=0.032,label=expression(paste("42")),size=4)+
  annotate("text",x=6,y=0.056,label=expression(paste("0.12")),size=4)+
  annotate("text",x=6,y=0.032,label=expression(paste("42")),size=4)+
  annotate("text",x=1,y=max(SRCdata[SRCdata$Species=="Avsa","T.LT"],na.rm=T)+0.032,label=expression(paste(bold("a"))),size=5)+
  annotate("text",x=2,y=max(SRCdata[SRCdata$Species=="Hovu","T.LT"],na.rm=T)+0.032,label=expression(paste(bold("b"))),size=5)+
  annotate("text",x=3,y=max(SRCdata[SRCdata$Species=="Trae","T.LT"],na.rm=T)+0.032,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=4,y=max(SRCdata[SRCdata$Species=="Pegl","T.LT"],na.rm=T)+0.032,label=expression(paste(bold("d"))),size=5)+
  annotate("text",x=5,y=max(SRCdata[SRCdata$Species=="Zema","T.LT"],na.rm=T)+0.032,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=6,y=max(SRCdata[SRCdata$Species=="Chga","T.LT"],na.rm=T)+0.032,label=expression(paste(bold("e"))),size=5)
plot_LT

# stat
lm1<-lm(T.LT~Species,data=SRCdata)
anova(lm1)
tuk1<-HSD.test(lm1,"Species",group=T)
tuk1$groups

# LD
plot_LD<-ggplot(SRCdata,aes(x=Species,y=LD,fill=Metabolism))+
  theme_minimal()+
  geom_boxplot(lwd=0.2,fatten=5)+
  scale_fill_manual(values=c("#E1BE6A", "#40B0A6"))+
  #geom_point(data=GExdata.0[GExdata.0$Dataset=="Dehydration",],aes(x=Species,y=LMA),size=4,shape=21,fill="yellow")+
  ylim(0,0.4)+
  #geom_hline(yintercept=0,lty=2)+
  ggtitle(expression(paste("LD (g cm"^-3,")")))+
  theme(axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13,face="italic"),
        legend.text=element_text(size=13),
        plot.title = element_text(size = 20, hjust = 0.5))+
  annotate("text",x=1,y=0.040,label=expression(paste(italic(bar("x"))," = 0.14")),size=4)+
  annotate("text",x=1,y=0.016,label=expression(paste(italic("n")," = 49")),size=4)+
  annotate("text",x=2,y=0.040,label=expression(paste("0.11")),size=4)+
  annotate("text",x=2,y=0.016,label=expression(paste("48")),size=4)+
  annotate("text",x=3,y=0.040,label=expression(paste("0.17")),size=4)+
  annotate("text",x=3,y=0.016,label=expression(paste("38")),size=4)+
  annotate("text",x=4,y=0.040,label=expression(paste("0.19")),size=4)+
  annotate("text",x=4,y=0.016,label=expression(paste("41")),size=4)+
  annotate("text",x=5,y=0.040,label=expression(paste("0.13")),size=4)+
  annotate("text",x=5,y=0.016,label=expression(paste("42")),size=4)+
  annotate("text",x=6,y=0.040,label=expression(paste("0.24")),size=4)+
  annotate("text",x=6,y=0.016,label=expression(paste("42")),size=4)+
  annotate("text",x=1,y=max(SRCdata[SRCdata$Species=="Avsa","LD"],na.rm=T)+0.032,label=expression(paste(bold("d"))),size=5)+
  annotate("text",x=2,y=max(SRCdata[SRCdata$Species=="Hovu","LD"],na.rm=T)+0.032,label=expression(paste(bold("e"))),size=5)+
  annotate("text",x=3,y=max(SRCdata[SRCdata$Species=="Trae","LD"],na.rm=T)+0.032,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=4,y=max(SRCdata[SRCdata$Species=="Pegl","LD"],na.rm=T)+0.032,label=expression(paste(bold("b"))),size=5)+
  annotate("text",x=5,y=max(SRCdata[SRCdata$Species=="Zema","LD"],na.rm=T)+0.032,label=expression(paste(bold("d"))),size=5)+
  annotate("text",x=6,y=max(SRCdata[SRCdata$Species=="Chga","LD"],na.rm=T)+0.032,label=expression(paste(bold("a"))),size=5)
plot_LD

# stat
lm1<-lm(LD~Species,data=SRCdata)
anova(lm1)
tuk1<-HSD.test(lm1,"Species",group=T)
tuk1$groups

# LDMC
plot_LDMC<-ggplot(SRCdata,aes(x=Species,y=LDMC,fill=Metabolism))+
  theme_minimal()+
  geom_boxplot(lwd=0.2,fatten=5)+
  scale_fill_manual(values=c("#E1BE6A", "#40B0A6"))+
  #geom_point(data=GExdata.0[GExdata.0$Dataset=="Dehydration",],aes(x=Species,y=LMA),size=4,shape=21,fill="yellow")+
  ylim(0,0.3)+
  #geom_hline(yintercept=0,lty=2)+
  ggtitle(expression(paste("LDMC (g g"^-1,")")))+
  theme(axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13,face="italic"),
        legend.text=element_text(size=13),
        plot.title = element_text(size = 20, hjust = 0.5))+
  #ylab(expression(paste("LDMC (g g"^-1,")")))+
  annotate("text",x=1,y=0.024,label=expression(paste(italic(bar("x"))," = 0.13")),size=4)+
  annotate("text",x=1,y=0,label=expression(paste(italic("n")," = 44")),size=4)+
  annotate("text",x=2,y=0.024,label=expression(paste("0.11")),size=4)+
  annotate("text",x=2,y=0,label=expression(paste("47")),size=4)+
  annotate("text",x=3,y=0.024,label=expression(paste("0.16")),size=4)+
  annotate("text",x=3,y=0,label=expression(paste("38")),size=4)+
  annotate("text",x=4,y=0.024,label=expression(paste("0.11")),size=4)+
  annotate("text",x=4,y=0,label=expression(paste("41")),size=4)+
  annotate("text",x=5,y=0.024,label=expression(paste("0.10")),size=4)+
  annotate("text",x=5,y=0,label=expression(paste("41")),size=4)+
  annotate("text",x=6,y=0.024,label=expression(paste("0.16")),size=4)+
  annotate("text",x=6,y=0,label=expression(paste("42")),size=4)+
  annotate("text",x=1,y=max(SRCdata[SRCdata$Species=="Avsa","LDMC"],na.rm=T)+0.024,label=expression(paste(bold("b"))),size=5)+
  annotate("text",x=2,y=max(SRCdata[SRCdata$Species=="Hovu","LDMC"],na.rm=T)+0.024,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=3,y=max(SRCdata[SRCdata$Species=="Trae","LDMC"],na.rm=T)+0.024,label=expression(paste(bold("a"))),size=5)+
  annotate("text",x=4,y=max(SRCdata[SRCdata$Species=="Pegl","LDMC"],na.rm=T)+0.024,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=5,y=max(SRCdata[SRCdata$Species=="Zema","LDMC"],na.rm=T)+0.024,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=6,y=max(SRCdata[SRCdata$Species=="Chga","LDMC"],na.rm=T)+0.024,label=expression(paste(bold("a"))),size=5)

plot_LDMC
# stat
lm1<-lm(LDMC~Species,data=SRCdata)
anova(lm1)
tuk1<-HSD.test(lm1,"Species",group=T)
tuk1$groups


##all graphs for leaf structure

Leaf_structure<- ggarrange(plot_LMA, plot_LT, plot_LD, plot_LDMC, ncol = 2, nrow = 2, common.legend= TRUE, legend = "bottom")
Leaf_structure

ggsave(filename = "../results/leaf_structure.jpg", plot = Leaf_structure,  width = 12, height = 8)

```

##percent loss - thickness, area and width
```{r}

SRCdata = read.csv("../data/SRCdata.csv",header=TRUE) #same data as in Figure 3

# Define order: all C3 species first, then all C4 species
species_order <- c("Avsa", "Hovu", "Trae", "Pegl", "Zema", "Chga")

# Set Species as factor with this order
SRCdata$Species <- factor(SRCdata$Species, levels = species_order)

# PLTdry
PLTdry_plot<-ggplot(SRCdata,aes(x=Species,y=D.PLT,fill=Metabolism))+
   geom_boxplot(lwd=0.2,fatten=5)+
  theme_minimal()+
  scale_fill_manual(values=c("#E1BE6A", "#40B0A6"))+
   ggtitle(expression(paste("PL Thickness"["dry"]," (%)")))+
  ylim(0,100)+
  theme(axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13,face="italic"),
        legend.position = "none",
        #legend.text=element_text(size=13),
        plot.title = element_text(size = 20, hjust = 0.5))+
  #ylab()+
  annotate("text",x=1,y=10,label=expression(paste(italic(bar("x"))," = 46.1")),size=4)+
  annotate("text",x=1,y=4,label=expression(paste(italic("n")," = 49")),size=4)+
  annotate("text",x=2,y=10,label=expression(paste("69.8")),size=4)+
  annotate("text",x=2,y=4,label=expression(paste("48")),size=4)+
  annotate("text",x=3,y=10,label=expression(paste("45.8")),size=4)+
  annotate("text",x=3,y=4,label=expression(paste("38")),size=4)+
  annotate("text",x=4,y=10,label=expression(paste("56.5")),size=4)+
  annotate("text",x=4,y=4,label=expression(paste("41")),size=4)+
  annotate("text",x=5,y=10,label=expression(paste("69.2")),size=4)+
  annotate("text",x=5,y=4,label=expression(paste("42")),size=4)+
  annotate("text",x=6,y=10,label=expression(paste("46.4")),size=4)+
  annotate("text",x=6,y=4,label=expression(paste("42")),size=4)+
  annotate("text",x=1,y=max(SRCdata[SRCdata$Species=="Avsa","D.PLT"],na.rm=T)+8,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=2,y=max(SRCdata[SRCdata$Species=="Hovu","D.PLT"],na.rm=T)+8,label=expression(paste(bold("a"))),size=5)+
  annotate("text",x=3,y=max(SRCdata[SRCdata$Species=="Trae","D.PLT"],na.rm=T)+8,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=4,y=max(SRCdata[SRCdata$Species=="Pegl","D.PLT"],na.rm=T)+8,label=expression(paste(bold("b"))),size=5)+
  annotate("text",x=5,y=max(SRCdata[SRCdata$Species=="Zema","D.PLT"],na.rm=T)+8,label=expression(paste(bold("a"))),size=5)+
  annotate("text",x=6,y=max(SRCdata[SRCdata$Species=="Chga","D.PLT"],na.rm=T)+8,label=expression(paste(bold("c"))),size=5)

PLTdry_plot
# stat
lm1<-lm(D.PLT~Species,data=SRCdata)
anova(lm1)
tuk1<-HSD.test(lm1,"Species",group=T)
tuk1$groups

# PLAdry
PLAdry_plot<-ggplot(SRCdata,aes(x=Species,y=D.PLA,fill=Metabolism))+
   geom_boxplot(lwd=0.2,fatten=5)+
  theme_minimal()+
  scale_fill_manual(values=c("#E1BE6A", "#40B0A6"))+
   ggtitle(expression(paste("PL Area"["dry"]," (%)")))+
  ylim(10,90)+
  theme(axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13,face="italic"),
        legend.position = "none",
        #legend.text=element_text(size=13),
        plot.title = element_text(size = 20, hjust = 0.5))+
  annotate("text",x=1,y=21.2,label=expression(paste(italic(bar("x"))," = 49.4")),size=4)+
  annotate("text",x=1,y=16.4,label=expression(paste(italic("n")," = 48")),size=4)+
  annotate("text",x=2,y=21.2,label=expression(paste("43.7")),size=4)+
  annotate("text",x=2,y=16.4,label=expression(paste("46")),size=4)+
  annotate("text",x=3,y=21.2,label=expression(paste("45.8")),size=4)+
  annotate("text",x=3,y=16.4,label=expression(paste("38")),size=4)+
  annotate("text",x=4,y=21.2,label=expression(paste("60.2")),size=4)+
  annotate("text",x=4,y=16.4,label=expression(paste("41")),size=4)+
  annotate("text",x=5,y=21.2,label=expression(paste("53.0")),size=4)+
  annotate("text",x=5,y=16.4,label=expression(paste("41")),size=4)+
  annotate("text",x=6,y=21.2,label=expression(paste("63.1")),size=4)+
  annotate("text",x=6,y=16.4,label=expression(paste("42")),size=4)+
  annotate("text",x=1,y=max(SRCdata[SRCdata$Species=="Avsa","D.PLA"],na.rm=T)+6.4,label=expression(paste(bold("bc"))),size=5)+
  annotate("text",x=2,y=max(SRCdata[SRCdata$Species=="Hovu","D.PLA"],na.rm=T)+6.4,label=expression(paste(bold("d"))),size=5)+
  annotate("text",x=3,y=max(SRCdata[SRCdata$Species=="Trae","D.PLA"],na.rm=T)+6.4,label=expression(paste(bold("cd"))),size=5)+
  annotate("text",x=4,y=max(SRCdata[SRCdata$Species=="Pegl","D.PLA"],na.rm=T)+6.4,label=expression(paste(bold("a"))),size=5)+
  annotate("text",x=5,y=max(SRCdata[SRCdata$Species=="Zema","D.PLA"],na.rm=T)+6.4,label=expression(paste(bold("b"))),size=5)+
  annotate("text",x=6,y=max(SRCdata[SRCdata$Species=="Chga","D.PLA"],na.rm=T)+6.4,label=expression(paste(bold("a"))),size=5)

PLAdry_plot

# stat
lm1<-lm(D.PLA~Species,data=SRCdata)
anova(lm1)
tuk1<-HSD.test(lm1,"Species",group=T)
tuk1$groups

# PLWidry (PLW1dry)
PLWdry_plot<-ggplot(SRCdata,aes(x=Species,y=D.PLW1,fill=Metabolism))+
  geom_boxplot(lwd=0.2,fatten=5)+
  theme_minimal()+
  scale_fill_manual(values=c("#E1BE6A", "#40B0A6"))+
   ggtitle(expression(paste("PL Width"["dry"]," (%)")))+
  ylim(0,100)+
  theme(axis.text.y=element_text(size=13),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.x=element_text(angle=0,vjust=1,hjust=0.5,size=13,face="italic"),
        legend.position = "none",
        #legend.text=element_text(size=13),
        plot.title = element_text(size = 20, hjust = 0.5))+
  annotate("text",x=1,y=14,label=expression(paste(italic(bar("x"))," = 49.0")),size=4)+
  annotate("text",x=1,y=8,label=expression(paste(italic("n")," = 49")),size=4)+
  annotate("text",x=2,y=14,label=expression(paste("44.9")),size=4)+
  annotate("text",x=2,y=8,label=expression(paste("46")),size=4)+
  annotate("text",x=3,y=14,label=expression(paste("46.8")),size=4)+
  annotate("text",x=3,y=8,label=expression(paste("38")),size=4)+
  annotate("text",x=4,y=14,label=expression(paste("57.9")),size=4)+
  annotate("text",x=4,y=8,label=expression(paste("41")),size=4)+
  annotate("text",x=5,y=14,label=expression(paste("56.3")),size=4)+
  annotate("text",x=5,y=8,label=expression(paste("42")),size=4)+
  annotate("text",x=6,y=14,label=expression(paste("61.6")),size=4)+
  annotate("text",x=6,y=8,label=expression(paste("42")),size=4)+
  annotate("text",x=1,y=max(SRCdata[SRCdata$Species=="Avsa","D.PLW1"],na.rm=T)+8,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=2,y=max(SRCdata[SRCdata$Species=="Hovu","D.PLW1"],na.rm=T)+8,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=3,y=max(SRCdata[SRCdata$Species=="Trae","D.PLW1"],na.rm=T)+8,label=expression(paste(bold("c"))),size=5)+
  annotate("text",x=4,y=max(SRCdata[SRCdata$Species=="Pegl","D.PLW1"],na.rm=T)+8,label=expression(paste(bold("ab"))),size=5)+
  annotate("text",x=5,y=max(SRCdata[SRCdata$Species=="Zema","D.PLW1"],na.rm=T)+8,label=expression(paste(bold("b"))),size=5)+
  annotate("text",x=6,y=max(SRCdata[SRCdata$Species=="Chga","D.PLW1"],na.rm=T)+8,label=expression(paste(bold("a"))),size=5)

PLWdry_plot

# stat
lm1<-lm(D.PLW1~Species,data=SRCdata)
anova(lm1)
tuk1<-HSD.test(lm1,"Species",group=T)
tuk1$groups


##all graphs for leaf structure

# Extract the legend
legend <- get_legend(
  PLTdry_plot +
    theme(legend.position = "right", text = element_text(size=20)) # Adjust position if needed
)

#legend <- plot(legend) #to check if it plots

#now remove the legend from the PLTdry_plot
PLTdry_plot <- PLTdry_plot + theme(legend.position = "none")

Percent_loss_dry<- ggarrange(PLTdry_plot, PLAdry_plot, PLWdry_plot, legend, ncol =2, nrow = 2)

Percent_loss_dry

ggsave(filename = "../results/Percentloss_dry.jpg", plot = Percent_loss_dry, width = 12, height = 8)

```

#Shrinkage - with RWC
```{r}

SRCdata = read.csv("../data/SRCdata.csv",header=TRUE) #same data as in Figure 3

#thickness
shrinkage_curve_thickness <- SRCdata %>%
  dplyr::select(Species, F.RWC , F.PLT ) %>%
  rename(psi = F.RWC) %>%
  rename(gs = F.PLT) %>% #for the script by Megan
  rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()
write.csv(x = shrinkage_curve_thickness, file = "../results/shrinkage/shrinkage_curve_thickness.csv")

#thickness with psi
SRCdata_PV = read.csv("../data/SRCdata_PV.csv",header=TRUE)
shrinkage_curve_thickness_psi <- SRCdata_PV %>%
  dplyr::select(Species, Psileaf.from.RWC , F.PLT ) %>%
  rename(psi = Psileaf.from.RWC) %>%
  rename(gs = F.PLT) %>% 
  rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()

shrinkage_curve_thickness_psi$psi <- shrinkage_curve_thickness_psi$psi*(-1)
write.csv(x = shrinkage_curve_thickness_psi, file = "../results/shrinkage/shrinkage_curve_thickness_psi.csv")


#AREA 
shrinkage_curve_area <- SRCdata %>%
  dplyr::select(Species, F.RWC , F.PLA ) %>%
  rename(psi = F.RWC) %>%
  rename(gs = F.PLA) %>% #for the script by Megan
  rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()
write.csv(x = shrinkage_curve_area, file = "../results/shrinkage/shrinkage_curve_area.csv")

#area with psi
SRCdata_PV = read.csv("../data/SRCdata_PV.csv",header=TRUE)
shrinkage_curve_area_psi <- SRCdata_PV %>%
  dplyr::select(Species, Psileaf.from.RWC , F.PLA ) %>%
  rename(psi = Psileaf.from.RWC) %>%
  rename(gs = F.PLA) %>% 
  rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()
shrinkage_curve_area_psi$psi <- shrinkage_curve_area_psi$psi*(-1)
write.csv(x = shrinkage_curve_area_psi, file = "../results/shrinkage/shrinkage_curve_area_psi.csv")


#Width
shrinkage_curve_width <- SRCdata %>%
  dplyr::select(Species, F.RWC , F.PLW1 ) %>%
  rename(psi = F.RWC) %>%
  rename(gs = F.PLW1) %>% #for the script by Megan
  rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()
write.csv(x = shrinkage_curve_width, file = "../results/shrinkage/shrinkage_curve_width.csv")

#width with psi
SRCdata_PV = read.csv("../data/SRCdata_PV.csv",header=TRUE)
shrinkage_curve_width_psi <- SRCdata_PV %>%
  dplyr::select(Species, Psileaf.from.RWC , F.PLW1 ) %>%
  rename(psi = Psileaf.from.RWC) %>%
  rename(gs = F.PLW1) %>% 
  rename(species = Species) %>%
  mutate(`data type` = 1) %>%
  relocate(`data type` , .after = species )%>%
  drop_na()
shrinkage_curve_width_psi$psi <- shrinkage_curve_width_psi$psi*(-1)
write.csv(x = shrinkage_curve_width_psi, file = "../results/shrinkage/shrinkage_curve_width_psi.csv")
```

##AVSA
```{r}

####################RWC############
SRCdata.avsa <- SRCdata%>% filter(Species == "Avsa")

#thickness
avsa_shrinkage_thickness <-  read.csv("../results/shrinkage/thickness/model_fitting_results.csv") %>%
  filter(Species == "Avsa") %>%
  filter(model =="Linear")

x_seq.avsa.thickness <-  seq(00, 100, length.out = length(SRCdata.avsa$F.PLT))
y_model.avsa.shrinkage.thickness <-  avsa_shrinkage_thickness$A + (x_seq.avsa.thickness*avsa_shrinkage_thickness$B) 


#area
avsa_shrinkage_area <-  read.csv("../results/shrinkage/area/model_fitting_results.csv") %>%
  filter(Species == "Avsa") %>%
  filter(model =="Exponential")

x_seq.avsa.area<-  seq(00, 100, length.out = length(SRCdata.avsa$F.PLA))
y_model.avsa.shrinkage.area<-  avsa_shrinkage_area$A * (exp(-avsa_shrinkage_area$B*x_seq.avsa.area)) 

#width
avsa_shrinkage_width <-  read.csv("../results/shrinkage/width/model_fitting_results.csv") %>%
  filter(Species == "Avsa") %>%
  filter(model =="Exponential")

x_seq.avsa.width <- seq(00, 100, length.out = length(SRCdata.avsa$F.PLW1))
y_model.avsa.shrinkage.width <-  avsa_shrinkage_width$A *(exp(-avsa_shrinkage_width$B*x_seq.avsa.width)) 


avsa_PLT25 = (25-avsa_shrinkage_thickness$A) / avsa_shrinkage_thickness$B
avsa_PLA25 = log(25/avsa_shrinkage_area$A) * (-1/avsa_shrinkage_area$B)
avsa_PLW25 = log(25/avsa_shrinkage_width$A) * (-1/avsa_shrinkage_width$B)

Avsa_shrinkage<-ggplot()+
  geom_point(data=SRCdata[SRCdata$Species=="Avsa",],aes(x=F.RWC,y=F.PLT),size=2,alpha=0.5,colour="#009E73")+
  geom_line(aes(x = x_seq.avsa.thickness, y = y_model.avsa.shrinkage.thickness), color = '#009E73', size=2, alpha=0.7)+
  geom_point(data=SRCdata[SRCdata$Species=="Avsa",],aes(x=F.RWC,y=F.PLA),size=2,alpha=0.5,colour="#0072B2")+
  geom_line(aes(x = x_seq.avsa.area, y = y_model.avsa.shrinkage.area), color = '#0072B2', size=2, alpha=0.7)+
  geom_point(data=SRCdata[SRCdata$Species=="Avsa",],aes(x=F.RWC,y=F.PLW1),size=2,alpha=0.5,fill="white",colour="#D55E00")+
 geom_line(aes(x = x_seq.avsa.width, y = y_model.avsa.shrinkage.width), color = '#D55E00', size=2, alpha=0.7)+
 geom_vline(xintercept=avsa_PLT25,color="#009E73",lty=5, linewidth = 1)+
  geom_vline(xintercept=avsa_PLA25,color="#0072B2",lty=5, linewidth = 1)+
  geom_vline(xintercept=avsa_PLW25,color="#D55E00",lty=5, linewidth = 1)+
  ylim(100,-10)+
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Leaf shrinkage (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("A. sativa")+
   annotate("text", x = 10, y = 95, label = expression(r^2 == 0.90), size = 5, fontface = "bold", color="#009E73")+ #in green
  annotate("text", x = 10, y = 90, label = expression(r^2 == 0.97), size = 5, fontface = "bold", color="#0072B2")+ #in blue
  annotate("text", x = 10, y = 85, label = expression(r^2 == 0.89), size = 5, fontface = "bold", color="#D55E00") # in orange
Avsa_shrinkage



############psi##############
SRCdata.avsa.psi <- SRCdata_PV%>% filter(Species == "Avsa")

#thickness
avsa_shrinkage_thickness_psi <-  read.csv("../results/shrinkage/thickness_psi/model_fitting_results.csv") %>%
  filter(Species == "Avsa") %>%
  filter(model =="Logistic")

x_seq.avsa.thickness.psi <-  seq(0.1, 10, by=0.01)
y_model.avsa.shrinkage.thickness.psi <-  avsa_shrinkage_thickness_psi$A / (1 + ((x_seq.avsa.thickness.psi / avsa_shrinkage_thickness_psi$C)^avsa_shrinkage_thickness_psi$B)) 


#area
avsa_shrinkage_area_psi <-  read.csv("../results/shrinkage/area_psi/model_fitting_results.csv") %>%
  filter(Species == "Avsa") %>%
  filter(model =="Logistic")

x_seq.avsa.area.psi <-  seq(0.1, 10, by=0.01)
y_model.avsa.shrinkage.area.psi <-  avsa_shrinkage_area_psi$A / (1 + ((x_seq.avsa.area.psi / avsa_shrinkage_area_psi$C)^avsa_shrinkage_area_psi$B)) 

#width
avsa_shrinkage_width_psi <-  read.csv("../results/shrinkage/width_psi/model_fitting_results.csv") %>%
  filter(Species == "Avsa") %>%
  filter(model =="Logistic")

x_seq.avsa.width.psi <-  seq(0.1, 10, by=0.01)
y_model.avsa.shrinkage.width.psi <-  avsa_shrinkage_width_psi$A / (1 + ((x_seq.avsa.width.psi / avsa_shrinkage_width_psi$C)^avsa_shrinkage_width_psi$B)) 


avsa_PLT50 = avsa_shrinkage_thickness_psi$psi_kleaf50 * (-1)
avsa_PLA50 = avsa_shrinkage_area_psi$psi_kleaf50 * (-1)
avsa_PLW50 = avsa_shrinkage_width_psi$psi_kleaf50 * (-1)


Avsa_shrinkage<-ggplot()+
  geom_point(data=SRCdata_PV[SRCdata_PV$Species=="Avsa",],aes(x=Psileaf.from.RWC,y=F.PLT),size=2,alpha=0.5,colour="#009E73")+
  geom_line(aes(x = x_seq.avsa.thickness.psi * (-1), y = y_model.avsa.shrinkage.thickness.psi), color = '#009E73', size=2, alpha=0.7)+
  geom_point(data=SRCdata_PV[SRCdata_PV$Species=="Avsa",],aes(x=Psileaf.from.RWC,y=F.PLA),size=2,alpha=0.5,colour="#0072B2")+
  geom_line(aes(x = x_seq.avsa.area.psi * (-1), y = y_model.avsa.shrinkage.area.psi), color = '#0072B2', size=2, alpha=0.7)+
  geom_point(data=SRCdata_PV[SRCdata_PV$Species=="Avsa",],aes(x=Psileaf.from.RWC,y=F.PLW1),size=2,alpha=0.5,fill="white",colour="#D55E00")+
 geom_line(aes(x = x_seq.avsa.width.psi* (-1), y = y_model.avsa.shrinkage.width.psi), color = '#D55E00', size=2, alpha=0.7)+
   geom_vline(xintercept=avsa_PLT50,color="#009E73",lty=5, linewidth = 1)+
   geom_vline(xintercept=avsa_PLA50,color="#0072B2",lty=5, linewidth = 1)+
   geom_vline(xintercept=avsa_PLW50,color="#D55E00",lty=5, linewidth = 1)+
 # ylim(100,-10)+
  xlim(0,-5)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Leaf shrinkage (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("A. sativa")+
   annotate("text", x = 10, y = 95, label = expression(r^2 == 0.90), size = 5, fontface = "bold", color="#009E73")+ #in green
  annotate("text", x = 10, y = 90, label = expression(r^2 == 0.97), size = 5, fontface = "bold", color="#0072B2")+ #in blue
  annotate("text", x = 10, y = 85, label = expression(r^2 == 0.89), size = 5, fontface = "bold", color="#D55E00") # in orange
Avsa_shrinkage

```

##HOVU
```{r}
##### RWC####
SRCdata.hovu <- SRCdata%>% filter(Species == "Hovu")

#thickness
hovu_shrinkage_thickness <-  read.csv("../results/shrinkage/thickness/model_fitting_results.csv") %>%
  filter(Species == "Hovu") %>%
  filter(model =="Logistic")

x_seq.hovu.thickness <-  seq(00, 100, length.out = length(SRCdata.hovu$F.PLT))
y_model.hovu.shrinkage.thickness <- hovu_shrinkage_thickness$A / (1 + ((x_seq.hovu.thickness / hovu_shrinkage_thickness$C)^hovu_shrinkage_thickness$B))


#area
hovu_shrinkage_area <-  read.csv("../results/shrinkage/area/model_fitting_results.csv") %>%
  filter(Species == "Hovu") %>%
  filter(model =="Exponential")

x_seq.hovu.area<-  seq(00, 100, length.out = length(SRCdata.hovu$F.PLA))
y_model.hovu.shrinkage.area<-  hovu_shrinkage_area$A * (exp(-hovu_shrinkage_area$B*x_seq.hovu.area)) 

#width
hovu_shrinkage_width <-  read.csv("../results/shrinkage/width/model_fitting_results.csv") %>%
  filter(Species == "Hovu") %>%
  filter(model =="Exponential")

x_seq.hovu.width <- seq(00, 100, length.out = length(SRCdata.hovu$F.PLW1))
y_model.hovu.shrinkage.width <-  hovu_shrinkage_width$A *(exp(-hovu_shrinkage_width$B*x_seq.hovu.width)) 


hovu_PLT25 = hovu_shrinkage_thickness$C * ((hovu_shrinkage_thickness$A/25)-1)^(1/hovu_shrinkage_thickness$B)
hovu_PLA25 = log(25/hovu_shrinkage_area$A) * (-1/hovu_shrinkage_area$B)
hovu_PLW25 = log(25/hovu_shrinkage_width$A) * (-1/hovu_shrinkage_width$B)

# Hovu
Hovu_shrinkage<-ggplot()+
  geom_point(data=SRCdata[SRCdata$Species=="Hovu",],aes(x=F.RWC,y=F.PLT),size=2,alpha=0.5,colour="#009E73")+
  geom_line(aes(x = x_seq.hovu.thickness, y = y_model.hovu.shrinkage.thickness), color = '#009E73', size=2, alpha=0.7)+
  geom_point(data=SRCdata[SRCdata$Species=="Hovu",],aes(x=F.RWC,y=F.PLA),size=2,alpha=0.5,colour="#0072B2")+
   geom_line(aes(x = x_seq.hovu.area, y = y_model.hovu.shrinkage.area), color = '#0072B2', size=2, alpha=0.7)+
  geom_point(data=SRCdata[SRCdata$Species=="Hovu",],aes(x=F.RWC,y=F.PLW1),size=2,alpha=0.5,fill="white",colour="#D55E00")+
  geom_line(aes(x = x_seq.hovu.width, y = y_model.hovu.shrinkage.width), color = '#D55E00', size=2, alpha=0.7)+
   geom_vline(xintercept=hovu_PLT25,color="#009E73",lty=5, linewidth = 1)+
   geom_vline(xintercept=hovu_PLA25,color="#0072B2",lty=5, linewidth = 1)+
   geom_vline(xintercept=hovu_PLW25,color="#D55E00",lty=5, linewidth = 1)+
   ylim(100,-10)+
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Leaf shrinkage (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("H. vulgare")+
   annotate("text", x = 10, y = 95, label = expression(r^2 == 0.93), size = 5, fontface = "bold", color="#009E73")+ #in green
  annotate("text", x = 10, y = 90, label = expression(r^2 == 0.93), size = 5, fontface = "bold", color="#0072B2")+ #in blue
  annotate("text", x = 10, y = 85, label = expression(r^2 == 0.82), size = 5, fontface = "bold", color="#D55E00") # in orange
Hovu_shrinkage

############psi##############
SRCdata.hovu.psi <- SRCdata_PV%>% filter(Species == "Hovu")

#thickness
hovu_shrinkage_thickness_psi <-  read.csv("../results/shrinkage/thickness_psi/model_fitting_results.csv") %>%
  filter(Species == "Hovu") %>%
  filter(model =="Logistic")

x_seq.hovu.thickness.psi <-  seq(0.1, 10, by=0.01)
y_model.hovu.shrinkage.thickness.psi <-  hovu_shrinkage_thickness_psi$A / (1 + ((x_seq.hovu.thickness.psi / hovu_shrinkage_thickness_psi$C)^hovu_shrinkage_thickness_psi$B)) 


#area
hovu_shrinkage_area_psi <-  read.csv("../results/shrinkage/area_psi/model_fitting_results.csv") %>%
  filter(Species == "Hovu") %>%
  filter(model =="Logistic")

x_seq.hovu.area.psi <-  seq(0.1, 10, by=0.01)
y_model.hovu.shrinkage.area.psi <-  hovu_shrinkage_area_psi$A / (1 + ((x_seq.hovu.area.psi / hovu_shrinkage_area_psi$C)^hovu_shrinkage_area_psi$B)) 

#width
hovu_shrinkage_width_psi <-  read.csv("../results/shrinkage/width_psi/model_fitting_results.csv") %>%
  filter(Species == "Hovu") %>%
  filter(model =="Logistic")

x_seq.hovu.width.psi <-  seq(0.1, 10, by=0.01)
y_model.hovu.shrinkage.width.psi <-  hovu_shrinkage_width_psi$A / (1 + ((x_seq.hovu.width.psi / hovu_shrinkage_width_psi$C)^hovu_shrinkage_width_psi$B)) 


hovu_PLT50 = hovu_shrinkage_thickness_psi$psi_kleaf50 * (-1)
hovu_PLA50 = hovu_shrinkage_area_psi$psi_kleaf50 * (-1)
hovu_PLW50 = hovu_shrinkage_width_psi$psi_kleaf50 * (-1)


hovu_shrinkage<-ggplot()+
  geom_point(data=SRCdata_PV[SRCdata_PV$Species=="Hovu",],aes(x=Psileaf.from.RWC,y=F.PLT),size=2,alpha=0.5,colour="#009E73")+
  geom_line(aes(x = x_seq.hovu.thickness.psi * (-1), y = y_model.hovu.shrinkage.thickness.psi), color = '#009E73', size=2, alpha=0.7)+
  geom_point(data=SRCdata_PV[SRCdata_PV$Species=="Hovu",],aes(x=Psileaf.from.RWC,y=F.PLA),size=2,alpha=0.5,colour="#0072B2")+
  geom_line(aes(x = x_seq.hovu.area.psi * (-1), y = y_model.hovu.shrinkage.area.psi), color = '#0072B2', size=2, alpha=0.7)+
  geom_point(data=SRCdata_PV[SRCdata_PV$Species=="Hovu",],aes(x=Psileaf.from.RWC,y=F.PLW1),size=2,alpha=0.5,fill="white",colour="#D55E00")+
 geom_line(aes(x = x_seq.hovu.width.psi* (-1), y = y_model.hovu.shrinkage.width.psi), color = '#D55E00', size=2, alpha=0.7)+
   geom_vline(xintercept=hovu_PLT50,color="#009E73",lty=5, linewidth = 1)+
   geom_vline(xintercept=hovu_PLA50,color="#0072B2",lty=5, linewidth = 1)+
   geom_vline(xintercept=hovu_PLW50,color="#D55E00",lty=5, linewidth = 1)+
 # ylim(100,-10)+
  xlim(0,-5)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Leaf shrinkage (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("H. vulgare")+
   annotate("text", x = 10, y = 95, label = expression(r^2 == 0.90), size = 5, fontface = "bold", color="#009E73")+ #in green
  annotate("text", x = 10, y = 90, label = expression(r^2 == 0.97), size = 5, fontface = "bold", color="#0072B2")+ #in blue
  annotate("text", x = 10, y = 85, label = expression(r^2 == 0.89), size = 5, fontface = "bold", color="#D55E00") # in orange
hovu_shrinkage


```

##TRAE
```{r}
###RWC##########
SRCdata.trae <- SRCdata%>% filter(Species == "Trae")

#thickness
trae_shrinkage_thickness <-  read.csv("../results/shrinkage/thickness/model_fitting_results.csv") %>%
  filter(Species == "Trae") %>%
  filter(model =="Logistic")

x_seq.trae.thickness <-  seq(00, 100, length.out = length(SRCdata.trae$F.PLT))
y_model.trae.shrinkage.thickness <- trae_shrinkage_thickness$A / (1 + ((x_seq.trae.thickness / trae_shrinkage_thickness$C)^trae_shrinkage_thickness$B))


#area
trae_shrinkage_area <-  read.csv("../results/shrinkage/area/model_fitting_results.csv") %>%
  filter(Species == "Trae") %>%
  filter(model =="Exponential")

x_seq.trae.area<-  seq(00, 100, length.out = length(SRCdata.trae$F.PLA))
y_model.trae.shrinkage.area<-  trae_shrinkage_area$A * (exp(-trae_shrinkage_area$B*x_seq.trae.area)) 

#width
trae_shrinkage_width <-  read.csv("../results/shrinkage/width/model_fitting_results.csv") %>%
  filter(Species == "Trae") %>%
  filter(model =="Exponential")

x_seq.trae.width <- seq(00, 100, length.out = length(SRCdata.trae$F.PLW1))
y_model.trae.shrinkage.width <-  trae_shrinkage_width$A *(exp(-trae_shrinkage_width$B*x_seq.trae.width)) 


trae_PLT25 = trae_shrinkage_thickness$C * ((trae_shrinkage_thickness$A/25)-1)^(1/trae_shrinkage_thickness$B)
trae_PLA25 = log(25/trae_shrinkage_area$A) * (-1/trae_shrinkage_area$B)
trae_PLW25 = log(25/trae_shrinkage_width$A) * (-1/trae_shrinkage_width$B)

# Trae
Trae_shrinkage<-ggplot()+
  geom_point(data=SRCdata[SRCdata$Species=="Trae",],aes(x=F.RWC,y=F.PLT),size=2,alpha=0.5,colour="#009E73")+
  geom_line(aes(x = x_seq.trae.thickness, y = y_model.trae.shrinkage.thickness), color = '#009E73', size=2, alpha=0.7)+
  geom_point(data=SRCdata[SRCdata$Species=="Trae",],aes(x=F.RWC,y=F.PLA),size=2,alpha=0.5,colour="#0072B2")+
   geom_line(aes(x = x_seq.trae.area, y = y_model.trae.shrinkage.area), color = '#0072B2', size=2, alpha=0.7)+
  geom_point(data=SRCdata[SRCdata$Species=="Trae",],aes(x=F.RWC,y=F.PLW1),size=2,alpha=0.5,fill="white",colour="#D55E00")+
  geom_line(aes(x = x_seq.trae.width, y = y_model.trae.shrinkage.width), color = '#D55E00', size=2, alpha=0.7)+
   geom_vline(xintercept=trae_PLT25,color="#009E73",lty=5, linewidth = 1)+
   geom_vline(xintercept=trae_PLA25,color="#0072B2",lty=5, linewidth = 1)+
   geom_vline(xintercept=trae_PLW25,color="#D55E00",lty=5, linewidth = 1)+
   ylim(100,-10)+
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Leaf shrinkage (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("T. aestivum")+
   annotate("text", x = 10, y = 95, label = expression(r^2 == 0.83), size = 5, fontface = "bold", color="#009E73")+ #in green
  annotate("text", x = 10, y = 90, label = expression(r^2 == 0.94), size = 5, fontface = "bold", color="#0072B2")+ #in blue
  annotate("text", x = 10, y = 85, label = expression(r^2 == 0.92), size = 5, fontface = "bold", color="#D55E00") # in orange
Trae_shrinkage


############psi##############
SRCdata.trae.psi <- SRCdata_PV%>% filter(Species == "Trae")

#thickness
trae_shrinkage_thickness_psi <-  read.csv("../results/shrinkage/thickness_psi/model_fitting_results.csv") %>%
  filter(Species == "Trae") %>%
  filter(model =="Logistic")

x_seq.trae.thickness.psi <-  seq(0.1, 10, by=0.01)
y_model.trae.shrinkage.thickness.psi <-  trae_shrinkage_thickness_psi$A / (1 + ((x_seq.trae.thickness.psi / trae_shrinkage_thickness_psi$C)^trae_shrinkage_thickness_psi$B)) 


#area
trae_shrinkage_area_psi <-  read.csv("../results/shrinkage/area_psi/model_fitting_results.csv") %>%
  filter(Species == "Trae") %>%
  filter(model =="Logistic")

x_seq.trae.area.psi <-  seq(0.1, 10, by=0.01)
y_model.trae.shrinkage.area.psi <-  trae_shrinkage_area_psi$A / (1 + ((x_seq.trae.area.psi / trae_shrinkage_area_psi$C)^trae_shrinkage_area_psi$B)) 

#width
trae_shrinkage_width_psi <-  read.csv("../results/shrinkage/width_psi/model_fitting_results.csv") %>%
  filter(Species == "Trae") %>%
  filter(model =="Logistic")

x_seq.trae.width.psi <-  seq(0.1, 10, by=0.01)
y_model.trae.shrinkage.width.psi <-  trae_shrinkage_width_psi$A / (1 + ((x_seq.trae.width.psi / trae_shrinkage_width_psi$C)^trae_shrinkage_width_psi$B)) 


trae_PLT50 = trae_shrinkage_thickness_psi$psi_kleaf50 * (-1)
trae_PLA50 = trae_shrinkage_area_psi$psi_kleaf50 * (-1)
trae_PLW50 = trae_shrinkage_width_psi$psi_kleaf50 * (-1)


trae_shrinkage<-ggplot()+
  geom_point(data=SRCdata_PV[SRCdata_PV$Species=="Trae",],aes(x=Psileaf.from.RWC,y=F.PLT),size=2,alpha=0.5,colour="#009E73")+
  geom_line(aes(x = x_seq.trae.thickness.psi * (-1), y = y_model.trae.shrinkage.thickness.psi), color = '#009E73', size=2, alpha=0.7)+
  geom_point(data=SRCdata_PV[SRCdata_PV$Species=="Trae",],aes(x=Psileaf.from.RWC,y=F.PLA),size=2,alpha=0.5,colour="#0072B2")+
  geom_line(aes(x = x_seq.trae.area.psi * (-1), y = y_model.trae.shrinkage.area.psi), color = '#0072B2', size=2, alpha=0.7)+
  geom_point(data=SRCdata_PV[SRCdata_PV$Species=="Trae",],aes(x=Psileaf.from.RWC,y=F.PLW1),size=2,alpha=0.5,fill="white",colour="#D55E00")+
 geom_line(aes(x = x_seq.trae.width.psi* (-1), y = y_model.trae.shrinkage.width.psi), color = '#D55E00', size=2, alpha=0.7)+
   geom_vline(xintercept=trae_PLT50,color="#009E73",lty=5, linewidth = 1)+
   geom_vline(xintercept=trae_PLA50,color="#0072B2",lty=5, linewidth = 1)+
   geom_vline(xintercept=trae_PLW50,color="#D55E00",lty=5, linewidth = 1)+
 # ylim(100,-10)+
   xlim(0,-5)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Leaf shrinkage (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("T. aestivum")+
   annotate("text", x = 10, y = 95, label = expression(r^2 == 0.90), size = 5, fontface = "bold", color="#009E73")+ #in green
  annotate("text", x = 10, y = 90, label = expression(r^2 == 0.97), size = 5, fontface = "bold", color="#0072B2")+ #in blue
  annotate("text", x = 10, y = 85, label = expression(r^2 == 0.89), size = 5, fontface = "bold", color="#D55E00") # in orange
trae_shrinkage

```

##PEGL
```{r}

######RWC#########
SRCdata.pegl <- SRCdata%>% filter(Species == "Pegl")

#thickness
pegl_shrinkage_thickness <-  read.csv("../results/shrinkage/thickness/model_fitting_results.csv") %>%
  filter(Species == "Pegl") %>%
  filter(model =="Linear")

x_seq.pegl.thickness <-  seq(00, 100, length.out = length(SRCdata.pegl$F.PLT))
y_model.pegl.shrinkage.thickness <-  pegl_shrinkage_thickness$A + (x_seq.pegl.thickness*pegl_shrinkage_thickness$B) 


#area
pegl_shrinkage_area <-  read.csv("../results/shrinkage/area/model_fitting_results.csv") %>%
  filter(Species == "Pegl") %>%
  filter(model =="Exponential")

x_seq.pegl.area<-  seq(00, 100, length.out = length(SRCdata.pegl$F.PLA))
y_model.pegl.shrinkage.area<-  pegl_shrinkage_area$A * (exp(-pegl_shrinkage_area$B*x_seq.pegl.area)) 

#width
pegl_shrinkage_width <-  read.csv("../results/shrinkage/width/model_fitting_results.csv") %>%
  filter(Species == "Pegl") %>%
  filter(model =="Linear")

x_seq.pegl.width <- seq(00, 100, length.out = length(SRCdata.pegl$F.PLW1))
y_model.pegl.shrinkage.width <-  pegl_shrinkage_width$A + pegl_shrinkage_width$B*x_seq.pegl.width


pegl_PLT25 = (25-pegl_shrinkage_thickness$A) / pegl_shrinkage_thickness$B
pegl_PLA25 = log(25/pegl_shrinkage_area$A) * (-1/pegl_shrinkage_area$B)
pegl_PLW25 = (25-pegl_shrinkage_width$A) / pegl_shrinkage_width$B
  
# Pegl
Pegl_shrinkage<-ggplot()+
  geom_point(data=SRCdata[SRCdata$Species=="Pegl",],aes(x=F.RWC,y=F.PLT),size=2,alpha=0.5,colour="#009E73")+
 geom_line(aes(x = x_seq.pegl.thickness, y = y_model.pegl.shrinkage.thickness), color = '#009E73', size=2, alpha=0.7)+
  geom_point(data=SRCdata[SRCdata$Species=="Pegl",],aes(x=F.RWC,y=F.PLA),size=2,alpha=0.5,colour="#0072B2")+
   geom_line(aes(x = x_seq.pegl.area, y = y_model.pegl.shrinkage.area), color = '#0072B2', size=2, alpha=0.7)+
  geom_point(data=SRCdata[SRCdata$Species=="Pegl",],aes(x=F.RWC,y=F.PLW1),size=2,alpha=0.5,fill="white",colour="#D55E00")+
  geom_line(aes(x = x_seq.pegl.width, y = y_model.pegl.shrinkage.width), color = '#D55E00', size=2, alpha=0.7)+
   geom_vline(xintercept=pegl_PLT25,color="#009E73",lty=5, linewidth = 1)+
   geom_vline(xintercept=pegl_PLA25,color="#0072B2",lty=5, linewidth = 1)+
   geom_vline(xintercept=pegl_PLW25,color="#D55E00",lty=5, linewidth = 1)+
   ylim(100,-10)+
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=12),
        axis.title.x=element_text(size=13),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Leaf shrinkage (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("P. glaucum")+
   annotate("text", x = 10, y = 95, label = expression(r^2 == 0.81), size = 5, fontface = "bold", color="#009E73")+ #in green
  annotate("text", x = 10, y = 90, label = expression(r^2 == 0.96), size = 5, fontface = "bold", color="#0072B2")+ #in blue
  annotate("text", x = 10, y = 85, label = expression(r^2 == 0.90), size = 5, fontface = "bold", color="#D55E00") # in orange
Pegl_shrinkage

############psi##############
SRCdata.pegl.psi <- SRCdata_PV%>% filter(Species == "Pegl")

#thickness
pegl_shrinkage_thickness_psi <-  read.csv("../results/shrinkage/thickness_psi/model_fitting_results.csv") %>%
  filter(Species == "Pegl") %>%
  filter(model =="Logistic")

x_seq.pegl.thickness.psi <-  seq(0.1, 10, by=0.01)
y_model.pegl.shrinkage.thickness.psi <-  pegl_shrinkage_thickness_psi$A / (1 + ((x_seq.pegl.thickness.psi / pegl_shrinkage_thickness_psi$C)^pegl_shrinkage_thickness_psi$B)) 


#area
pegl_shrinkage_area_psi <-  read.csv("../results/shrinkage/area_psi/model_fitting_results.csv") %>%
  filter(Species == "Pegl") %>%
  filter(model =="Logistic")

x_seq.pegl.area.psi <-  seq(0.1, 10, by=0.01)
y_model.pegl.shrinkage.area.psi <-  pegl_shrinkage_area_psi$A / (1 + ((x_seq.pegl.area.psi / pegl_shrinkage_area_psi$C)^pegl_shrinkage_area_psi$B)) 

#width
pegl_shrinkage_width_psi <-  read.csv("../results/shrinkage/width_psi/model_fitting_results.csv") %>%
  filter(Species == "Pegl") %>%
  filter(model =="Logistic")

x_seq.pegl.width.psi <-  seq(0.1, 10, by=0.01)
y_model.pegl.shrinkage.width.psi <-  pegl_shrinkage_width_psi$A / (1 + ((x_seq.pegl.width.psi / pegl_shrinkage_width_psi$C)^pegl_shrinkage_width_psi$B)) 


pegl_PLT50 = pegl_shrinkage_thickness_psi$psi_kleaf50 * (-1)
pegl_PLA50 = pegl_shrinkage_area_psi$psi_kleaf50 * (-1)
pegl_PLW50 = pegl_shrinkage_width_psi$psi_kleaf50 * (-1)


pegl_shrinkage<-ggplot()+
  geom_point(data=SRCdata_PV[SRCdata_PV$Species=="Pegl",],aes(x=Psileaf.from.RWC,y=F.PLT),size=2,alpha=0.5,colour="#009E73")+
  geom_line(aes(x = x_seq.pegl.thickness.psi * (-1), y = y_model.pegl.shrinkage.thickness.psi), color = '#009E73', size=2, alpha=0.7)+
  geom_point(data=SRCdata_PV[SRCdata_PV$Species=="Pegl",],aes(x=Psileaf.from.RWC,y=F.PLA),size=2,alpha=0.5,colour="#0072B2")+
  geom_line(aes(x = x_seq.pegl.area.psi * (-1), y = y_model.pegl.shrinkage.area.psi), color = '#0072B2', size=2, alpha=0.7)+
  geom_point(data=SRCdata_PV[SRCdata_PV$Species=="Pegl",],aes(x=Psileaf.from.RWC,y=F.PLW1),size=2,alpha=0.5,fill="white",colour="#D55E00")+
 geom_line(aes(x = x_seq.pegl.width.psi* (-1), y = y_model.pegl.shrinkage.width.psi), color = '#D55E00', size=2, alpha=0.7)+
   geom_vline(xintercept=pegl_PLT50,color="#009E73",lty=5, linewidth = 1)+
   geom_vline(xintercept=pegl_PLA50,color="#0072B2",lty=5, linewidth = 1)+
   geom_vline(xintercept=pegl_PLW50,color="#D55E00",lty=5, linewidth = 1)+
 # ylim(100,-10)+
   xlim(0,-5)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Leaf shrinkage (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("P. glaucum")+
   annotate("text", x = 10, y = 95, label = expression(r^2 == 0.90), size = 5, fontface = "bold", color="#009E73")+ #in green
  annotate("text", x = 10, y = 90, label = expression(r^2 == 0.97), size = 5, fontface = "bold", color="#0072B2")+ #in blue
  annotate("text", x = 10, y = 85, label = expression(r^2 == 0.89), size = 5, fontface = "bold", color="#D55E00") # in orange
pegl_shrinkage
 
```

##ZEMA
```{r}

#######RWC###########
SRCdata.zema <- SRCdata%>% filter(Species == "Zema")
#thickness
zema_shrinkage_thickness <-  read.csv("../results/shrinkage/thickness/model_fitting_results.csv") %>%
  filter(Species == "Zema") %>%
  filter(model =="Logistic")

x_seq.zema.thickness <-  seq(00, 100, length.out = length(SRCdata.zema$F.PLT))
y_model.zema.shrinkage.thickness <- zema_shrinkage_thickness$A / (1 + ((x_seq.zema.thickness / zema_shrinkage_thickness$C)^zema_shrinkage_thickness$B))


#area
zema_shrinkage_area <-  read.csv("../results/shrinkage/area/model_fitting_results.csv") %>%
  filter(Species == "Zema") %>%
  filter(model =="Exponential")

x_seq.zema.area<-  seq(00, 100, length.out = length(SRCdata.zema$F.PLA))
y_model.zema.shrinkage.area<-  zema_shrinkage_area$A * (exp(-zema_shrinkage_area$B*x_seq.zema.area)) 

#width
zema_shrinkage_width <-  read.csv("../results/shrinkage/width/model_fitting_results.csv") %>%
  filter(Species == "Zema") %>%
  filter(model =="Exponential")

x_seq.zema.width <- seq(00, 100, length.out = length(SRCdata.zema$F.PLW1))
y_model.zema.shrinkage.width <-  zema_shrinkage_width$A *(exp(-zema_shrinkage_width$B*x_seq.zema.width)) 


zema_PLT25 = zema_shrinkage_thickness$C * ((zema_shrinkage_thickness$A/25)-1)^(1/zema_shrinkage_thickness$B)
zema_PLA25 = log(25/zema_shrinkage_area$A) * (-1/zema_shrinkage_area$B)
zema_PLW25 = log(25/zema_shrinkage_width$A) * (-1/zema_shrinkage_width$B)

#plot
Zema_shrinkage<-ggplot()+
  geom_point(data=SRCdata[SRCdata$Species=="Zema",],aes(x=F.RWC,y=F.PLT),size=2,alpha=0.5,colour="#009E73")+
  geom_line(aes(x = x_seq.zema.thickness, y = y_model.zema.shrinkage.thickness), color = '#009E73', size=2, alpha=0.7)+
  geom_point(data=SRCdata[SRCdata$Species=="Zema",],aes(x=F.RWC,y=F.PLA),size=2,alpha=0.5,colour="#0072B2")+
  geom_line(aes(x = x_seq.zema.area, y = y_model.zema.shrinkage.area), color = '#0072B2', size=2, alpha=0.7)+
  geom_point(data=SRCdata[SRCdata$Species=="Zema",],aes(x=F.RWC,y=F.PLW1),size=2,alpha=0.5,fill="white",colour="#D55E00")+
  geom_line(aes(x = x_seq.zema.width, y = y_model.zema.shrinkage.width), color = '#D55E00', size=2, alpha=0.7)+
   geom_vline(xintercept=zema_PLT25,color="#009E73",lty=5, linewidth = 1)+
   geom_vline(xintercept=zema_PLA25,color="#0072B2",lty=5, linewidth = 1)+
   geom_vline(xintercept=zema_PLW25,color="#D55E00",lty=5, linewidth = 1)+
   ylim(100,-10)+
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_text(size=12),
        axis.title.x=element_text(size=13),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Leaf shrinkage (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("Z. mays")+
   annotate("text", x = 10, y = 95, label = expression(r^2 == 0.90), size = 5, fontface = "bold", color="#009E73")+ #in green
  annotate("text", x = 10, y = 90, label = expression(r^2 == 0.89), size = 5, fontface = "bold", color="#0072B2")+ #in blue
  annotate("text", x = 10, y = 85, label = expression(r^2 == 0.76), size = 5, fontface = "bold", color="#D55E00") # in orange
Zema_shrinkage


############psi##############
SRCdata.zema.psi <- SRCdata_PV%>% filter(Species == "Zema")

#thickness
zema_shrinkage_thickness_psi <-  read.csv("../results/shrinkage/thickness_psi/model_fitting_results.csv") %>%
  filter(Species == "Zema") %>%
  filter(model =="Logistic")

x_seq.zema.thickness.psi <-  seq(0.1, 10, by=0.01)
y_model.zema.shrinkage.thickness.psi <-  zema_shrinkage_thickness_psi$A / (1 + ((x_seq.zema.thickness.psi / zema_shrinkage_thickness_psi$C)^zema_shrinkage_thickness_psi$B)) 


#area
zema_shrinkage_area_psi <-  read.csv("../results/shrinkage/area_psi/model_fitting_results.csv") %>%
  filter(Species == "Zema") %>%
  filter(model =="Logistic")

x_seq.zema.area.psi <-  seq(0.1, 10, by=0.01)
y_model.zema.shrinkage.area.psi <-  zema_shrinkage_area_psi$A / (1 + ((x_seq.zema.area.psi / zema_shrinkage_area_psi$C)^zema_shrinkage_area_psi$B)) 

#width
zema_shrinkage_width_psi <-  read.csv("../results/shrinkage/width_psi/model_fitting_results.csv") %>%
  filter(Species == "Zema") %>%
  filter(model =="Logistic")

x_seq.zema.width.psi <-  seq(0.1, 10, by=0.01)
y_model.zema.shrinkage.width.psi <-  zema_shrinkage_width_psi$A / (1 + ((x_seq.zema.width.psi / zema_shrinkage_width_psi$C)^zema_shrinkage_width_psi$B)) 


zema_PLT50 = zema_shrinkage_thickness_psi$psi_kleaf50 * (-1)
zema_PLA50 = zema_shrinkage_area_psi$psi_kleaf50 * (-1)
zema_PLW50 = zema_shrinkage_width_psi$psi_kleaf50 * (-1)


zema_shrinkage<-ggplot()+
  geom_point(data=SRCdata_PV[SRCdata_PV$Species=="Zema",],aes(x=Psileaf.from.RWC,y=F.PLT),size=2,alpha=0.5,colour="#009E73")+
  geom_line(aes(x = x_seq.zema.thickness.psi * (-1), y = y_model.zema.shrinkage.thickness.psi), color = '#009E73', size=2, alpha=0.7)+
  geom_point(data=SRCdata_PV[SRCdata_PV$Species=="Zema",],aes(x=Psileaf.from.RWC,y=F.PLA),size=2,alpha=0.5,colour="#0072B2")+
  geom_line(aes(x = x_seq.zema.area.psi * (-1), y = y_model.zema.shrinkage.area.psi), color = '#0072B2', size=2, alpha=0.7)+
  geom_point(data=SRCdata_PV[SRCdata_PV$Species=="Zema",],aes(x=Psileaf.from.RWC,y=F.PLW1),size=2,alpha=0.5,fill="white",colour="#D55E00")+
 geom_line(aes(x = x_seq.zema.width.psi* (-1), y = y_model.zema.shrinkage.width.psi), color = '#D55E00', size=2, alpha=0.7)+
   geom_vline(xintercept=zema_PLT50,color="#009E73",lty=5, linewidth = 1)+
   geom_vline(xintercept=zema_PLA50,color="#0072B2",lty=5, linewidth = 1)+
   geom_vline(xintercept=zema_PLW50,color="#D55E00",lty=5, linewidth = 1)+
 # ylim(100,-10)+
   xlim(0,-5)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Leaf shrinkage (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("Z. mays")+
   annotate("text", x = 10, y = 95, label = expression(r^2 == 0.90), size = 5, fontface = "bold", color="#009E73")+ #in green
  annotate("text", x = 10, y = 90, label = expression(r^2 == 0.97), size = 5, fontface = "bold", color="#0072B2")+ #in blue
  annotate("text", x = 10, y = 85, label = expression(r^2 == 0.89), size = 5, fontface = "bold", color="#D55E00") # in orange
zema_shrinkage

```

##CHGA
```{r}

#######RWC###############
SRCdata.chga <- SRCdata%>% filter(Species == "Chga")

#thickness
chga_shrinkage_thickness <-  read.csv("../results/shrinkage/thickness/model_fitting_results.csv") %>%
  filter(Species == "Chga") %>%
  filter(model =="Linear")

x_seq.chga.thickness <-  seq(00, 100, length.out = length(SRCdata.chga$F.PLT))
y_model.chga.shrinkage.thickness <-  chga_shrinkage_thickness$A + (x_seq.chga.thickness*chga_shrinkage_thickness$B) 


#area
chga_shrinkage_area <-  read.csv("../results/shrinkage/area/model_fitting_results.csv") %>%
  filter(Species == "Chga") %>%
  filter(model =="Exponential")

x_seq.chga.area<-  seq(00, 100, length.out = length(SRCdata.chga$F.PLA))
y_model.chga.shrinkage.area<-  chga_shrinkage_area$A * (exp(-chga_shrinkage_area$B*x_seq.chga.area)) 

#width
chga_shrinkage_width <-  read.csv("../results/shrinkage/width/model_fitting_results.csv") %>%
  filter(Species == "Chga") %>%
  filter(model =="Exponential")

x_seq.chga.width <- seq(00, 100, length.out = length(SRCdata.chga$F.PLW1))
y_model.chga.shrinkage.width <-  chga_shrinkage_width$A *(exp(-chga_shrinkage_width$B*x_seq.chga.width)) 


chga_PLT25 = (25-chga_shrinkage_thickness$A) / chga_shrinkage_thickness$B
chga_PLA25 = log(25/chga_shrinkage_area$A) * (-1/chga_shrinkage_area$B)
chga_PLW25 = log(25/chga_shrinkage_width$A) * (-1/chga_shrinkage_width$B)

# Plot
Chga_shrinkage<-ggplot()+
  geom_point(data=SRCdata[SRCdata$Species=="Chga",],aes(x=F.RWC,y=F.PLT),size=2,alpha=0.5,colour="#009E73")+
 geom_line(aes(x = x_seq.chga.thickness, y = y_model.chga.shrinkage.thickness), color = '#009E73', size=2, alpha=0.7)+
  geom_point(data=SRCdata[SRCdata$Species=="Chga",],aes(x=F.RWC,y=F.PLA),size=2,alpha=0.5,colour="#0072B2")+
  geom_line(aes(x = x_seq.chga.area, y = y_model.chga.shrinkage.area), color = '#0072B2', size=2, alpha=0.7)+
  geom_point(data=SRCdata[SRCdata$Species=="Chga",],aes(x=F.RWC,y=F.PLW1),size=2,alpha=0.5,fill="white",colour="#D55E00")+
  geom_line(aes(x = x_seq.chga.width, y = y_model.chga.shrinkage.width), color = '#D55E00', size=2, alpha=0.7)+
   geom_vline(xintercept=chga_PLT25,color="#009E73",lty=5, linewidth = 1)+
   geom_vline(xintercept=chga_PLA25,color="#0072B2",lty=5, linewidth = 1)+
   geom_vline(xintercept=chga_PLW25,color="#D55E00",lty=5, linewidth = 1)+
   ylim(100,-10)+
  xlim(100,0)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_text(size=13),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Leaf shrinkage (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("C. gayan")+
   annotate("text", x = 10, y = 95, label = expression(r^2 == 0.81), size = 5, fontface = "bold", color="#009E73")+ #in green
  annotate("text", x = 10, y = 90, label = expression(r^2 == 0.97), size = 5, fontface = "bold", color="#0072B2")+ #in blue
  annotate("text", x = 10, y = 85, label = expression(r^2 == 0.93), size = 5, fontface = "bold", color="#D55E00") # in orange
Chga_shrinkage

############psi##############
SRCdata.chga.psi <- SRCdata_PV%>% filter(Species == "Chga")

#thickness
chga_shrinkage_thickness_psi <-  read.csv("../results/shrinkage/thickness_psi/model_fitting_results.csv") %>%
  filter(Species == "Chga") %>%
  filter(model =="Logistic")

x_seq.chga.thickness.psi <-  seq(0.1, 10, by=0.01)
y_model.chga.shrinkage.thickness.psi <-  chga_shrinkage_thickness_psi$A / (1 + ((x_seq.chga.thickness.psi / chga_shrinkage_thickness_psi$C)^chga_shrinkage_thickness_psi$B)) 


#area
chga_shrinkage_area_psi <-  read.csv("../results/shrinkage/area_psi/model_fitting_results.csv") %>%
  filter(Species == "Chga") %>%
  filter(model =="Logistic")

x_seq.chga.area.psi <-  seq(0.1, 10, by=0.01)
y_model.chga.shrinkage.area.psi <-  chga_shrinkage_area_psi$A / (1 + ((x_seq.chga.area.psi / chga_shrinkage_area_psi$C)^chga_shrinkage_area_psi$B)) 

#width
chga_shrinkage_width_psi <-  read.csv("../results/shrinkage/width_psi/model_fitting_results.csv") %>%
  filter(Species == "Chga") %>%
  filter(model =="Logistic")

x_seq.chga.width.psi <-  seq(0.1, 10, by=0.01)
y_model.chga.shrinkage.width.psi <-  chga_shrinkage_width_psi$A / (1 + ((x_seq.chga.width.psi / chga_shrinkage_width_psi$C)^chga_shrinkage_width_psi$B)) 


chga_PLT50 = chga_shrinkage_thickness_psi$psi_kleaf50 * (-1)
chga_PLA50 = chga_shrinkage_area_psi$psi_kleaf50 * (-1)
chga_PLW50 = chga_shrinkage_width_psi$psi_kleaf50 * (-1)


chga_shrinkage<-ggplot()+
  geom_point(data=SRCdata_PV[SRCdata_PV$Species=="Chga",],aes(x=Psileaf.from.RWC,y=F.PLT),size=2,alpha=0.5,colour="#009E73")+
  geom_line(aes(x = x_seq.chga.thickness.psi * (-1), y = y_model.chga.shrinkage.thickness.psi), color = '#009E73', size=2, alpha=0.7)+
  geom_point(data=SRCdata_PV[SRCdata_PV$Species=="Chga",],aes(x=Psileaf.from.RWC,y=F.PLA),size=2,alpha=0.5,colour="#0072B2")+
  geom_line(aes(x = x_seq.chga.area.psi * (-1), y = y_model.chga.shrinkage.area.psi), color = '#0072B2', size=2, alpha=0.7)+
  geom_point(data=SRCdata_PV[SRCdata_PV$Species=="Chga",],aes(x=Psileaf.from.RWC,y=F.PLW1),size=2,alpha=0.5,fill="white",colour="#D55E00")+
 geom_line(aes(x = x_seq.chga.width.psi* (-1), y = y_model.chga.shrinkage.width.psi), color = '#D55E00', size=2, alpha=0.7)+
   geom_vline(xintercept=chga_PLT50,color="#009E73",lty=5, linewidth = 1)+
   geom_vline(xintercept=chga_PLA50,color="#0072B2",lty=5, linewidth = 1)+
   geom_vline(xintercept=chga_PLW50,color="#D55E00",lty=5, linewidth = 1)+
 # ylim(100,-10)+
  xlim(0,-5)+
  theme_minimal()+
  theme(axis.title.y=element_text(size=13),
        axis.text.y=element_text(size=12),
        axis.title.x=element_blank(),
        axis.text.x=element_text(size=12),
        strip.text=element_text(size=13, face="italic"),
        title = element_text(face = "bold.italic"),
        legend.position = "none") +
  ylab(expression(paste("Leaf shrinkage (%)")))+
  xlab(expression(paste("Relative water content (%)")))+
  ggtitle("C. gayan")+
   annotate("text", x = 10, y = 95, label = expression(r^2 == 0.90), size = 5, fontface = "bold", color="#009E73")+ #in green
  annotate("text", x = 10, y = 90, label = expression(r^2 == 0.97), size = 5, fontface = "bold", color="#0072B2")+ #in blue
  annotate("text", x = 10, y = 85, label = expression(r^2 == 0.89), size = 5, fontface = "bold", color="#D55E00") # in orange
chga_shrinkage


```

#ALL PLOTS
```{r}
### all plots ----
shrinkage_psi_plot <- ggarrange(Avsa_shrinkage, Hovu_shrinkage, Trae_shrinkage, Chga_shrinkage, Pegl_shrinkage, Zema_shrinkage,  ncol =3, nrow = 2)

shrinkage_psi_plot 

ggsave(filename = "../results/Figure4.jpg", plot = shrinkage_psi_plot, width = 12, height = 8)
```


#PL50
```{r}
shrinkage <- tribble(
  ~Species, ~RWCPLT25, ~RWCPLA25, ~RWCPLW25,
  "Avsa", avsa_PLT25, avsa_PLA25, avsa_PLW25,
  "Hovu", hovu_PLT25, hovu_PLA25, hovu_PLW25,
  "Trae", trae_PLT25, trae_PLA25, trae_PLW25,
  "Pegl", pegl_PLT25, pegl_PLA25, pegl_PLW25,
  "Chga", chga_PLT25, chga_PLA25, chga_PLW25,
  "Zema", zema_PLT25, zema_PLA25, zema_PLW25)

write.csv(shrinkage, file = "../results/shrinkage_P25.csv")

# shrinkage_P50 <- tribble(
#   ~Species, ~PLT50,~PLA50,~PLW50, 
#   "Avsa", avsa_PLT50, avsa_PLA50, avsa_PLW50,
#   "Hovu", hovu_PLT50, hovu_PLA50, hovu_PLW50,
#   "Trae", trae_PLT50, trae_PLA50, trae_PLW50,
#   "Pegl", pegl_PLT50, pegl_PLA50, pegl_PLW50,
#   "Chga", chga_PLT50, chga_PLA50, chga_PLW50,
#   "Zema", zema_PLT50, zema_PLA50, zema_PLW50,
# )
```



#///////SUMMARY TABLE

#raw
```{r}
# Amax and P50 for A, gs, WUE, Kleaf, Kroot, Kplant
Amax_P50_summary <- read.csv("../results/summary_max_P50.csv", header = T) %>%select(-X)

# PV data
PVdata <- read_xlsx("../data/C3C4 Grasses - PV.xlsx", sheet = "C3C4G PV R") %>%
  mutate(
    Metabolism = factor(Metabolism),
    Species = factor(Species, levels=c("Avsa","Hovu","Trae","Pegl","Zema","Chga")),
    T.LV  = T.LA * T.LT / 10,
    LMA   = DW/1000/(T.LA/10000),
    LD    = DW/1000/T.LV,
    LDMC  = DW/TW,
    e     = em.*(1-af))

m.PVdata <- ddply(PVdata, c("Metabolism","Species"), summarise,
                  osp.tlp=mean(osp.tlp,na.rm=TRUE),
                  osp.ft=mean(osp.ft,na.rm=TRUE),
                  rwc.tlp=mean(rwc.tlp,na.rm=TRUE),
                  cft=mean(cft,na.rm=TRUE),
                  ctlp=mean(ctlp,na.rm=TRUE),
                  e=mean(e,na.rm=TRUE))

#Embolism threshold
embolism_onset <- tribble(
  ~Species, ~RWC_embolism_onset,
  "Avsa", 85.75, "Hovu", 71.72, "Trae", 68.04,
  "Pegl", 19.01, "Chga", 34.16, "Zema", 19.25)

# Fv/Fm
FvFm_summary <- read.csv("../results/FvFm_summary_PLNCF.csv",header=TRUE) %>% select(-X)

#Rehydration capacity at 50
RC_summary <- read.csv("../results/RC_summary_PLRC.csv",header=TRUE) %>% select(-X)

#Shrinkage PLX25
shrinkage <- read.csv("../results/shrinkage_P25.csv",header=TRUE) %>% select(-X)

# Anatomy
anatomy <- read.csv("../data/m.SRCdata.csv", header=TRUE) %>%
  select(Species, Metabolism, m.LMA, m.T.LT, m.LDMC, m.LD, m.D.PLT, m.D.PLA, m.D.PLW1) %>%
  rename(
    LMA = m.LMA,
    LT = m.T.LT,
    LDMC = m.LDMC,
    LD = m.LD,
    PLT = m.D.PLT,
    PLA = m.D.PLA,
    PLW = m.D.PLW1) 

# ----------------Final merge --------------------
summary <- Amax_P50_summary %>%
  left_join(m.PVdata) %>%
  relocate(Metabolism, .after=Species) %>%
  mutate(
    SSMleaf = osp.tlp - PKleaf50,
    `PKleaf50-Pgs50` = PKleaf50 - Pgs50,
    `Kleafmax:gsmax` = Kleafmax / gsmax * 0.001) %>%
  left_join(embolism_onset) %>%
  left_join(RC_summary) %>%
  left_join(FvFm_summary) %>%
  left_join(shrinkage) %>%
  left_join(anatomy)

#re-organize 
summary_df <- summary %>%
  relocate(WUEimax, .after = gsmax) %>%
  relocate(c(PA50, Pgs50, PWUEimax), .after = WUEimax)%>%
  relocate(LT, .after = RWC_PLNCF50) %>%
  relocate(c(RWCPLT25, RWCPLA25, RWCPLW25), .after = PLW)

colnames(summary_df)

#------------------------------
#do ttests on C3 C4 means
stat <- summary_df %>%
  mutate(across(-c(Species, Metabolism), as.numeric))

stat_log <- stat %>% 
  mutate(across(-c(Species, Metabolism), abs)) %>%
  mutate(across(-c(Species, Metabolism), log))

# t-test p-values for each trait
trait_cols <- names(stat)[!names(stat) %in% c("Species", "Metabolism")]

ttest_results <- map_dbl(trait_cols, function(trait) {
  t.test(log(abs(stat[[(trait)]])) ~ stat$Metabolism, alternative = "two.sided", var.equal = TRUE)$p.value
})

# Create a t-test row
ttest_row <- tibble(
  Species = "t.test p-value",
  Metabolism = "",
  !!!set_names(as.list(round(ttest_results, 4)), trait_cols))

# calculate means for C3 and C4
group_means <- stat %>%
  group_by(Metabolism) %>%
  summarise(across(all_of(trait_cols), ~ round(mean(.x, na.rm = TRUE), 2)),
            .groups = "drop") %>%
  mutate(Species = paste0("mean", Metabolism)) %>%
  relocate(Species, .before = Metabolism)

summary_table <- bind_rows(stat, group_means, ttest_row)

write.csv(x = summary_table, file = "../results/summary_table_ttest.csv")
```

#Print table 

```{r}

summary_table <- read_csv("C:/Users/marion.boisseaux/Dropbox/Mon PC (Jaboty20)/Post_doc_CalState_LA/Miquel_data/results/summary_table_ttest.csv") %>%select(-`...1`) 

summary_table <- summary_table %>%
  relocate(`Kleafmax:gsmax`, .after = Kleafmax)

units_tbl <- read_excel("C:/Users/marion.boisseaux/Dropbox/Mon PC (Jaboty20)/Post_doc_CalState_LA/Miquel_data/data/units.xlsx")  %>%   # adjust
  pivot_longer(
    everything(),
    names_to = "Trait",
    values_to = "Units"
  )

# pivot longer
df_long <- summary_table  %>%
  pivot_longer(
    cols = -c(Species, Metabolism),
    names_to = "Trait",
    values_to = "Value"
  )

# Step 4: add units
df_long_units <- df_long %>%
  left_join(units_tbl, by = "Trait")

# Step 5: pivot_wider
df_wide <- df_long_units %>%
  select(Trait, Units, Species, Value) %>%
  pivot_wider(names_from = Species, values_from = Value)

df_rounded <- df_wide %>%
  mutate(across(-c(Trait, Units), ~ {
    # try to convert to numeric, if it fails keep original
    num_val <- suppressWarnings(as.numeric(.))
    ifelse(!is.na(num_val), round(num_val, 3), .)
  }))

df_rounded_named <- df_rounded %>%
  rename_with(
    ~ recode(.,
      "Zema" = "Z. mays",
      "Chga" = "C. gayana",
      "Pegl" = "P. glaucum",
      "Avsa" = "A. sativa",
      "Hovu" = "H. vulgare",
      "Trae" = "T. aestivum"
    ),
    .cols = c("Zema", "Chga", "Pegl", "Avsa", "Hovu", "Trae")  # list of columns to rename
  )

df_final <- df_rounded_named %>%
  mutate(`t.test p-value` = formatC(`t.test p-value`, format = "f", digits = 3)) %>%
  mutate(`t.test p-value` = ifelse(
    as.numeric(`t.test p-value`) < 0.05,
    paste0("<b>", `t.test p-value`, "</b>"),
    `t.test p-value`
  ))

df_final <- df_final %>% filter(!Trait %in% c("SSMleaf", "PKleaf50-Pgs50"))


#for subscript and itlic
df_final$Trait <- dplyr::recode(df_final$Trait,
  "Amax"      = "<i>A</i><sub>max</sub>",
  "gsmax"     = "<i>g</i><sub>s,max</sub>",
  "WUEimax"   = "<i>WUE</i><sub>i,max</sub>",
  "PA50"      = "<i>P</i><sub>A50</sub>",
  "Pgs50"     = "<i>P</i><sub>gs50</sub>",
  "PWUEimax"  = "<i>P</i><sub>WUEi,max</sub>",
  "Kleafmax"  = "<i>K</i><sub>leaf,max</sub>",
  "Krootmax"  = "<i>K</i><sub>root,max</sub>",
  "Kplantmax" = "<i>K</i><sub>plant,max</sub>",
  "PKleaf50"  = "<i>P</i><sub>Kleaf50</sub>",
  "PKroot50"  = "<i>P</i><sub>Kroot50</sub>",
  "PKplant50"  = "<i>P</i><sub>Kplant50</sub>",
  "osp.tlp" = "π<sub>tlp</sub>",
  "osp.ft" = "π<sub>o</sub>",
  "rwc.tlp" = "RWC<sub>tlp</sub>",
  "cft" = "<i>C</i><sub>ft</sub>",
  "ctlp" = "<i>C</i><sub>tlp</sub>",
  "e" = "ε",
#  "SSMleaf" = "SSM<sub>leaf</sub>",
 # "PKleaf50-Pgs50"  = "P<sub>Kleaf50</sub>-P<sub>gs50</sub>",
  "Kleafmax:gsmax" = "<i>K</i><sub>leaf,max</sub>:<i>g</i><sub>s,max</sub>",
  "RWC_embolism_onset" = "RWC embolism onset",
  "RWC_PLRC50" = "RWC<sub>PLRC50</sub>",
  "RWC_PLNCF50" = "RWC<sub>PLNCF50</sub>",
  "RWCPLT25" = "RWC<sub>PLT25</sub>",
  "RWCPLA25"= "RWC<sub>PLA25</sub>",
  "RWCPLW25"  = "RWC<sub>PLW25</sub>",
  "PLA" = "PLA<sub>dry</sub>",
"PLW" = "PLW<sub>dry</sub>",
"PLT" = "PLT<sub>dry</sub>")

colnames(df_final)[colnames(df_final) == 'A. sativa'] <- '<i>A. sativa</i>'
colnames(df_final)[colnames(df_final) == 'H. vulgare'] <- '<i>H. vulgare</i>'
colnames(df_final)[colnames(df_final) == 'T. aestivum'] <- '<i>T. aestivum</i>'
colnames(df_final)[colnames(df_final) == 'P. glaucum'] <- '<i>P. glaucum</i>'
colnames(df_final)[colnames(df_final) == 'C. gayana'] <- '<i>C. gayana</i>'
colnames(df_final)[colnames(df_final) == 'Z. mays'] <- '<i>Z. mays</i>'

colnames(df_final)[colnames(df_final) == 'meanC3'] <- 'mean C3'
colnames(df_final)[colnames(df_final) == 'meanC4'] <- 'mean C4'

df_final %>%
  kbl(caption = "TABLE 1 | Mean values of key physiological and morphological traits of six grass species with results of t-test comparing trait values between C3 and C4 grasses.", escape = FALSE, digits = 2, , width = "\\linewidth") %>%
  row_spec(0, bold = TRUE) %>% 
  kable_classic(full_width = F, html_font = "Cambria") %>%
  column_spec(1, width = "7em") %>%#make first column narrower (adjust "7em" )
  #save_kable(file = "../results/Plot_info_summary.png", zoom = 5)
  column_spec(2, width = "13em") %>%
  column_spec(9, width = "6em", background = "azure2") %>%
  column_spec(10, width = "7em", background = "bisque") %>%
  column_spec(3, width = "8em") %>%
   column_spec(4, width = "8em") %>%
   column_spec(5, width = "8em") %>%
   column_spec(6, width = "8em") %>%
   column_spec(7, width = "8em") %>%
   column_spec(8, width = "8em") %>%
  column_spec(11, width = "9em") %>%
  kable_styling(bootstrap_options = "striped", font_size =12) %>%
  pack_rows("Leaf gas exchange", 1, 6)%>%
  pack_rows("Hydraulic conductance", 7, 13) %>%
  pack_rows("PV traits", 14, 19)%>%
  pack_rows("Embolism onset, rehydration capacity & photochemistry", 20, 22)%>%
  pack_rows("Anatomy and shrinkage", 23, 32)  %>%
  save_kable(file = "../results/Plot_info_summary_26112025.png", zoom = 6)
```


#//////////SEQUENCE OF EVENTS 


```{r}

# P50 for A, gs, WUE, Kleaf, Kroot, Kplant
P50_summary <- read.csv("../results/summary_max_P50.csv", header = T) %>%select(-X, -Amax, -gsmax, -Kleafmax, -Krootmax, -Kplantmax)


# PV data
PVdata <- read_xlsx("../data/C3C4 Grasses - PV.xlsx", sheet = "C3C4G PV R") 
m.PVdata <- ddply(PVdata, c("Metabolism","Species"), summarise,
                  osp.tlp=mean(osp.tlp,na.rm=TRUE))

#add onset of embolism in psi
embolism_onset <- tribble(
  ~Species, ~RWC_embolism_onset,
  "Avsa", 85.75, "Hovu", 71.72, "Trae", 68.04,
  "Pegl", 19.01, "Chga", 34.16, "Zema", 19.25)

embolism_onset_PV <- embolism_onset %>% 
  mutate(
    tlp.coef = case_when(
      Species == "Avsa" ~ -0.84,
      Species == "Chga" ~ -0.75,
      Species == "Hovu" ~ -0.83,
      Species == "Pegl" ~ -0.68,
      Species == "Trae" ~ -0.85,
      Species == "Zema" ~ -0.68,
      TRUE ~ NA_real_
    ),
    elasticity = case_when(
      Species == "Avsa" ~ 8.57,
      Species == "Chga" ~ 11.6,
      Species == "Hovu" ~ 9.27,
      Species == "Pegl" ~ 8.99,
      Species == "Trae" ~ 9.25,
      Species == "Zema" ~ 8.07,
      TRUE ~ NA_real_)) %>% 
  mutate(Psip =-(tlp.coef)-(elasticity*(1-RWC_embolism_onset/100))) %>% 
  mutate(Psip = if_else(Psip < 0, 0, Psip))%>%  # Replace negative Psip with 0
  mutate(Ps=tlp.coef/(RWC_embolism_onset/100)) %>% #tlp en neg 
  mutate(`Embolism onset`= Psip + Ps)

embolism_onset_PV <- embolism_onset_PV  %>% select(Species, `Embolism onset`)

# Fv/Fm
FvFm_summary <- read.csv("../results/FvFm_summary_PLNCF.csv",header=TRUE) %>% select(-X)

FvFm_summary_PV <- FvFm_summary %>%
  mutate(
    tlp.coef = case_when(
      Species == "Avsa" ~ -0.84,
      Species == "Chga" ~ -0.75,
      Species == "Hovu" ~ -0.83,
      Species == "Pegl" ~ -0.68,
      Species == "Trae" ~ -0.85,
      Species == "Zema" ~ -0.68,
      TRUE ~ NA_real_
    ),
    elasticity = case_when(
      Species == "Avsa" ~ 8.57,
      Species == "Chga" ~ 11.6,
      Species == "Hovu" ~ 9.27,
      Species == "Pegl" ~ 8.99,
      Species == "Trae" ~ 9.25,
      Species == "Zema" ~ 8.07,
      TRUE ~ NA_real_)) %>% 
  mutate(Psip =-(tlp.coef)-(elasticity*(1-RWC_PLNCF50/100))) %>% 
  mutate(Psip = if_else(Psip < 0, 0, Psip))%>%  # Replace negative Psip with 0
  mutate(Ps=tlp.coef/(RWC_PLNCF50/100)) %>% #tlp en neg 
  mutate(`PPLNCF50`= Psip + Ps) %>%
  select(Species, PPLNCF50)

#Rehydration capacity at 50
RC_summary <- read.csv("../results/RC_summary_PLRC.csv",header=TRUE) %>% select(-X)

RC_summary_PV <- RC_summary %>%
  mutate(
    tlp.coef = case_when(
      Species == "Avsa" ~ -0.84,
      Species == "Chga" ~ -0.75,
      Species == "Hovu" ~ -0.83,
      Species == "Pegl" ~ -0.68,
      Species == "Trae" ~ -0.85,
      Species == "Zema" ~ -0.68,
      TRUE ~ NA_real_
    ),
    elasticity = case_when(
      Species == "Avsa" ~ 8.57,
      Species == "Chga" ~ 11.6,
      Species == "Hovu" ~ 9.27,
      Species == "Pegl" ~ 8.99,
      Species == "Trae" ~ 9.25,
      Species == "Zema" ~ 8.07,
      TRUE ~ NA_real_)) %>% 
  mutate(Psip =-(tlp.coef)-(elasticity*(1-RWC_PLRC50/100))) %>% 
  mutate(Psip = if_else(Psip < 0, 0, Psip))%>%  # Replace negative Psip with 0
  mutate(Ps=tlp.coef/(RWC_PLRC50/100)) %>% #tlp en neg 
  mutate(`PPLRC50`= Psip + Ps) %>%
  select(Species, PPLRC50)

#Shrinkage PLX25
shrinkage <- read.csv("../results/shrinkage_P25.csv",header=TRUE) %>% select(-X)

shrinkage_PV <- shrinkage %>%
  mutate(
    tlp.coef = case_when(
      Species == "Avsa" ~ -0.84,
      Species == "Chga" ~ -0.75,
      Species == "Hovu" ~ -0.83,
      Species == "Pegl" ~ -0.68,
      Species == "Trae" ~ -0.85,
      Species == "Zema" ~ -0.68,
      TRUE ~ NA_real_
    ),
    elasticity = case_when(
      Species == "Avsa" ~ 8.57,
      Species == "Chga" ~ 11.6,
      Species == "Hovu" ~ 9.27,
      Species == "Pegl" ~ 8.99,
      Species == "Trae" ~ 9.25,
      Species == "Zema" ~ 8.07,
      TRUE ~ NA_real_)) %>% 
  mutate(Psip_LT =-(tlp.coef)-(elasticity*(1-RWCPLT25/100))) %>% 
  mutate(Psip_LT = if_else(Psip_LT < 0, 0, Psip_LT))%>%  # Replace negative Psip with 0
  mutate(Ps_LT=tlp.coef/(RWCPLT25/100)) %>% #tlp en neg 
  mutate(`PLT25`= Psip_LT + Ps_LT) %>%
  ##
  mutate(Psip_LA =-(tlp.coef)-(elasticity*(1-RWCPLA25/100))) %>% 
  mutate(Psip_LA = if_else(Psip_LA < 0, 0, Psip_LA))%>%  # Replace negative Psip with 0
  mutate(Ps_LA=tlp.coef/(RWCPLA25/100)) %>% #tlp en neg 
  mutate(`PLA25`= Psip_LA + Ps_LA) %>%
  ##
  mutate(Psip_LW =-(tlp.coef)-(elasticity*(1-RWCPLW25/100))) %>% 
  mutate(Psip_LW = if_else(Psip_LW < 0, 0, Psip_LW))%>%  # Replace negative Psip with 0
  mutate(Ps_LW=tlp.coef/(RWCPLW25/100)) %>% #tlp en neg 
  mutate(`PLW25`= Psip_LW + Ps_LW) %>%
  select(Species, PLT25, PLA25, PLW25)


summary_metabolism <- P50_summary %>%
  left_join(m.PVdata) %>%
  left_join(embolism_onset_PV) %>%
  left_join(FvFm_summary_PV) %>%
  left_join(RC_summary_PV) %>%
  left_join(shrinkage_PV)%>%
  group_by(Metabolism) %>%
  summarise(
    across(c(PKleaf50, PKroot50, PKplant50, osp.tlp, PWUEimax, Pgs50, PA50, PPLNCF50, `Embolism onset`, PPLRC50, PLA25, PLT25, PLW25),
           list(mean = ~mean(.x, na.rm = TRUE),
                se   = ~sd(.x, na.rm = TRUE)/sqrt(n())),
           .names = "{.col}_{.fn}"))

# Passer en format long
events_long <- summary_metabolism %>%
  pivot_longer(
    cols = -Metabolism,
    names_to = c("trait", ".value"),
    names_pattern = "(.*)_(mean|se)"
  )

# Déterminer l’ordre des traits selon leur vulnérabilité
trait_order <- events_long %>%
  group_by(trait) %>%
  summarise(meanPsi = mean(mean, na.rm = TRUE)) %>%
  arrange(meanPsi) %>%
  pull(trait)

events_long <- events_long %>%
  mutate(trait = factor(trait, levels = trait_order))

trait_labels <- c(
  PKleaf50   = expression(italic(K)[leaf50]),
  PKroot50   = expression(italic(K)[root50]),
  PKplant50  = expression(italic(K)[plant50]),
  osp.tlp    = expression(TLP),
  PWUEimax   = expression(WUE[imax]),
  Pgs50      = expression(italic(g)[s50]),
  PA50       = expression(italic(A)[50]),
  PPLNCF50     = expression(PLCFR[50]),
  `Embolism onset` = "Embolism onset",
  PPLRC50       = expression(PLRC[50]),
  PLA25      = expression(PLA[25]),
  PLT25      = expression(PLT[25]),
  PLW25      = expression(PLW[25]))

Figure6 <- ggplot(events_long, aes(x = mean, y = trait, color = Metabolism)) +
  geom_point(size = 4, position = position_dodge(width = 0.5)) +
  geom_errorbarh(aes(xmin = mean - se, xmax = mean + se),
                 height = 0.3,
                 position = position_dodge(width = 0.5)) +
  scale_color_manual(values = c(C3 = "#6DB9F8", C4 = "#D9AB33"))  +
  scale_y_discrete(labels = trait_labels) +   # <-- pretty trait labels
  labs(
    x = expression(psi[leaf]~"(MPa)"),
    y = ""
  ) +
  theme_minimal(base_size = 16) +
  theme(
    legend.title = element_blank(),
    axis.text.y = element_text(size = 16)
  ) +
  xlim(0,-17)

Figure6


ggsave(filename = "../results/Figure6.jpg", plot = Figure6, width = 9, height = 7)


```

## same for RWC - sequence
```{r}
#same for RWC
#function from MPa to RWC:

psi_to_RWC <- function(psi, tlp, epsilon) {

  # --- helper: forward equation (your original PV formula) ---
  psi_from_rwc <- function(RWC, tlp, epsilon) {
    rwc <- RWC / 100
    Psip <- -(tlp) - epsilon * (1 - rwc)
    Psip <- ifelse(Psip < 0, 0, Psip)   # your cutoff rule
    Ps    <- tlp / rwc
    Psip + Ps
  }

  # --- CASE 1: Psip = 0 (above TLP) ---
  rwc_from_psi_case1 <- function(psi, tlp) {
    rwc <- tlp / psi
    pmax(pmin(rwc, 1), 0) * 100
  }

  # --- CASE 2: Psip > 0 (below TLP) ---
  rwc_from_psi_case2 <- function(psi, tlp, epsilon) {
    a <- epsilon
    b <- psi + tlp + epsilon
    c <- -tlp

    disc <- b*b - 4*a*c
    disc[disc < 0 & disc > -1e-10] <- 0

    r1 <- (-b + sqrt(disc)) / (2*a)
    r2 <- (-b - sqrt(disc)) / (2*a)

    r <- ifelse(r1 >= 0 & r1 <= 1, r1,
                ifelse(r2 >= 0 & r2 <= 1, r2, NA))

    r * 100
  }

  # --- boundary between Psip=0 and Psip>0 ---
  rwc_tlp <- 1 + tlp/epsilon
  psi_tlp <- psi_from_rwc(rwc_tlp * 100, tlp, epsilon)

  # --- choose correct branch ---
  ifelse(
    psi >= psi_tlp,
    rwc_from_psi_case1(psi, tlp),
    rwc_from_psi_case2(psi, tlp, epsilon)
  )
}

psi_to_RWC_simple <- function(psi, tlp, epsilon) {

  a <- epsilon
  b <- -(psi + tlp + epsilon)
  c <- tlp

  # discriminant
  disc <- b*b - 4*a*c
  disc <- pmax(disc, 0)

  r1 <- (-b + sqrt(disc)) / (2*a)
  r2 <- (-b - sqrt(disc)) / (2*a)

  r <- ifelse(r1 >= 0 & r1 <= 1, r1,
              ifelse(r2 >= 0 & r2 <= 1, r2, NA))

  r * 100
}


      
species_parameters <- tribble(
  ~Species, ~Metabolism, ~tlp.coef, ~elasticity, 
  "Avsa", "C3", -0.84, 8.57,
  "Hovu", "C3", -0.83, 9.27,
  "Trae", "C3", -0.85, 9.25,
  "Zema", "C4", -0.68, 8.07,
  "Chga", "C4", -0.75, 11.6,
  "Pegl", "C4", -0.68, 8.99
)


summary_species <- P50_summary %>%
  left_join(m.PVdata) %>%
  #left_join(embolism_onset_PV) %>%
 # left_join(FvFm_summary_PV) %>%
  left_join(RC_summary_PV) %>%
  #left_join(shrinkage_PV) %>%
  left_join(species_parameters, by = c("Species", "Metabolism"))

pressure_traits <- c(
  "PKleaf50", "PKroot50","PKplant50","osp.tlp",
  "PWUEimax","Pgs50","PA50")


summary_species_full <- summary_species %>%
  rowwise() %>%
  mutate(
    across(
      all_of(pressure_traits),
      ~ psi_to_RWC_simple(.x, tlp.coef, elasticity),
      .names = "{.col}_RWC"
    )
  ) %>%
  ungroup()


summary_full_all <- summary_species_full %>%
  select(Species, Metabolism, ends_with("_RWC")) %>%
  left_join(embolism_onset, by = "Species") %>%
  left_join(FvFm_summary, by = "Species") %>%
  left_join(RC_summary, by = "Species") %>%
  left_join(shrinkage,  by = "Species")

summary_full_all

events_RWC_long <- summary_full_all %>% 
 select(Species, Metabolism, contains("RWC"))%>%
  pivot_longer(-c(Species, Metabolism),
               names_to="trait", values_to="value") %>% 
  group_by(Metabolism, trait) %>% 
  summarise(
    mean = mean(value, na.rm=TRUE),
    se = sd(value, na.rm=TRUE)/sqrt(n())
  )



trait_order <- events_RWC_long %>%
  group_by(trait) %>%
  summarise(overall_mean = mean(mean, na.rm = TRUE)) %>%
  arrange(overall_mean) %>%
  pull(trait)

events_RWC_long <- events_RWC_long %>%
  mutate(trait = factor(trait, levels = trait_order))

trait_labels_RWC <- c(
  PKleaf50_RWC  = expression(italic(K)[leaf50]),
  PKroot50_RWC   = expression(italic(K)[root50]),
  PKplant50_RWC= expression(italic(K)[plant50]),
  osp.tlp_RWC    = expression(TLP),
  PWUEimax_RWC   = expression(WUE[imax]),
  Pgs50_RWC     = expression(italic(g)[s50]),
  PA50_RWC      = expression(italic(A)[50]),
  RWC_PLNCF50     = expression(PLCFR[50]),
  RWC_embolism_onset = "Embolism onset",
  RWC_PLRC50       = expression(PLRC[50]),
  RWCPLA25      = expression(PLA[25]),
  RWCPLT25      = expression(PLT[25]),
  RWCPLW25      = expression(PLW[25]))


Figure6_RWC <- ggplot(events_RWC_long,
                      aes(x = mean, y = trait, color = Metabolism)) +
  geom_point(size = 4, position = position_dodge(width = 0.5)) +
  geom_errorbarh(aes(xmin = mean - se, xmax = mean + se),
                 height = 0.3,
                 position = position_dodge(width = 0.5)) +
 scale_color_manual(values = c(C3 = "#6DB9F8", C4 = "#D9AB33"))  +
  scale_y_discrete(labels = trait_labels_RWC) +   
  labs(x = "RWC (%)", y = "") +
  theme_minimal(base_size = 16)+
  theme(
    legend.title = element_blank(),
    axis.text.y = element_text(size = 16)
  ) +
  xlim(100,0)

Figure6_RWC 


Figure6_total <- ggarrange(Figure6, Figure6_RWC, labels = c("A", "B") , common.legend = T, nrow = 1, ncol=2, legend = "bottom")

Figure6_total 

ggsave(filename = "../results/Figure6_total.jpg", plot = Figure6_total, width = 12, height = 7)
```

##MicroCT graph

```{r}
microCT <- read_excel("C:/Users/mboisse/Dropbox/Mon PC (Jaboty20)/Post_doc_CalState_LA/Miquel_data/data/MicroCT_grasses_23Sept25_MB.xlsx", 
    sheet = "calcul") %>% select(Species, Metabolism,`Psi leaf`, `Embolism_midrib_%`) %>%
  drop_na() %>%
   mutate(`Psi leaf` = round(as.numeric(`Psi leaf`), 2))


FigureSI <- ggplot(microCT , aes(x = `Psi leaf` , y = `Embolism_midrib_%`, color = Metabolism)) +
  geom_point(size = 4, position = position_dodge(width = 0.5)) +
  scale_color_manual(values = c(C3 = "#6DB9F8", C4 = "#D9AB33")) +
  xlab(expression(paste(Psi["leaf"]," (MPa)")))+
  ylab(expression(paste("%Embolized Conduits")))+
  theme_minimal(base_size = 14) +
  theme(
    legend.title = element_blank(),
    axis.text.y = element_text(size = 14)
  ) 

FigureSI

ggsave(filename = "../results/FiguremicroCT.jpg", plot = FigureSI, width = 4, height = 3)
```


# Correlations

```{r}
df <- read.csv("../results/summary_table_ttest.csv") %>% select(-X) %>% slice(0,1,2,3,4,5,6)
df_num <- df %>% select(where(is.numeric))

# pairwise Spearman correlations
cor_res_s <- rcorr(as.matrix(df_num), type = "spearman")

# Extract correlation coefficients and p-values 
cor_table_s<- cor_res_s$r %>%
  as.data.frame() %>%
  rownames_to_column("var1") %>%
  pivot_longer(-var1, names_to = "var2", values_to = "rho") %>%
  left_join(
    cor_res_s$P %>%
      as.data.frame() %>%
      rownames_to_column("var1") %>%
      pivot_longer(-var1, names_to = "var2", values_to = "pval"),
    by = c("var1", "var2")
  ) %>%
  filter(var1 < var2) # avoid duplicates 

# Rank by strongest correlations
top_pairs_s <- cor_table_s %>%
  filter(!is.na(rho)) %>%
  arrange(pval, desc(abs(rho))) %>%
  filter(pval < 0.05)

#remove redundancy
top_pairs_filtered_s <-  top_pairs_s %>%
  filter(!( (var1 == "PA50" & var2 == "PWUEimax") |
            (var1 == "PWUEimax" & var2 == "PA50") )) %>%
  filter(!( (var1 == "PLA" & var2 == "PLW") |
            (var1 == "PLW" & var2 == "PLA") )) %>%
    filter(!( (var1 == "gsmax" & var2 == "WUEimax") |
            (var1 == "WUEimax" & var2 == "gsmax") )) %>%
    filter(!( (var1 == "PWUEimax" & var2 == "WUEimax") |
            (var1 == "WUEimax" & var2 == "PWUEimax") ))


write.csv(top_pairs_filtered_s, file = "../results/spearmancorr.csv")

# pairwise pearson correlations
cor_res_p <- rcorr(as.matrix(df_num), type = "pearson")

# Extract correlation coefficients and p-values 
cor_table_p <- cor_res_p$r %>%
  as.data.frame() %>%
  rownames_to_column("var1") %>%
  pivot_longer(-var1, names_to = "var2", values_to = "rho") %>%
  left_join(
    cor_res_p$P %>%
      as.data.frame() %>%
      rownames_to_column("var1") %>%
      pivot_longer(-var1, names_to = "var2", values_to = "pval"),
    by = c("var1", "var2")
  ) %>%
  filter(var1 < var2) # avoid duplicates 

# Rank by strongest correlations
top_pairs_p <- cor_table_p %>%
  filter(!is.na(rho)) %>%
  arrange(pval, desc(abs(rho))) %>%
  filter(pval < 0.05)

#remove redundancy
top_pairs_filtered_p <-  top_pairs_p %>%
  filter(!( (var1 == "PA50" & var2 == "PWUEimax") |
            (var1 == "PWUEimax" & var2 == "PA50") )) %>%
  filter(!( (var1 == "PLA" & var2 == "PLW") |
            (var1 == "PLW" & var2 == "PLA") )) %>%
    filter(!( (var1 == "gsmax" & var2 == "WUEimax") |
            (var1 == "WUEimax" & var2 == "gsmax") )) %>%
    filter(!( (var1 == "PWUEimax" & var2 == "WUEimax") |
            (var1 == "WUEimax" & var2 == "PWUEimax") ))


write.csv(top_pairs_filtered_p, file = "../results/pearsoncorr.csv")

#some plots

round(cor_res_s$r["Kleafmax", "LT"], 2)
signif(cor_res_s$P["Kleafmax", "LT"], 2)
round(cor_res_p$r["Kleafmax", "LT"], 2)
signif(cor_res_p$P["Kleafmax", "LT"], 2)
label_text <- (expression(atop(italic(r)[s] ~ "=" * 1 ~ "***", italic(r)[p] ~ "=" * 0.92 ~ "**")))

Kleafmax_LT <-ggplot(df, aes(x = Kleafmax, y = LT, colour = Metabolism)) +
  geom_point(size = 3.6) +
  scale_color_manual(values = c(C3 = "#6DB9F8", C4 = "#D9AB33")) +
  geom_smooth(aes(x = Kleafmax, y = LT), method = "lm",
              se = FALSE, color = "black", linetype = "dashed",
              inherit.aes = FALSE) +
  # stat_regline_equation(aes(x = Kleafmax, y = LT),
  #                       inherit.aes = FALSE,
  #                       label.x.npc = 0.48,
  #                       label.y.npc = 0.20) +
  annotate("text",
           x =50,
           y = 0.125,
           label = label_text,
           size = 5) +
  ylab(expression("LT (mm)"))+
  xlab(expression(italic(K)[leafmax] ~ "(" * mmol ~ m^{-2} ~ s^{-1} ~ MPa^{-1} * ")"))+
  theme_minimal(base_size = 14) + ggtitle("A.")
Kleafmax_LT
#to plot rho instead of R for Spearman: directly change in the function the output like that
#trace(ggpubr:::.cor_test, edit=TRUE)
#and edit italic(R) to become rho in
# if (output.type == "expression") {
#     z <- z %>% dplyr::mutate(r.label = paste("rho", r, sep = "~`=`~"),
#but I actually modofied to [2]

round(cor_res_s$r["Krootmax", "LT"], 2)
signif(cor_res_s$P["Krootmax", "LT"], 2)
round(cor_res_p$r["Krootmax", "LT"], 2)
signif(cor_res_p$P["Krootmax", "LT"], 2)
label_text <- (expression(atop(italic(r)[s] ~ "=" * 0.83 ~ "*", italic(r)[p] ~ "=" * 0.85 ~ "*")))

Krootmax_LT <-ggplot(df, aes(x = Krootmax, y = LT, colour = Metabolism)) +
  geom_point(size = 3.6) +
  scale_color_manual(values = c(C3 = "#6DB9F8", C4 = "#D9AB33")) +
  geom_smooth(aes(x = Krootmax, y = LT), method = "lm",
              se = FALSE, color = "black", linetype = "dashed",
              inherit.aes = FALSE) +
  # stat_regline_equation(aes(x = Krootmax, y = LT),
  #                       inherit.aes = FALSE,
  #                       label.x.npc = 0.48,
  #                       label.y.npc = 0.20) +
  annotate("text",
           x =0.12,
           y = 0.125,
           label = label_text,
           size = 5) +
  ylab(expression("LT (mm)"))+
  xlab(expression(italic(K)[rootmax] ~ "(" * mol ~ m^{-2} ~ s^{-1} ~ MPa^{-1} * ")"))+
  theme_minimal(base_size = 14) + ggtitle("B.")
Krootmax_LT

round(cor_res_s$r["PA50", "RWC_embolism_onset"], 2)
signif(cor_res_s$P["PA50", "RWC_embolism_onset"], 2)
round(cor_res_p$r["PA50", "RWC_embolism_onset"], 2)
signif(cor_res_p$P["PA50", "RWC_embolism_onset"], 2)

label_text <- expression(atop(italic(r)[s] ~ "=" * "-0.94" ~ "**", italic(r)[p] ~ "=" * "-0.98" ~ "***"))

######
PA50_embolism <-ggplot(df, aes(x = RWC_embolism_onset , y = PA50, colour = Metabolism)) +
  geom_point(size = 3.6) +
  scale_color_manual(values = c(C3 = "#6DB9F8", C4 = "#D9AB33")) +
  geom_smooth(
    aes(x = RWC_embolism_onset , y = PA50),   # re-specify to ignore grouping
    method = "lm", se = FALSE, color = "black", linetype = "dashed",
    inherit.aes = FALSE ) +
  # regression equation (overall)
  # stat_regline_equation(
  #   aes(x = PA50, y = RWC_embolism_onset),   # ignore grouping
  #   inherit.aes = FALSE,
  #   label.x.npc = 0.5,
  #   label.y.npc = 0.70) +
  annotate("text",
           x = 57,
           y = -0.98,
           label = label_text,
           hjust = 0, vjust = 0.2, size = 5) +
   xlab(expression(RWC[embolism] ~ "(" ~ "%" ~ ")"))+
   ylab(expression(italic(P)[A50] ~ "(" * MPa * ")"))+
  theme_minimal(base_size = 14)+ ggtitle("C.")



round(cor_res_s$r["osp.tlp", "Pgs50"], 2)
signif(cor_res_s$P["osp.tlp", "Pgs50"], 2)
round(cor_res_p$r["osp.tlp", "Pgs50"], 2)
signif(cor_res_p$P["osp.tlp", "Pgs50"], 2)
label_text <- expression(atop(italic(r)[s] ~ "=" * "0.94" ~ "**",italic(r)[p] ~ "=" * "0.86" ~ "*" ))

tlp_gs50 <-ggplot(df, aes(x = osp.tlp, y = Pgs50, colour = Metabolism)) +
  geom_point(size = 3.6) +
  scale_color_manual(values = c(C3 = "#6DB9F8", C4 = "#D9AB33")) +
  geom_smooth(
    aes(x = osp.tlp, y = Pgs50),   # re-specify to ignore grouping
    method = "lm", se = FALSE, color = "black", linetype = "dashed",
    inherit.aes = FALSE ) +
  # regression equation (overall)
  # stat_regline_equation(
  #   aes(x = osp.tlp, y = Pgs50),   # ignore grouping
  #   inherit.aes = FALSE,
  #   label.x.npc = 0.45,
  #   label.y.npc = 0.22) +
  annotate("text",
           x = -0.9,
           y = -1.0,
           label = label_text,
           hjust = 0, vjust = 0.2, size = 5) +
    ylab(expression(italic(P)[gs50] ~ "(" ~ "MPa" ~ ")"))+
    xlab(expression(pi[tlp] ~ "(" ~ "MPa" ~ ")"))+
  theme_minimal(base_size = 14) + ggtitle("E.")

######
round(cor_res_s$r["osp.tlp", "PA50"], 2)
signif(cor_res_s$P["osp.tlp", "PA50"], 2)
round(cor_res_p$r["osp.tlp", "PA50"], 2)
signif(cor_res_p$P["osp.tlp", "PA50"], 2)
label_text <- expression(atop(italic(r)[s] ~ "=" * "0.89" ~ "*",italic(r)[p] ~ "=" * "0.95" ~ "**"))

tlp_A50 <-ggplot(df, aes(x = osp.tlp, y = PA50, colour = Metabolism)) +
  geom_point(size = 3.6) +
  scale_color_manual(values = c(C3 = "#6DB9F8", C4 = "#D9AB33")) +
  geom_smooth(
    aes(x = osp.tlp, y = PA50),   # re-specify to ignore grouping
    method = "lm", se = FALSE, color = "black", linetype = "dashed",
    inherit.aes = FALSE ) +
  # regression equation (overall)
  # stat_regline_equation(
  #   aes(x = osp.tlp, y = PA50),   # ignore grouping
  #   inherit.aes = FALSE,
  #   label.x.npc = 0.45,
  #   label.y.npc = 0.3) +
  annotate("text",
           x = -0.9,
           y = -1.11,
           label = label_text,
           hjust = 0, vjust = 0.2, size = 5) +
   ylab(expression(italic(P)[A50] ~ "(" ~ "MPa" ~ ")"))+
    xlab(expression(pi[tlp] ~ "(" ~ "MPa" ~ ")"))+
  theme_minimal(base_size = 14) + ggtitle("D.")


round(cor_res_s$r["Krootmax", "RWCPLA25"], 2)
signif(cor_res_s$P["Krootmax", "RWCPLA25"], 2)
round(cor_res_p$r["Krootmax", "RWCPLA25"], 2)
signif(cor_res_p$P["Krootmax", "RWCPLA25"], 2)
label_text <- expression(atop(italic(r)[s] ~ "=" * "-0.94" ~ "**", italic(r)[p] ~ "=" * "-0.8" ~ "NS"))

######
Kleafmax_LT #thicker leaves have higher Kleafmax, bigger conduits to enhance Kleafmax ? Structure linked to hydraulic capacity
PA50_embolism #more resistance to embolism at more negative P50A 
ggarrange(Krootmax_RWCPLA25, Krootmax_RWCPLW25, common.legend = T) #higher krootmax associated with more resistance in percent loss in area or width, RWCPLA25 (the relative water content at which there is a 25% loss of leaf area, or width). species with lower krootmax will have 25% shrinkage at higher RWC.

ggarrange(tlp_A50, tlp_gs50, common.legend = T) #more neg TLP aossicated with more negative PA50 and Pgs50


################ Figure by theme

themeA <- ggarrange(Kleafmax_LT,Krootmax_LT, NULL, ncol = 3,  common.legend = T, legend = "none") #drivers of hydraulic capacity

themeB <- ggarrange(PA50_embolism, tlp_A50, tlp_gs50, common.legend = T, legend = "none", ncol = 3) + labs(title = "B.")#drought vulnerability

bigfig <- ggarrange(themeA, 
                    themeB,   
                    ncol = 1, nrow =2)

bigfig


ggsave("../results/correlation_themes.jpg", bigfig, width = 10, height = 8, dpi = 300)

##corrplot spearman
df_num <- df %>% select(where(is.numeric))
cor_res <- rcorr(as.matrix(df_num), type = "spearman")
rho_matrix <- cor_res$r
p_matrix <- cor_res$P

corrplot(rho_matrix,
         method = "color",
         type = "upper",
         order = "original",
        # addCoef.col = "black",
         tl.col = "black", tl.srt = 45, tl.cex = 0.7,
         p.mat = p_matrix,     # p-values
         sig.level = 0.05,     # threshold for significance
         insig = "blank", addgrid.col = "grey70")      # hide non-significant correlations


##corrplot pearson
df_num <- df %>% select(where(is.numeric))
cor_res <- rcorr(as.matrix(df_num), type = "pearson")
rho_matrix <- cor_res$r
p_matrix <- cor_res$P

corrplot(rho_matrix,
         method = "color",
         type = "upper",
         order = "original",
        # addCoef.col = "black",
         tl.col = "black", tl.srt = 45, tl.cex = 0.7,
         p.mat = p_matrix,     # supply p-values
         sig.level = 0.05,     # threshold for significance
         insig = "blank",  addgrid.col = "grey70")      # hide non-significant correlations



####Together combine###########

png(height=800, width=1600, file="../results/combined_corr_plots.png", type = "cairo")

par(mfrow=c(1,2), oma=c(0,0,0,0), mar=c(0,0,0,0))

#  Spearman
df_num <- df %>% select(where(is.numeric))
cor_res <- rcorr(as.matrix(df_num), type = "spearman")
rho_matrix <- cor_res$r
p_matrix   <- cor_res$P  

#don't know why i had mismatches
common <- intersect(rownames(rho_matrix), rownames(p_matrix))
rho_matrix <- rho_matrix[common, common]
p_matrix   <- p_matrix[common, common]

corrplot(rho_matrix,
         method = 'color',
         order = 'original',
         type= 'upper',
         p.mat = p_matrix,
         sig.level = 0.05,
         insig = "blank",  
         diag = FALSE, 
         addgrid.col = "grey70", 
         cl.cex = 1.5, 
         tl.col = "black", 
         tl.srt = 40, 
         tl.cex = 1)
title(main = "Spearman", adj= 0.2, line = -5, cex.main = 3, col.main= "black")  

# Pearson 

cor_res <- rcorr(as.matrix(df_num), type = "pearson")
rho_matrix <- cor_res$r
p_matrix   <- cor_res$P

common <- intersect(rownames(rho_matrix), rownames(p_matrix))
rho_matrix <- rho_matrix[common, common]
p_matrix   <- p_matrix[common, common]

corrplot(rho_matrix,
         method = 'color',
         order = 'original',
         type= 'upper',
         p.mat = p_matrix,
         sig.level = 0.05,
         insig = "blank",  
         diag = FALSE, 
         addgrid.col = "grey70", 
         cl.cex = 1.5,
         tl.col = "black",
         tl.srt = 40,
         tl.cex = 1)
title(main = "Pearson", adj= 0.2, line = -5, cex.main = 3, col.main= "black")  

dev.off()



```

```{r}
#some plots

round(cor_res_s$r["Kleafmax","Krootmax"], 2)
signif(cor_res_s$P["Kleafmax","Krootmax"], 2)
round(cor_res_p$r["Kleafmax","Krootmax"], 2)
signif(cor_res_p$P["Kleafmax","Krootmax"], 2)
label_text <- "atop(italic(r)[s] == 0.83 * '*',                     italic(r)[p] == 0.78 * 'ns')"

Kleafmax_Krootmax <-ggplot(df, aes(x = Kleafmax, y = Krootmax, colour = Metabolism)) +
  geom_point(size = 3.6) +
  scale_color_manual(values = c(C3 = "#6DB9F8", C4 = "#D9AB33")) +
  geom_smooth(aes(x = Kleafmax, y = Krootmax), method = "lm",
              se = FALSE, color = "black", linetype = "dashed",
              inherit.aes = FALSE) +
  annotate("text",
           x =30,
           y = 0.15,
           label = label_text,
           parse= T,
           size = 5) +
  ylab(expression(italic(K)[rootmax] ~ "(" * mol ~ m^{-2} ~ s^{-1} ~ MPa^{-1} * ")"))+
  xlab(expression(italic(K)[leafmax] ~ "(" * mmol ~ m^{-2} ~ s^{-1} ~ MPa^{-1} * ")"))+
  theme_minimal(base_size = 14) + ggtitle("A.")
Kleafmax_Krootmax
#to plot rho instead of R for Spearman: directly change in the function the output like that
#trace(ggpubr:::.cor_test, edit=TRUE)
#and edit italic(R) to become rho in
# if (output.type == "expression") {
#     z <- z %>% dplyr::mutate(r.label = paste("rho", r, sep = "~`=`~"),
#but I actually modofied to [2]


#####
round(cor_res_s$r["Kleafmax","Amax"], 2)
signif(cor_res_s$P["Kleafmax","Amax"], 2)
round(cor_res_p$r["Kleafmax","Amax"], 2)
signif(cor_res_p$P["Kleafmax","Amax"], 2)
label_text <- "atop(italic(r)[s] == 0.2 * 'ns',                     italic(r)[p] == -0.64 * 'ns')"

Kleafmax_Amax <-ggplot(df, aes(x = Kleafmax, y = Amax, colour = Metabolism)) +
  geom_point(size = 3.6) +
  scale_color_manual(values = c(C3 = "#6DB9F8", C4 = "#D9AB33")) +
  geom_smooth(aes(x = Kleafmax, y = Amax), method = "lm",
              se = FALSE, color = "black", linetype = "dashed",
              inherit.aes = FALSE) +
  annotate("text",
           x =60,
           y = 40,
           label = label_text,
           parse= T,
           size = 5) +
  ylab(expression(A[max] ~ "(" * µmol ~ m^{-2} ~ s^{-1} * ")"))+
  xlab(expression(italic(K)[leafmax] ~ "(" * mmol ~ m^{-2} ~ s^{-1} ~ MPa^{-1} * ")"))+
  theme_minimal(base_size = 14) + ggtitle("B.")
Kleafmax_Amax

######


round(cor_res_s$r["Kleafmax","gsmax"], 2)
signif(cor_res_s$P["Kleafmax","gsmax"], 2)
round(cor_res_p$r["Kleafmax","gsmax"], 2)
signif(cor_res_p$P["Kleafmax","gsmax"], 2)
label_text <- "atop(italic(r)[s] == 0.83 * '*',                     italic(r)[p] == 0.1 * 'ns')"

Kleafmax_gsmax <-ggplot(df, aes(x = Kleafmax, y = gsmax, colour = Metabolism)) +
  geom_point(size = 3.6) +
  scale_color_manual(values = c(C3 = "#6DB9F8", C4 = "#D9AB33")) +
  geom_smooth(aes(x = Kleafmax, y = gsmax), method = "lm",
              se = FALSE, color = "black", linetype = "dashed",
              inherit.aes = FALSE) +
  annotate("text",
           x =60,
           y = 1.3,
           label = label_text,
           parse= T,
           size = 5) +
  ylab(expression(g[smax] ~ "(" * mol ~ m^{-2} ~ s^{-1} * ")"))+
  xlab(expression(italic(K)[leafmax] ~ "(" * mmol ~ m^{-2} ~ s^{-1} ~ MPa^{-1} * ")"))+
  theme_minimal(base_size = 14) + ggtitle("C.")
Kleafmax_gsmax


######
round(cor_res_s$r["osp.tlp", "PA50"], 2)
signif(cor_res_s$P["osp.tlp", "PA50"], 2)
round(cor_res_p$r["osp.tlp", "PA50"], 2)
signif(cor_res_p$P["osp.tlp", "PA50"], 2)
label_text <- "atop(italic(r)[s] ~ '=' * '0.89' ~ '*',italic(r)[p] ~ '=' * '0.95' ~ '**')"

tlp_A50 <-ggplot(df, aes(x = osp.tlp, y = PA50, colour = Metabolism)) +
  geom_point(size = 3.6) +
  scale_color_manual(values = c(C3 = "#6DB9F8", C4 = "#D9AB33")) +
  geom_smooth(
    aes(x = osp.tlp, y = PA50),   # re-specify to ignore grouping
    method = "lm", se = FALSE, color = "black", linetype = "dashed",
    inherit.aes = FALSE ) +
  # regression equation (overall)
  # stat_regline_equation(
  #   aes(x = osp.tlp, y = PA50),   # ignore grouping
  #   inherit.aes = FALSE,
  #   label.x.npc = 0.45,
  #   label.y.npc = 0.3) +
  annotate("text",
           x = -1,
           y = -0.85,
           label = label_text,
           parse= T,
           hjust = 0, vjust = 0.2, size = 5) +
   ylab(expression(italic(P)[A50] ~ "(" ~ "MPa" ~ ")"))+
    xlab(expression(pi[tlp] ~ "(" ~ "MPa" ~ ")"))+
  theme_minimal(base_size = 14) + ggtitle("D.")

tlp_A50 

#####
round(cor_res_s$r["osp.tlp", "Pgs50"], 2)
signif(cor_res_s$P["osp.tlp", "Pgs50"], 2)
round(cor_res_p$r["osp.tlp", "Pgs50"], 2)
signif(cor_res_p$P["osp.tlp", "Pgs50"], 2)
label_text <- "atop(italic(r)[s] ~ '=' * '0.94' ~ '**',italic(r)[p] ~ '=' * '0.86' ~ '*')"

tlp_gs50 <-ggplot(df, aes(x = osp.tlp, y = Pgs50, colour = Metabolism)) +
  geom_point(size = 3.6) +
  scale_color_manual(values = c(C3 = "#6DB9F8", C4 = "#D9AB33")) +
  geom_smooth(
    aes(x = osp.tlp, y = Pgs50),   # re-specify to ignore grouping
    method = "lm", se = FALSE, color = "black", linetype = "dashed",
    inherit.aes = FALSE ) +
  annotate("text",
           x = -1,
           y = -0.7,
           label = label_text,
           parse= T,
           hjust = 0, vjust = 0.2, size = 5) +
    ylab(expression(italic(P)[gs50] ~ "(" ~ "MPa" ~ ")"))+
    xlab(expression(pi[tlp] ~ "(" ~ "MPa" ~ ")"))+
  theme_minimal(base_size = 14) + ggtitle("E.")

tlp_gs50 

####
round(cor_res_s$r["osp.tlp", "PKleaf50"], 2)
signif(cor_res_s$P["osp.tlp", "PKleaf50"], 2)
round(cor_res_p$r["osp.tlp", "PKleaf50"], 2)
signif(cor_res_p$P["osp.tlp", "PKleaf50"], 2)
label_text <-"atop(italic(r)[s] ~ '=' * '0.49' ~ 'ns',italic(r)[p] ~ '=' * '0.31' ~ 'ns')"

tlp_Kleaf50 <-ggplot(df, aes(x = osp.tlp, y = PKleaf50, colour = Metabolism)) +
  geom_point(size = 3.6) +
  scale_color_manual(values = c(C3 = "#6DB9F8", C4 = "#D9AB33")) +
  geom_smooth(
    aes(x = osp.tlp, y = PKleaf50),   # re-specify to ignore grouping
    method = "lm", se = FALSE, color = "black", linetype = "dashed",
    inherit.aes = FALSE ) +
  annotate("text",
           x = -0.8,
           y = -0.45,
           label = label_text,
           parse= T,
           hjust = 0, vjust = 0.2, size = 5) +
    ylab(expression(italic(P)[Kleaf50] ~ "(" ~ "MPa" ~ ")"))+
    xlab(expression(pi[tlp] ~ "(" ~ "MPa" ~ ")"))+
  theme_minimal(base_size = 14) + ggtitle("F.")
tlp_Kleaf50 


####
round(cor_res_s$r["osp.tlp", "Pembolism"], 2)
signif(cor_res_s$P["osp.tlp", "Pembolism"], 2)
round(cor_res_p$r["osp.tlp", "Pembolism"], 2)
signif(cor_res_p$P["osp.tlp", "Pembolism"], 2)
label_text <-"atop(italic(r)[s] ~ '=' * '0.49' ~ 'ns',italic(r)[p] ~ '=' * '0.31' ~ 'ns')"

tlp_embolism <-ggplot(df, aes(x = osp.tlp, y = Pembolism, colour = Metabolism)) +
  geom_point(size = 3.6) +
  scale_color_manual(values = c(C3 = "#6DB9F8", C4 = "#D9AB33")) +
  geom_smooth(
    aes(x = osp.tlp, y = Pembolism),   # re-specify to ignore grouping
    method = "lm", se = FALSE, color = "black", linetype = "dashed",
    inherit.aes = FALSE ) +
  annotate("text",
           x = -0.8,
           y = -0.45,
           label = label_text,
           parse= T,
           hjust = 0, vjust = 0.2, size = 5) +
    ylab(expression(italic(P)[embolism onset] ~ "(" ~ "MPa" ~ ")"))+
    xlab(expression(pi[tlp] ~ "(" ~ "MPa" ~ ")"))+
  theme_minimal(base_size = 14) + ggtitle("F.")
tlp_embolism 


##########
embolism_PA50 <-ggplot(df, aes(x = RWC_embolism_onset , y = PA50, colour = Metabolism)) +
  geom_point(size = 3.6) +
  scale_color_manual(values = c(C3 = "#6DB9F8", C4 = "#D9AB33")) +
  geom_smooth(
    aes(x = RWC_embolism_onset , y = PA50),   # re-specify to ignore grouping
    method = "lm", se = FALSE, color = "black", linetype = "dashed",
    inherit.aes = FALSE ) +
  annotate("text",
           x = 57,
           y = -0.98,
           label = label_text,
           hjust = 0, vjust = 0.2, size = 5) +
   xlab(expression(RWC[embolism] ~ "(" ~ "%" ~ ")"))+
   ylab(expression(italic(P)[A50] ~ "(" * MPa * ")"))+
  theme_minimal(base_size = 14)+ ggtitle("C.")

embolism_gs50

embolism_Kleaf

embolism_PLCFR50





################ Figure by theme

themeA <- ggarrange(Kleafmax_Krootmax,Kleafmax_Amax, Kleafmax_gsmax, NULL, ncol = 4,  common.legend = T, legend = "none")

themeA_bis <- annotate_figure(
  themeA,
  top = text_grob("Hydraulic coordination and gas exchange", size = 16)
)

themeB <- ggarrange(tlp_A50, tlp_gs50, tlp_Kleaf50, tlp_embolism, common.legend = T, legend = "none", ncol = 4) + labs(title = "B.")#

themeC <- ggarrange(embolism_A50, embolism_gs50, embolism_Kleaf, embolism_PLCFR50, common.legend = T, legend = "none", ncol = 4) + labs(title = "C.")#


bigfig <- ggarrange(themeA, 
                    themeB, 
                    themeC,
                    ncol = 1, nrow =3)

bigfig


ggsave("../results/correlation_themes.jpg", bigfig, width = 10, height = 8, dpi = 300)

```













